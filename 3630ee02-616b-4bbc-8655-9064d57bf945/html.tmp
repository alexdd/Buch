<div data-attribute-id="51a4584a-9a43-4f8f-ad89-d1c2d88ab6e6" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="bcda0a5b-442b-4fbe-a198-d562d796e6da"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="9c13d213-40d3-4e74-b343-23cc42779c6d" class="title pmarker tags" data-element="title" data-tektur-editor-id="e1932b89-f877-4ed9-ac88-0b7bc1c32a1f" contenteditable="true">Funktionen und Module</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="1bd559e7-8872-4bc7-88e0-9c710f08b852"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="bf720cb2-c76d-422f-9597-347b3bb52c19" contenteditable="true"></div></div><div data-attribute-id="55287d31-0b28-41fc-a844-f9f51bdf389d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="bcdc19a8-359e-42a1-aa53-119bb3f37386"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="9698142a-a6c9-4ec9-a807-aa49cbc09f32"><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="2bf31d69-7745-4db3-b54b-9527b6eaaf87" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="d15817f0-4510-44c8-8d46-dd6b3d3b89d7"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="2b09a4f1-af09-482e-b220-bbaa5e4f0897d6e5" class="title pmarker tags" data-element="title" data-tektur-editor-id="6be239f6-5a01-4daf-8096-9baaff78c3c0" contenteditable="true">Funktionen</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5de561e1-87c3-4f46-b36e-c5db56d9ae27d6e7" class="p pmarker tags" data-element="p" data-tektur-editor-id="699f97a6-1fc6-4cd9-a9d6-2ae81e7f50c7" contenteditable="true">Um bestimmte Abschnitte des XQuery Programm wiederverwendbar zu machen, stehen Funktionsdeklarationen<span class="bracket-tags-marker" id="44f00e28-5bab-42c4-8f99-d99b7bf44539">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Funktionen</span>]]</span> zur verfügung. Eine einfache Funktion wäre z.B. diese hier:</div><div class="pre"><div data-attribute-id="cd5a534e-74f2-4274-93da-9f67caf3e1d2d6e9" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="7bce60d0-4255-444a-89fc-7677eeafa5d0" contenteditable="true">declare function local:wrap-header($json) {
  xdmp:add-response-header("Pragma", "no-cache"),
  xdmp:add-response-header("Cache-Control", "no-cache"),
  xdmp:add-response-header("Expires", "0"),
  xdmp:set-response-content-type('text/json; charset=utf-8'),
  $json
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="285caf33-98eb-4945-acad-961bc509ce0cd6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="adff32be-3e81-49aa-93f8-7c5fc50844e6" contenteditable="true">Sie wickelt um einen JSON String eine passende Header Information.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="df24cc6b-17ff-486d-827c-9cec00d4a33bd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="92ff7782-eb7d-4de5-880e-a0f1dcdc0ffa" contenteditable="true">Damit die Funktion eingebunden werden kann, muss ein passender Namespace<span class="bracket-tags-marker" id="227acac8-3ba4-42e4-acd3-b0a1f0a01b2e">[[<span class="bracket-tags">xe1:XML Konstrukte;xe2:Namespaces</span>]]</span> deklariert werden:</div><div class="pre"><div data-attribute-id="7d1bdf82-b756-4859-af29-93e44c67081dd6e15" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="16939291-d2cf-456c-b483-46c5c9752595" contenteditable="true">declare namespace local = 'local:';</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc7c92a6-2eae-47e2-973b-904415f3fc0ed6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="798c60cd-4e87-4257-9959-8413594e7fc4" contenteditable="true">Nicht nur bzgl. Wiederverwendbarkeit sind Funktionen praktisch, sondern auch
um ganz elementare Konstrukte, wie <span class="bracket-tags-marker" id="4b9cd123-0562-4179-9ad9-00ce13a0018f">[[<span class="bracket-tags">code:while...do</span>]]</span><span class="bracket-tags-marker" id="616c90b9-ec36-417f-9e06-1b314433c230">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Schleifen - while..do</span>]]</span> Schleifen, zu realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6ec7b350-f2e7-4922-9e96-9c12fd07957ad6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="33107b5a-77a5-40c7-adde-d59d0fb9f294" contenteditable="true">Dazu nutzt man, wie in der funktionalen Programmierung üblich, die Rekursion:</div><div class="pre"><div data-attribute-id="d616c2a9-a49e-4de3-af15-cd2caa3da886d6e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="a3f7bebf-9904-4c6d-af58-b42a1507ea20" contenteditable="true">declare function local:ist-letzter-wert-in-kette($glied) {
  let $wert := local:komplizierte-berechnung($glied),
    $naechstes-glied := local:komplizierte-berechnung-der-position($glied),
  return
    if ($naechstes-glied and not($wert = 'foobar')) then
      local:durchlaufe-kette($naechstes-glied)
    else
      $wert = 'foobar'
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="844b5256-5000-436c-bca3-c8f1c31f3ffed6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="0fd65904-15ee-4f12-8b20-44286af52765" contenteditable="true">In diesem kleinen Schnippsel sind schon einige Besonderheiten von 
XQuery zu sehen. Variablenzuweisungen geschehen mit einem Doppelpunkt,
Vergleiche dagegen nur mit einem einfachen "=". Statements werden mit einem
Komma getrennt.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="8afb91fd-52fa-4933-be3c-940a6513d593"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="dab65cd2-0eb9-4487-99e0-07422d3c3759d6e26" class="title pmarker tags" data-element="title" data-tektur-editor-id="189c1943-994f-41ba-9131-1bcd9e06a9f0" contenteditable="true">Module</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="2cc3effd-16fe-42c0-9fbd-bfa92cb6d10bd6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="9e0f5184-9ef8-442a-900c-e4a6ccc4d1f4" contenteditable="true">Um eine XQuery Anwendung zu modularisieren<span class="bracket-tags-marker" id="90813e03-f08b-4dde-a687-d3fd81e9b1aa">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Module</span>]]</span>, können einzelne Skripte in
Module ausgelagert werden. Ein Modul, z.B. common.xqy, wird dabei über einen eigenen
Namespace deklariert:</div><div class="pre"><div data-attribute-id="1aaf3731-1a4a-4b37-82e9-6e65ad68c0f7d6e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ebc5638b-6f69-47dc-8471-bf618fcf76e8" contenteditable="true">module namespace common = "https://www.tekturcms.de/common";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86f1276d-3550-4da6-887d-58012231ea7cd6e32" class="p pmarker tags" data-element="p" data-tektur-editor-id="3d48ad78-bb9a-4b30-8259-b5ba8d3c39fc" contenteditable="true">Dieses Modul kann dann in anderen Skripten eingebunden werden:</div><div class="pre"><div data-attribute-id="e5c1166c-6736-4f17-b809-209fe526fb60d6e34" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="8db969a2-9282-4025-8369-9e081f7da5f6" contenteditable="true">import module namespace common = "https://www.tekturcms.de/common" at "common.xqy";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d3d6ab20-364a-45c0-b0fa-e2e4578331bcd6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="efb63e63-1e35-4254-9a57-17184665c31d" contenteditable="true">Funktionen und Variablen werden dann mir dem Namespace<span class="bracket-tags-marker" id="e9d5debc-635f-41cf-820f-4dbda6316dc7">[[<span class="bracket-tags">xe1:XML Konstrukte;xe2:Namespaces</span>]]</span> geprefixt aufgerufen:</div><div class="pre"><div data-attribute-id="9167bb82-6907-48e2-a313-522865965409d6e38" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="07ad6796-3a41-4597-a0b8-8791995c7711" contenteditable="true">Funktionsaufruf: common:wrap-response-header(...)
Variablenauswertung: $common:collection-books</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="cff9beea-d8d8-4684-b063-a0a08af3ece0" contenteditable="true"></div></div></div></div>