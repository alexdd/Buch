<div data-attribute-id="51a4584a-9a43-4f8f-ad89-d1c2d88ab6e6" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="f00858da-e3d4-490d-baad-8dd0b53c482b"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="9c13d213-40d3-4e74-b343-23cc42779c6d" class="title pmarker tags" data-element="title" data-tektur-editor-id="67b34a11-47c6-4874-85bf-4df7fc270f2a" contenteditable="true">Funktionen und Module  </div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="164e317c-0ce8-49e9-a612-28cb64b024f3"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="29b6a82b-7e75-4b7a-9cc5-708103a1b232" contenteditable="true"></div></div><div data-attribute-id="55287d31-0b28-41fc-a844-f9f51bdf389d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="3119b390-c923-4266-b5d0-67f7da7ef2bc"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="ac230209-a134-4cd3-ba2f-1f4894c0a415"><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="dd06eff1-a25a-4e91-9ae0-9a27acf5316d" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="54afa46e-92d8-4073-8d07-7ae2ae1821a5"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="2b09a4f1-af09-482e-b220-bbaa5e4f0897d6e5" class="title pmarker tags" data-element="title" data-tektur-editor-id="af6370fc-f385-4a6f-b134-2588beac82a2" contenteditable="true">Funktionen</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5de561e1-87c3-4f46-b36e-c5db56d9ae27d6e7" class="p pmarker tags" data-element="p" data-tektur-editor-id="fd8a3ce8-eff2-4d64-bc51-e079afe1952d" contenteditable="true">Um bestimmte Abschnitte des XQuery Programm wiederverwendbar zu machen, stehen Funktionsdeklarationen<span class="bracket-tags-marker" id="9257e559-a70d-493f-aa81-9619d8b7c4a2">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Funktionen</span>]]</span> zur verfügung. Eine einfache Funktion wäre z.B. diese hier:</div><div class="pre"><div data-attribute-id="b928a744-59b9-4a4f-825a-fd61c1d8290dd7e9" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="384eb069-5180-413b-a9c3-8dfc38c668c5" contenteditable="true">declare function local:wrap-header($json) {
  xdmp:add-response-header("Pragma", "no-cache"),
  xdmp:add-response-header("Cache-Control", "no-cache"),
  xdmp:add-response-header("Expires", "0"),
  xdmp:set-response-content-type('text/json; charset=utf-8'),
  $json
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="285caf33-98eb-4945-acad-961bc509ce0cd6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="c1cb23f5-54e8-4243-828e-74f20b907273" contenteditable="true">Sie wickelt um einen JSON String eine passende Header Information.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="df24cc6b-17ff-486d-827c-9cec00d4a33bd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="bc3a291f-25ed-46bc-94d5-143057009d48" contenteditable="true">Damit die Funktion eingebunden werden kann, muss ein passender Namespace<span class="bracket-tags-marker" id="852d735e-ca31-4463-87b3-8f3240c377dd">[[<span class="bracket-tags">xe1:XML Konstrukte;xe2:Namespaces</span>]]</span> deklariert werden:</div><div class="pre"><div data-attribute-id="b61f43cd-712a-4f2a-86cc-d6d1e52b2892d7e15" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="7810d652-af05-4e26-a3f2-d0d5165d2f59" contenteditable="true">declare namespace local = 'local:';</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc7c92a6-2eae-47e2-973b-904415f3fc0ed6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="e079cdb5-567f-44f0-864f-22102223c248" contenteditable="true">Nicht nur bzgl. Wiederverwendbarkeit sind Funktionen praktisch, sondern auch
um ganz elementare Konstrukte, wie <span class="bracket-tags-marker" id="13170ec4-c4ed-40df-bd98-0d77630cc3a2">[[<span class="bracket-tags">code:while...do</span>]]</span><span class="bracket-tags-marker" id="1c2caeea-60d4-460a-92cc-a16514ee16a5">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Schleifen - while..do</span>]]</span> Schleifen, zu realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6ec7b350-f2e7-4922-9e96-9c12fd07957ad6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="7b3e3ec7-cf88-4c11-ac50-8645302caace" contenteditable="true">Dazu nutzt man, wie in der funktionalen Programmierung üblich, die Rekursion:</div><div class="pre"><div data-attribute-id="fbb8a01b-99cb-436b-b525-364e4cd3c4cad7e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="93736fba-0647-41ff-8fb7-a7982e9ecb2b" contenteditable="true">declare function local:ist-letzter-wert-in-kette($glied) {
  let $wert := local:komplizierte-berechnung($glied),
    $naechstes-glied := local:komplizierte-berechnung-der-position($glied),
  return
    if ($naechstes-glied and not($wert = 'foobar')) then
      local:durchlaufe-kette($naechstes-glied)
    else
      $wert = 'foobar'
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="844b5256-5000-436c-bca3-c8f1c31f3ffed6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="c651d2b9-e873-4224-885c-451d462c3223" contenteditable="true">In diesem kleinen Schnippsel sind schon einige Besonderheiten von 
XQuery zu sehen. Variablenzuweisungen geschehen mit einem Doppelpunkt,
Vergleiche dagegen nur mit einem einfachen "=". Statements werden mit einem
Komma getrennt.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="def969de-51fb-4b0b-99c1-1b165889cb66"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="dab65cd2-0eb9-4487-99e0-07422d3c3759d6e26" class="title pmarker tags" data-element="title" data-tektur-editor-id="9836054a-c442-4bcd-854c-478a979b4102" contenteditable="true">Module</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="2cc3effd-16fe-42c0-9fbd-bfa92cb6d10bd6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="cc7c65b5-53c3-4567-b4a9-9f290df4e0bf" contenteditable="true">Um eine XQuery Anwendung zu modularisieren<span class="bracket-tags-marker" id="260b6504-c5ee-4fa9-9af7-b1f4bb9b141d">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Module</span>]]</span>, können einzelne Skripte in
Module ausgelagert werden. Ein Modul, z.B. common.xqy, wird dabei über einen eigenen
Namespace deklariert:</div><div class="pre"><div data-attribute-id="ad8b2810-5407-44d7-9e8c-1413f3aa07ced7e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="13a412db-6a01-44b2-ab31-e02646a98337" contenteditable="true">module namespace common = "https://www.tekturcms.de/common";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86f1276d-3550-4da6-887d-58012231ea7cd6e32" class="p pmarker tags" data-element="p" data-tektur-editor-id="62e85d75-c95d-420c-9dcd-c37a6be50ba8" contenteditable="true">Dieses Modul kann dann in anderen Skripten eingebunden werden:</div><div class="pre"><div data-attribute-id="5ceda42f-4617-4275-addb-c1ef28d9012cd7e34" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="c800ed31-3b55-4633-b01b-33f3a561e923" contenteditable="true">import module namespace common = "https://www.tekturcms.de/common" at "common.xqy";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d3d6ab20-364a-45c0-b0fa-e2e4578331bcd6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="f49fe84c-a04f-4580-a85e-46da417ad59d" contenteditable="true">Funktionen und Variablen werden dann mir dem Namespace<span class="bracket-tags-marker" id="fd9dad7c-5bb5-4999-ab21-00b4a9f127aa">[[<span class="bracket-tags">xe1:XML Konstrukte;xe2:Namespaces</span>]]</span> geprefixt aufgerufen:</div><div class="pre"><div data-attribute-id="3c7538db-b4ec-4fc6-8f4d-a762ebf914d3d7e38" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="6ad8db21-7dee-44fc-88a4-e8716791ca08" contenteditable="true">Funktionsaufruf: common:wrap-response-header(...)
Variablenauswertung: $common:collection-books</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="6a14a15b-b3f3-4661-9a65-7cfd8b68a202" contenteditable="true"></div></div></div></div>