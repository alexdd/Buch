<div data-attribute-id="51a4584a-9a43-4f8f-ad89-d1c2d88ab6e6" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="12434c88-3149-4010-8e79-1134ed99622d"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="9c13d213-40d3-4e74-b343-23cc42779c6d" class="title pmarker tags" data-element="title" data-tektur-editor-id="f5c5c0fd-e522-4953-b3fb-809a6bd0186b" contenteditable="true">Funktionen und Module </div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="b52a4e9c-72c0-42e2-a098-25d71f492978"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="05024ccb-a07a-465c-989e-da6b2c82cbcf" contenteditable="true"></div></div><div data-attribute-id="55287d31-0b28-41fc-a844-f9f51bdf389d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="2ed15ad5-0e66-44b6-af1b-ee125c56b694"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="8a05b0ae-f864-468a-affa-f59ac97e1c23"><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="aa7a0de8-0f71-48b8-934a-96408bf93b68" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="1b246dc3-a4e8-4417-9d9b-3d914268473b"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="2b09a4f1-af09-482e-b220-bbaa5e4f0897d6e5" class="title pmarker tags" data-element="title" data-tektur-editor-id="9c519e0b-da7a-4477-85c1-8dbcd1addd84" contenteditable="true">Funktionen</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5de561e1-87c3-4f46-b36e-c5db56d9ae27d6e7" class="p pmarker tags" data-element="p" data-tektur-editor-id="c53003ad-6c4d-43f2-a312-876582b9e679" contenteditable="true">Um bestimmte Abschnitte des XQuery Programm wiederverwendbar zu machen, stehen Funktionsdeklarationen<span class="bracket-tags-marker" id="7143d301-fe2b-418c-981b-e3dfbe72f344">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Funktionen</span>]]</span> zur verfügung. Eine einfache Funktion wäre z.B. diese hier:</div><div class="pre"><div data-attribute-id="5a556200-b5f9-42ab-bd94-02f556c0027ed7e9" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="0f4ae91d-d0ab-476e-906c-4cf126fa51af" contenteditable="true">declare function local:wrap-header($json) {
  xdmp:add-response-header("Pragma", "no-cache"),
  xdmp:add-response-header("Cache-Control", "no-cache"),
  xdmp:add-response-header("Expires", "0"),
  xdmp:set-response-content-type('text/json; charset=utf-8'),
  $json
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="285caf33-98eb-4945-acad-961bc509ce0cd6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="dd86260e-ed8c-4328-a149-8d64b186032d" contenteditable="true">Sie wickelt um einen JSON String eine passende Header Information.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="df24cc6b-17ff-486d-827c-9cec00d4a33bd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="6684d5e2-1edf-40f6-9b3c-d0884e09a37b" contenteditable="true">Damit die Funktion eingebunden werden kann, muss ein passender Namespace<span class="bracket-tags-marker" id="23fe7e57-9fd8-4e83-b3d4-6144abe61c9b">[[<span class="bracket-tags">xe1:XML Konstrukte;xe2:Namespaces</span>]]</span> deklariert werden:</div><div class="pre"><div data-attribute-id="559bc9b6-b67d-42c9-b5a7-f5268b795fabd7e15" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="24c53ecd-7f1e-42fd-857f-8911e6d4105e" contenteditable="true">declare namespace local = 'local:';</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc7c92a6-2eae-47e2-973b-904415f3fc0ed6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="5f00359a-c990-4ec4-a8f3-065c6c178172" contenteditable="true">Nicht nur bzgl. Wiederverwendbarkeit sind Funktionen praktisch, sondern auch
um ganz elementare Konstrukte, wie <span class="bracket-tags-marker" id="3187fc55-757e-4b09-8226-996a0f5b1370">[[<span class="bracket-tags">code:while...do</span>]]</span><span class="bracket-tags-marker" id="b7a9f9a9-d301-444d-be4b-147086e6ec64">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Schleifen - while..do</span>]]</span> Schleifen, zu realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6ec7b350-f2e7-4922-9e96-9c12fd07957ad6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="a447189f-430f-489c-9270-edcc621c4009" contenteditable="true">Dazu nutzt man, wie in der funktionalen Programmierung üblich, die Rekursion:</div><div class="pre"><div data-attribute-id="bf5c2eb7-f972-4238-a7f8-0002517ee26ad7e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="33808826-b5b0-4050-b398-fbb1dd31d070" contenteditable="true">declare function local:ist-letzter-wert-in-kette($glied) {
  let $wert := local:komplizierte-berechnung($glied),
    $naechstes-glied := local:komplizierte-berechnung-der-position($glied),
  return
    if ($naechstes-glied and not($wert = 'foobar')) then
      local:durchlaufe-kette($naechstes-glied)
    else
      $wert = 'foobar'
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="844b5256-5000-436c-bca3-c8f1c31f3ffed6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="6030fa87-6a6a-429c-99d5-8bb8d26ccbbe" contenteditable="true">In diesem kleinen Schnippsel sind schon einige Besonderheiten von 
XQuery zu sehen. Variablenzuweisungen geschehen mit einem Doppelpunkt,
Vergleiche dagegen nur mit einem einfachen "=". Statements werden mit einem
Komma getrennt.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="234c89b2-db57-47b2-832c-fa62b567982d"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="dab65cd2-0eb9-4487-99e0-07422d3c3759d6e26" class="title pmarker tags" data-element="title" data-tektur-editor-id="9bf26564-16f1-4abb-b3b9-66da2b7fec0e" contenteditable="true">Module</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="2cc3effd-16fe-42c0-9fbd-bfa92cb6d10bd6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="4f455e77-34bd-42f6-9f9f-43f60f85ee1a" contenteditable="true">Um eine XQuery Anwendung zu modularisieren<span class="bracket-tags-marker" id="23537e8a-8b91-474b-a903-055075bc96b6">[[<span class="bracket-tags">xe1:Programmierkonstrukte;xe2:Module</span>]]</span>, können einzelne Skripte in
Module ausgelagert werden. Ein Modul, z.B. common.xqy, wird dabei über einen eigenen
Namespace deklariert:</div><div class="pre"><div data-attribute-id="8dd2b815-bd5b-45f3-bc0f-0114059a465bd7e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="0c9f1237-eb4a-4d22-adc5-43a4d2bc7317" contenteditable="true">module namespace common = "https://www.tekturcms.de/common";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86f1276d-3550-4da6-887d-58012231ea7cd6e32" class="p pmarker tags" data-element="p" data-tektur-editor-id="dbc9c7d0-4c15-4be8-980f-36d4fce84ecf" contenteditable="true">Dieses Modul kann dann in anderen Skripten eingebunden werden:</div><div class="pre"><div data-attribute-id="02934bcf-c148-4710-a715-c3aa14a77f04d7e34" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="48bd6252-f8dd-4b04-999f-37b2568c3329" contenteditable="true">import module namespace common = "https://www.tekturcms.de/common" at "common.xqy";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d3d6ab20-364a-45c0-b0fa-e2e4578331bcd6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="e5e1e65e-7b9c-460c-80a3-9e2ae1f4f8e8" contenteditable="true">Funktionen und Variablen werden dann mir dem Namespace<span class="bracket-tags-marker" id="4d49f8fb-d2d4-4492-b0b0-2826fdd0661e">[[<span class="bracket-tags">xe1:XML Konstrukte;xe2:Namespaces</span>]]</span> geprefixt aufgerufen:</div><div class="pre"><div data-attribute-id="3099740d-fdd3-4d49-9da9-90423f72be63d7e38" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="1b2a31bc-b953-48b4-8154-a5966a4c2217" contenteditable="true">Funktionsaufruf: common:wrap-response-header(...)
Variablenauswertung: $common:collection-books</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="3023ab16-5c4a-4576-af9a-d87fedec077f" contenteditable="true"></div></div></div></div>