<div data-attribute-id="51a4584a-9a43-4f8f-ad89-d1c2d88ab6e6" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="08f48bed-be3b-4869-9c7e-2624c0af0b53"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="9c13d213-40d3-4e74-b343-23cc42779c6d" class="title pmarker tags" data-element="title" data-tektur-editor-id="fd0102de-1889-4ee8-94fe-b4416f339e3b" contenteditable="true">Funktionen und Module</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="67cfbc79-ced1-4be9-af18-974264fca4b1"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="6a6ae511-e6c1-475c-9e7a-5704ebfd88ab" contenteditable="true"></div></div><div data-attribute-id="55287d31-0b28-41fc-a844-f9f51bdf389d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="df7e4801-23b3-4abd-aded-bcdb24726075"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="278ce4df-7ff1-4f0b-b3fb-38c97496c1a5"><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="de6d3a23-d61c-4889-ba01-c10aaa1596ed" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="28935994-fe69-4fa8-9b2f-9452a703b8a8"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="2b09a4f1-af09-482e-b220-bbaa5e4f0897d6e5" class="title pmarker tags" data-element="title" data-tektur-editor-id="d71c042d-a441-4cef-bc17-aedcb78c581a" contenteditable="true">Funktionen</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5de561e1-87c3-4f46-b36e-c5db56d9ae27d6e7" class="p pmarker tags" data-element="p" data-tektur-editor-id="ff8bb729-841f-4254-a1b4-73044c2a3b61" contenteditable="true">Um bestimmte Abschnitte des XQuery Programm wiederverwendbar zu machen, stehen Funktionsdeklarationen[[xe1:Programmierkonstrukte;xe2:Funktionen]] zur verfügung. Eine einfache Funktion wäre z.B. diese hier:</div><div class="pre"><div data-attribute-id="3f91b0c1-522b-42e3-87c1-28203be9fb93d6e9" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="0d104166-5ea0-4ffa-b767-00b913dd5eeb" contenteditable="true">declare function local:wrap-header($json) {
  xdmp:add-response-header("Pragma", "no-cache"),
  xdmp:add-response-header("Cache-Control", "no-cache"),
  xdmp:add-response-header("Expires", "0"),
  xdmp:set-response-content-type('text/json; charset=utf-8'),
  $json
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="285caf33-98eb-4945-acad-961bc509ce0cd6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="a336660c-03cb-4199-a8d1-b39d425bd006" contenteditable="true">Sie wickelt um einen JSON String eine passende Header Information.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="df24cc6b-17ff-486d-827c-9cec00d4a33bd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="ef3340af-938e-4cd3-a2ab-d2247d595df7" contenteditable="true">Damit die Funktion eingebunden werden kann, muss ein passender Namespace[[xe1:XML Konstrukte;xe2:Namespaces]] deklariert werden:</div><div class="pre"><div data-attribute-id="f2ca56d1-67cd-4667-abd4-d27fef0079c4d6e15" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="9cca0809-6420-474f-9303-6e56a8dad3e9" contenteditable="true">declare namespace local = 'local:';</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc7c92a6-2eae-47e2-973b-904415f3fc0ed6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="38ceb37d-6f4f-456e-b37c-1f3ed63002fd" contenteditable="true">Nicht nur bzgl. Wiederverwendbarkeit sind Funktionen praktisch, sondern auch
um ganz elementare Konstrukte, wie while...do[[xe1:Programmierkonstrukte;xe2:Schleifen - while..do]] Schleifen, zu realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6ec7b350-f2e7-4922-9e96-9c12fd07957ad6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="eaaec02c-6e3b-4956-8e42-5b0cdc399348" contenteditable="true">Dazu nutzt man, wie in der funktionalen Programmierung üblich, die Rekursion:</div><div class="pre"><div data-attribute-id="8138640d-bb0c-41e1-9755-75dfb1d5aeefd6e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="e7fbb16f-0972-46b7-a6b5-e266a509dd0b" contenteditable="true">declare function local:ist-letzter-wert-in-kette($glied) {
  let $wert := local:komplizierte-berechnung($glied),
    $naechstes-glied := local:komplizierte-berechnung-der-position($glied),
  return
    if ($naechstes-glied and not($wert = 'foobar')) then
      local:durchlaufe-kette($naechstes-glied)
    else
      $wert = 'foobar'
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="844b5256-5000-436c-bca3-c8f1c31f3ffed6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="0a6e520c-7355-4574-9ee2-38b9baead8b1" contenteditable="true">In diesem kleinen Schnippsel sind schon einige Besonderheiten von 
XQuery zu sehen. Variablenzuweisungen geschehen mit einem Doppelpunkt,
Vergleiche dagegen nur mit einem einfachen "=". Statements werden mit einem
Komma getrennt.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="9010e0f1-17d9-4303-898f-b0971395314d"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="dab65cd2-0eb9-4487-99e0-07422d3c3759d6e26" class="title pmarker tags" data-element="title" data-tektur-editor-id="77cbb1e0-765e-455c-b074-c7f173a2e909" contenteditable="true">Module</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="2cc3effd-16fe-42c0-9fbd-bfa92cb6d10bd6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="e1f41475-0ffb-499f-ab92-7eef31f99280" contenteditable="true">Um eine XQuery Anwendung zu modularisieren[[xe1:Programmierkonstrukte;xe2:Module]], können einzelne Skripte in
Module ausgelagert werden. Ein Modul, z.B. common.xqy, wird dabei über einen eigenen
Namespace deklariert:</div><div class="pre"><div data-attribute-id="3021cd5b-1834-4550-8add-2662be4d8cefd6e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="7961165f-db84-4c47-bd5e-0cd812c91c02" contenteditable="true">module namespace common = "https://www.tekturcms.de/common";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86f1276d-3550-4da6-887d-58012231ea7cd6e32" class="p pmarker tags" data-element="p" data-tektur-editor-id="150fea3b-5f15-422b-b41b-b96993d5d866" contenteditable="true">Dieses Modul kann dann in anderen Skripten eingebunden werden:</div><div class="pre"><div data-attribute-id="41be8782-55c0-4614-a453-ea34440c47bcd6e34" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="742f1bf0-677f-46fa-abf2-97ddf4bdf8bd" contenteditable="true">import module namespace common = "https://www.tekturcms.de/common" at "common.xqy";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d3d6ab20-364a-45c0-b0fa-e2e4578331bcd6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="a9c78f02-cb5e-48c4-8acf-90f985fcda3a" contenteditable="true">Funktionen und Variablen werden dann mir dem Namespace[[xe1:XML Konstrukte;xe2:Namespaces]] geprefixt aufgerufen:</div><div class="pre"><div data-attribute-id="7317e1c8-af3d-49d1-80d4-91a13a6dcbb8d6e38" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ae5f025e-6b86-4e33-8d6d-b3fc5a238469" contenteditable="true">Funktionsaufruf: common:wrap-response-header(...)
Variablenauswertung: $common:collection-books</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="4a31d553-037c-4368-a969-e6795e737e50" contenteditable="true"></div></div></div></div>