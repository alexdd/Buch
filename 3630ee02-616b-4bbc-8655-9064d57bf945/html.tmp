<div data-attribute-id="51a4584a-9a43-4f8f-ad89-d1c2d88ab6e6" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="04cbf5e5-bbf1-410b-aa2f-ab4afa278f61"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="9c13d213-40d3-4e74-b343-23cc42779c6d" class="title pmarker tags" data-element="title" data-tektur-editor-id="3b4de58d-7eb5-4f30-8aa3-7f8dff03d188" contenteditable="true">Erweiterte Konstrukte</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="ffa63ef7-78af-441b-9202-3f78d1bb0bdf"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="3e177efc-17cc-43a3-bcff-99ef60e4744d" contenteditable="true"></div></div><div data-attribute-id="55287d31-0b28-41fc-a844-f9f51bdf389d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="af863b1b-e3f2-439e-8dc7-d8c1c4c3215c"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="92295a82-9096-4b8a-a7e8-251b0cf87730"><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="0ba593a3-08f7-40d6-bb66-a5ff41aafe72" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="387b64f2-9bfb-4399-84db-b36473ebb1ce"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="2b09a4f1-af09-482e-b220-bbaa5e4f0897d6e5" class="title pmarker tags" data-element="title" data-tektur-editor-id="8f526895-11d6-4149-bd83-718a54deef92" contenteditable="true">Funktionen</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5de561e1-87c3-4f46-b36e-c5db56d9ae27d6e7" class="p pmarker tags" data-element="p" data-tektur-editor-id="39389aae-fc93-47e0-a35c-1735f3f0d3be" contenteditable="true">Um bestimmte Abschnitte des XQuery Programm wiederverwendbar zu machen, stehen Funktionsdeklarationen[[xe1:Programmierkonstrukte;xe2:Funktionen]] zur verfügung. Eine einfache Funktion wäre z.B. diese hier:</div><div class="pre"><div data-attribute-id="95f7e27f-435a-4148-ad4b-3bd1eba606b5d6e9" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="b66125f4-c3d2-48fc-a232-dbe6c3510654" contenteditable="true">declare function local:wrap-header($json) {
  xdmp:add-response-header("Pragma", "no-cache"),
  xdmp:add-response-header("Cache-Control", "no-cache"),
  xdmp:add-response-header("Expires", "0"),
  xdmp:set-response-content-type('text/json; charset=utf-8'),
  $json
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="285caf33-98eb-4945-acad-961bc509ce0cd6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="417536c1-d613-4ec2-8c90-181dda356a13" contenteditable="true">Sie wickelt um einen JSON String eine passende Header Information.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="df24cc6b-17ff-486d-827c-9cec00d4a33bd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="8ccffaef-5f0d-4f79-9490-166050e877b6" contenteditable="true">Damit die Funktion eingebunden werden kann, muss ein passender Namespace[[xe1:XML Konstrukte;xe2:Namespaces]] deklariert werden:</div><div class="pre"><div data-attribute-id="fd81cc2d-caf6-445b-9540-5d229bafe677d6e15" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="551668ca-8e85-413b-8090-6e6ab5accfd5" contenteditable="true">declare namespace local = 'local:';</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc7c92a6-2eae-47e2-973b-904415f3fc0ed6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="39e222e9-b005-4999-93e9-ce920552d398" contenteditable="true">Nicht nur bzgl. Wiederverwendbarkeit sind Funktionen praktisch, sondern auch
um ganz elementare Konstrukte, wie while...do[[xe1:Programmierkonstrukte;xe2:Schleifen - while..do]] Schleifen, zu realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6ec7b350-f2e7-4922-9e96-9c12fd07957ad6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="f6982ec1-c9cb-4352-baf0-c0f59266b7c9" contenteditable="true">Dazu nutzt man, wie in der funktionalen Programmierung üblich, die Rekursion:</div><div class="pre"><div data-attribute-id="db464df5-ee18-4441-bf34-b9cfe79c96fbd6e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="4827ec65-e642-40f9-8cd6-9a6c4004ab49" contenteditable="true">declare function local:ist-letzter-wert-in-kette($glied) {
  let $wert := local:komplizierte-berechnung($glied),
    $naechstes-glied := local:komplizierte-berechnung-der-position($glied),
  return
    if ($naechstes-glied and not($wert = 'foobar')) then
      local:durchlaufe-kette($naechstes-glied)
    else
      $wert = 'foobar'
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="844b5256-5000-436c-bca3-c8f1c31f3ffed6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="e57ebd69-a325-4a14-8c4c-7499f039b4d9" contenteditable="true">In diesem kleinen Schnippsel sind schon einige Besonderheiten von 
XQuery zu sehen. Variablenzuweisungen geschehen mit einem Doppelpunkt,
Vergleiche dagegen nur mit einem einfachen "=". Statements werden mit einem
Komma getrennt.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="5c0f228c-429d-405a-88ec-37076fb05b4c"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="dab65cd2-0eb9-4487-99e0-07422d3c3759d6e26" class="title pmarker tags" data-element="title" data-tektur-editor-id="6d5d4817-2a30-49d5-b639-44e7d2f5fd58" contenteditable="true">Module</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="2cc3effd-16fe-42c0-9fbd-bfa92cb6d10bd6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="4dca13f8-016c-4f90-a0bf-0acc3dfdcf78" contenteditable="true">Um eine XQuery Anwendung zu modularisieren[[xe1:Programmierkonstrukte;xe2:Module]], können einzelne Skripte in
Module ausgelagert werden. Ein Modul, z.B. common.xqy, wird dabei über einen eigenen
Namespace deklariert:</div><div class="pre"><div data-attribute-id="306d0304-1626-44ff-9432-24fbceb8b42ed6e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="73d627e1-e517-4299-92e5-53d25633715d" contenteditable="true">module namespace common = "https://www.tekturcms.de/common";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86f1276d-3550-4da6-887d-58012231ea7cd6e32" class="p pmarker tags" data-element="p" data-tektur-editor-id="6fadb097-558b-47ba-98e4-06bfcae9359b" contenteditable="true">Dieses Modul kann dann in anderen Skripten eingebunden werden:</div><div class="pre"><div data-attribute-id="0c007540-ba2d-4437-a1f0-2df31f24d737d6e34" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="c899cecc-ab47-4c9a-a220-9eeec627b002" contenteditable="true">import module namespace common = "https://www.tekturcms.de/common" at "common.xqy";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d3d6ab20-364a-45c0-b0fa-e2e4578331bcd6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="98615113-6025-4c3d-b703-e73461cb042f" contenteditable="true">Funktionen und Variablen werden dann mir dem Namespace[[xe1:XML Konstrukte;xe2:Namespaces]] geprefixt aufgerufen:</div><div class="pre"><div data-attribute-id="4d018451-f149-40ef-a56d-f20859695882d6e38" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="4ce5a7d8-772f-47d1-8e95-9dc08e46fa74" contenteditable="true">Funktionsaufruf: common:wrap-response-header(...)
Variablenauswertung: $common:collection-books</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="1e1e0ee3-0461-493d-b7cd-3f88f5d8e76f" contenteditable="true"></div></div></div></div>