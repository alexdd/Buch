<div data-attribute-id="51a4584a-9a43-4f8f-ad89-d1c2d88ab6e6" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="601ecd11-2df6-46d5-bf09-e4b6c48a3c0c"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="9c13d213-40d3-4e74-b343-23cc42779c6d" class="title pmarker tags" data-element="title" data-tektur-editor-id="cc1ccb37-56a3-4e0f-9d09-d70556bcb910" contenteditable="true">Funktionen und Module</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="ea03b66d-00ed-453d-a7a6-500cdd95cce7"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="8b0383c5-a4f8-445e-9f3c-92078d0e34d7" contenteditable="true"></div></div><div data-attribute-id="55287d31-0b28-41fc-a844-f9f51bdf389d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="d030a267-c8db-427c-b170-cba1a436a27a"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="64364ad5-a936-4fb9-b7c4-9e9b32c016e8"><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="2af7f6df-00e0-4b9b-ba31-15ec8165215c" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="9c78dbf1-5e78-4343-a85e-c2b661156884"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="2b09a4f1-af09-482e-b220-bbaa5e4f0897d6e5" class="title pmarker tags" data-element="title" data-tektur-editor-id="5e00e520-c7a1-4bd7-942d-82dec9210adf" contenteditable="true">Funktionen</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5de561e1-87c3-4f46-b36e-c5db56d9ae27d6e7" class="p pmarker tags" data-element="p" data-tektur-editor-id="588db5ce-c993-4d09-b1bd-edd0fb0c47bd" contenteditable="true">Um bestimmte Abschnitte des XQuery Programm wiederverwendbar zu machen, stehen Funktionsdeklarationen[[xe1:Programmierkonstrukte;xe2:Funktionen]] zur verfügung. Eine einfache Funktion wäre z.B. diese hier:</div><div class="pre"><div data-attribute-id="6a99b08f-7068-4667-92ef-9eade07b2848d6e9" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="90fd199a-b35d-469d-8373-f63f54639f56" contenteditable="true">declare function local:wrap-header($json) {
  xdmp:add-response-header("Pragma", "no-cache"),
  xdmp:add-response-header("Cache-Control", "no-cache"),
  xdmp:add-response-header("Expires", "0"),
  xdmp:set-response-content-type('text/json; charset=utf-8'),
  $json
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="285caf33-98eb-4945-acad-961bc509ce0cd6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="421fd862-ec43-4749-9af8-7785a1f7e748" contenteditable="true">Sie wickelt um einen JSON String eine passende Header Information.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="df24cc6b-17ff-486d-827c-9cec00d4a33bd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="d20698ca-8ebc-4193-a2dd-e49912f98e05" contenteditable="true">Damit die Funktion eingebunden werden kann, muss ein passender Namespace[[xe1:XML Konstrukte;xe2:Namespaces]] deklariert werden:</div><div class="pre"><div data-attribute-id="0ae27285-ed77-46bb-b7e4-05388a6346a7d6e15" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="a4a132bc-68ef-4ef7-86a4-3c65b8547dc8" contenteditable="true">declare namespace local = 'local:';</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc7c92a6-2eae-47e2-973b-904415f3fc0ed6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="ec6bd60a-8b4b-452c-aef3-382ce81c1e43" contenteditable="true">Nicht nur bzgl. Wiederverwendbarkeit sind Funktionen praktisch, sondern auch
um ganz elementare Konstrukte, wie [[code:while...do]][[xe1:Programmierkonstrukte;xe2:Schleifen - while..do]] Schleifen, zu realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6ec7b350-f2e7-4922-9e96-9c12fd07957ad6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="3541e849-050c-499f-a26b-b27a5ce4bcbf" contenteditable="true">Dazu nutzt man, wie in der funktionalen Programmierung üblich, die Rekursion:</div><div class="pre"><div data-attribute-id="2347ee77-244b-4c5b-abb5-9181d8309c8ed6e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="609873f5-5e2e-43a5-822a-28a4db43ef08" contenteditable="true">declare function local:ist-letzter-wert-in-kette($glied) {
  let $wert := local:komplizierte-berechnung($glied),
    $naechstes-glied := local:komplizierte-berechnung-der-position($glied),
  return
    if ($naechstes-glied and not($wert = 'foobar')) then
      local:durchlaufe-kette($naechstes-glied)
    else
      $wert = 'foobar'
};</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="844b5256-5000-436c-bca3-c8f1c31f3ffed6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="38198dc3-e7a8-4842-908b-3f098b2edfa7" contenteditable="true">In diesem kleinen Schnippsel sind schon einige Besonderheiten von 
XQuery zu sehen. Variablenzuweisungen geschehen mit einem Doppelpunkt,
Vergleiche dagegen nur mit einem einfachen "=". Statements werden mit einem
Komma getrennt.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="072e9a0f-ef15-4a3b-8e3f-84be5892fee1"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="dab65cd2-0eb9-4487-99e0-07422d3c3759d6e26" class="title pmarker tags" data-element="title" data-tektur-editor-id="cbeb5069-c4e9-479d-9e02-851587350cba" contenteditable="true">Module</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="2cc3effd-16fe-42c0-9fbd-bfa92cb6d10bd6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="43100123-5ee7-4346-a4cd-eee7b551adb9" contenteditable="true">Um eine XQuery Anwendung zu modularisieren[[xe1:Programmierkonstrukte;xe2:Module]], können einzelne Skripte in
Module ausgelagert werden. Ein Modul, z.B. common.xqy, wird dabei über einen eigenen
Namespace deklariert:</div><div class="pre"><div data-attribute-id="02031ab0-91ee-440e-835b-3d6608d1a144d6e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="947bc1d4-84cb-4564-9e6e-679a345747fd" contenteditable="true">module namespace common = "https://www.tekturcms.de/common";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86f1276d-3550-4da6-887d-58012231ea7cd6e32" class="p pmarker tags" data-element="p" data-tektur-editor-id="a5eb57a7-e9dd-4410-939d-a52e062937fc" contenteditable="true">Dieses Modul kann dann in anderen Skripten eingebunden werden:</div><div class="pre"><div data-attribute-id="2a8f6b2a-3844-49da-9472-6b95e3d93e67d6e34" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="75c7984b-01c3-4d5f-a893-38cf46196a5d" contenteditable="true">import module namespace common = "https://www.tekturcms.de/common" at "common.xqy";</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d3d6ab20-364a-45c0-b0fa-e2e4578331bcd6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="fa688acc-b752-488d-9658-278aaedf60bd" contenteditable="true">Funktionen und Variablen werden dann mir dem Namespace[[xe1:XML Konstrukte;xe2:Namespaces]] geprefixt aufgerufen:</div><div class="pre"><div data-attribute-id="185df16e-ce8d-46ac-a5ed-cba031e7cf10d6e38" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="3fc088c9-0a3d-49a5-a06a-2fe6347a98d5" contenteditable="true">Funktionsaufruf: common:wrap-response-header(...)
Variablenauswertung: $common:collection-books</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="996223a7-17f4-44df-a714-ed409be4cfd7" contenteditable="true"></div></div></div></div>