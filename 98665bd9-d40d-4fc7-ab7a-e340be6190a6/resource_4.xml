<?xml version="1.0" encoding="UTF-8"?><topic id="06abe1b7-21be-4794-bec6-c28732cf6cbf"><title id="8c5a4500-d080-4910-b4cd-529caeb12ae3">XQuery als Programmiersprache</title><body id="ae4f3c4a-54be-4671-bba8-047bdf24b1d7"><p id="1e9a3c95-15bd-4eb0-89b8-59c8784a5425">Erste Schritte in XQuery gehen sehr schön  
mit der Query Konsole auf dem Marklogic Server (Port 8000).
Hat man parallel auch noch oXygen offen, kann man die Testergb</p><p id="66dfae66-ebc6-49c6-bf7a-a85664100f56d6e6">nisse
aus der Konsole direkt in ein XQuery Server Skript packen.dwawqdqd</p><ul id="1e0a0cf2-e74e-411c-8458-29d8e7611d2ad6e8"><li id="eaf90f61-7ae4-43a7-b3fa-2d07bd675854d6e9"><p id="e2e7007e-a048-42e0-8ac1-7b8dd8384cf4d6e10">ewwqeqe</p></li><li id="024e6e0c-cfc0-4e77-8414-35ffde4257add6e12"><p id="4b891b85-6b50-4aec-b1f2-4e0e084af6e3d6e13">qweqwe</p></li><li id="22dbe7ec-f3d8-47ac-bd16-bd771b414d03d6e15"><p id="72aa1fb8-3b73-4976-abf5-770fef2535a7d6e16">qweqeq</p></li></ul><p id="8d8cb926-923a-458c-909f-85a071780f3bd6e18">wqdqwd</p><section id="c874646f-3e3f-46a2-a222-3dd89b986867d6e20"><title id="fa1956ff-e468-4fb8-99dc-1a7a8f773707d6e7">Schleifen</title><p id="5fdff6dd-6c8a-467c-880d-33c88f7de0ded6e9">Die ersten 10 Dokumente auf dem Server bekommt man z.B. mit:[[xe1:Programmierkonstrukte;xe2:Schleifen - for]]</p><pre id="17476a89-1a6d-4a17-a27e-a00ece2f4c95d6e25" xml:space="preserve">(doc())[position() lt 11]</pre><p id="b3785b18-f654-4483-85a6-bdbb21caa0e1d6e13">Die Zahlen von 1 bis 100 mit:</p><pre id="bb124584-50fa-4ac7-aeb5-2b8eb2b9342cd6e29" xml:space="preserve">(for $i in (1 to 100) return $i)</pre><p id="7558c943-b4af-4b14-acf0-fc84efcebb90d6e17">Wenn man diese beide Anweisungen untereinander in die Konsole
schreibt bekommt man einen Fehler. Trennt man sie mit einem 
Komma - ein Tupel wird erzeugt - dann klappt es.</p></section><section id="4c75cabe-720e-4d9d-9958-9891ad3a2447d6e33"><title id="0bbb962d-b38e-431a-855a-294425a5a016d6e20">Dokumente in der DB anlegen</title><p id="68e15e0c-efc5-472f-87fe-4d2dd4352485d6e22">Der Befehl zum Anlegen eines Dokuments in der Marklogic DB sieht
folgendermassen aus[[fn:https://docs.marklogic.com/xdmp:document-insert]]:[[xe1:Programmierkonstrukte;xe2:DB insert]]</p><pre id="4224a0b9-d026-40c2-9e8a-0c072ac683e1d6e38" xml:space="preserve">xdmp:document-insert(
  "/alex-test/example-alex.xml",
  &lt;root&gt;Hier steht der Content&lt;/root&gt;, 
  &lt;options xmlns="xdmp:document-insert"&gt;  
    &lt;metadata&gt;{
      map:map() =&gt; map:with("valid-start", "2014-06-03T14:13:05.472585-07:00")
      =&gt; map:with("valid-end", "9999-12-31T11:59:59Z")
      }&lt;/metadata&gt;
  &lt;/options&gt;)</pre><p id="0db3e46f-54fa-4858-b85d-ad36ded2bf2ad6e26">Packt man diese Instruktion in die for-Schleife oben, dann sieht das Konstrukt so aus:</p><pre id="29c37393-6206-4b1d-bb68-8a635c2d313bd6e42" xml:space="preserve">(for $i in (1 to 10) return 
  xdmp:document-insert(
  concat("/alex-test/example-alex-",$i,".xml"),
  &lt;root&gt;Hier steht der Content {$i}&lt;/root&gt;, 
  &lt;options xmlns="xdmp:document-insert"&gt;  
    &lt;metadata&gt;{
      map:map() =&gt; map:with("valid-start", "2014-06-03T14:13:05.472585-07:00")
      =&gt; map:with("valid-end", "9999-12-31T11:59:59Z")
      }&lt;/metadata&gt;
  &lt;/options&gt;)
)</pre><p id="ccd162ef-82c4-45f2-8a4d-a72e51647514d6e30">Dokumente kann man einer Collection[[xe1:Programmierkonstrukte;xe2:DB Collection]] zuweisen, um sie leichter finden und auswerten
zu können. Das geht mit dem folgenden Befehl[[fn:https://docs.marklogic.com/xdmp:document-add-collections*MarkLogic ist eine kommerzielle NoSQL/XML Enterprise Datenbank]] und diesem Schnippsel:</p><pre id="73a09d21-0ace-4086-b1a0-dc3e9a204263d6e46" xml:space="preserve">let $root :=
&lt;mein-test&gt;
   &lt;id&gt;{$id}&lt;/id&gt;
   &lt;content&gt;Hallo Welt!&lt;/content&gt;
&lt;/mein-test&gt;,
$options :=
&lt;options xmlns="xdmp:document-insert"&gt;  
  &lt;permissions&gt;{xdmp:default-permissions()}&lt;/permissions&gt;
  &lt;collections&gt;
    &lt;collection&gt;/alex-test&lt;/collection&gt;
  &lt;/collections&gt;
&lt;/options&gt;,
$fname := concat('/',$id,'_','.xml'),
$td := xdmp:document-insert($fname,$root,$options)
return 
  [...]</pre><p id="089d273b-a358-45a2-857e-181948135159d6e34">Die Dokumente, die mit der Collection alex-test getaggt wurden, kann man sich mit der folgenden Schleife ausgeben lassen:</p><pre id="43b0caa8-91f3-4d9e-bd3a-e199cf3eccf6d6e50" xml:space="preserve">for $x in collection("/alex-test")
  return
    fn:document-uri($x)</pre></section></body></topic>