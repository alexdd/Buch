<div data-attribute-id="ae325776-f861-42c4-9a68-95d2d1c756a5" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="821af612-f84e-45fd-8519-dc1548db0426"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="0e661463-0259-4d9f-a784-93f4f169bc52" class="title pmarker tags" data-element="title" data-tektur-editor-id="decea426-5c2e-43b8-9030-92768ed5df26" contenteditable="true">Abfragen mit XQuery</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="5c9ae593-3fbf-4b93-a057-06ea98f65723"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="c5d2b6f9-a0ec-4818-a340-7212b35d8cb4" contenteditable="true"></div></div><div data-attribute-id="09f76c76-f17f-41fd-a303-1d0812cb6e21" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="0d9fb369-42bf-433e-829b-83c4ca8ed6b2"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="069fe8c8-2983-40dc-bb58-744246377824"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c2687f09-7480-4b8a-aa85-97d3e6821592" class="p pmarker tags" data-element="p" data-tektur-editor-id="851faa47-d6eb-4568-9986-c352423d7d6c" contenteditable="true">Xquery[[xe1:Programmiersprachen;xe2:XQuery]] führt im Publishing-Bereich ein Schattendasein. In meiner Zeit als XSL Programmierer für zwei Publishing  Firmen hatte ich damit nie zu tun. Erst als ich näher an den eigentlichen Daten war und mit XML Datenbanken zu tun hatte, kam ich mit XQuery in Berührung.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="68844713-b2c6-475e-8649-74c9094a4533d6e6" class="p pmarker tags" data-element="p" data-tektur-editor-id="4a95873a-5c64-42d6-99c4-8e0ce13ef11d" contenteditable="true">Während relationale Datenbanken mit SQL abgefragt werden, verwendet man bei XML Datenbanken, wie eXist[[fn:http://exist-db.org/exist/apps/homepage/index.html*Hompage der eXist XML Datenbank]] oder Marklogic[[fn:https://de.marklogic.com/*Hompage der NoSQL/XML Datenbank MarkLogic]], XQuery als Abfragesprache.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="beb7e5e2-4c9d-4fc8-b536-7f06da326062d6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="0054243e-6499-4ee1-acac-50efafc9d421" contenteditable="true">Aber auch einzelne XML Dokumente können z.B. in Oxygen XML Editor[[xe1:Tools;xe2:oXygen XML Editor]] mit dem XQuery Builder Tool[[fn:https://www.oxygenxml.com/xml_editor/xquery_builder.html*Tool zur einfachen Eingabe von XQuery Test-Skripten im oXygen XML Editor]] oder auch per Saxon Kommandozeile abgefragt werden:</div><div class="pre"><div data-attribute-id="5621673c-47d4-4e38-99ed-dcbb214ec93ad6e10" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="8dfe2d09-612d-4abc-931a-eadc5e876157" contenteditable="true">java -cp usr/lib/saxon/saxon.jar net.sf.saxon.Query 
     -s:"schulen.xml" 
     -qs:"/schulen/schule[id='6']" 
     -o:"/Users/Alex/Desktop/schule_6.xml"</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="82bd2bc8-d52c-4012-85f5-f167da7f8dc4d6e12" class="p pmarker tags" data-element="p" data-tektur-editor-id="e58c5d49-bc20-4a19-88aa-2051c91a4339" contenteditable="true">Mit der Option <span data-attribute-id="03edacb3-4ba0-4dd4-b0a7-0cfd1ee296f0d6e14" data-attribute-href="undefined" class="b tags" data-element="b" data-tektur-editor-id="5767e8ff-bc8b-409c-8e06-10cc6112c8f5">-qs </span>kann hier der Querystring angebenen werden. </div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="a1ae2cee-3b1d-4919-8531-d42c03a501f2d6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="f9b54805-d044-4bb2-b5df-ed1cb71bdf62" contenteditable="true">Wie man an dem einfachen Beispiel schon sieht, ist XQuery mit XPATH verwandt. XQuery umfasst den Sprachumfang von XPATH bietet aber zusätzlich die FLOWR[[https://en.wikipedia.org/wiki/FLWOR*FLOWR steht für FOR LET WHERE ORDERBY RETURN]] Syntax um mächtigere Abfragen stellen zu können. Mittels weiterer Extensions[[fn:http://cs.au.dk/~amoeller/XML/querying/flwrexp.html*XQuery Extensions für mächtigere Funktionen]] können aber auch ganze Programme erstellt werden, die weit über die Funktionalität einer "Abfragesprache" hinausgehen.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="0ebb8e54-4ece-48b1-a442-ab6d68939120"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="c7e8acb5-6c21-4de1-a88d-8bbd376bbbb4d6e20" class="title pmarker tags" data-element="title" data-tektur-editor-id="ef6c09ab-d9e8-4a09-995a-28a159e417fb" contenteditable="true">XQuery Builder</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="10cad5f2-85f8-44a2-820b-25080e044176d6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="c065a565-c802-4390-8d34-06b8e044f8d5" contenteditable="true">Oxygen XML Editor bietet eine schöne Möglichkeit XQuery-Abfragen 
auf einem geladenen XML Dokument auszuführen. Dazu kann man 
seine Query in das betreffende Eingabefenster schreiben.</div><div data-attribute-id="c84dd02b-4b5d-4f0d-894f-57a584b3568fd6e24" class="fig show_menu tags" data-element="fig" data-tektur-editor-id="244d5a39-3414-4228-bbb8-568023771279"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="desc optional pmarker tags" data-element="desc" data-tektur-editor-id="c9f631af-e0ed-4e17-9e39-25a0c48f08ea" contenteditable="true">Mit dem XQuery Builder von oXygen lassen sich unkompliziert Queries testen</div><div class="image tags" data-element="image" style="display:none" data-attribute-id="c6f2a512-795c-4fb9-b83f-852a77c30331d6e29" data-attribute-href="xquery-builder.png" data-tektur-editor-id="c636e930-40d3-44da-990d-e6c3f79dac7a"></div><div class="title optional pmarker tags" data-element="title" data-tektur-editor-id="8a22979b-1ef1-4738-8a77-d14214caa72e" contenteditable="true">oXygen XQuery Builder</div><table class="legend optional show_menu tags" data-element="legend" width="100%" style="display:none" data-tektur-editor-id="c66c0b00-53a7-4207-9d0e-ac202316594f"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><tbody><tr class="legentry tags" data-element="legentry" data-tektur-editor-id="87d1fbab-f8e9-42ba-bd56-8e142e675c43"><td valign="top" class="leg-pos tags" data-element="leg-pos" width="10%" data-tektur-editor-id="bbf3e489-219b-4d25-853d-9f8fc7ac1594"><div class="pmarker placeholder text tags" data-element="p" data-tektur-editor-id="9c018459-9e5e-437c-b238-e6d371037176" contenteditable="true"></div></td><td valign="top" class="leg-name tags" data-element="leg-name" width="90%" data-tektur-editor-id="3ea9ebc0-6703-49d2-8b26-7b73e775fe7a"><div class="pmarker placeholder text tags" data-element="p" data-tektur-editor-id="172df514-d70b-49a1-8a4d-e015b7e67e69" contenteditable="true"></div></td></tr></tbody></table></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="f9cd5153-7930-46ee-9bfd-33e14ec55f03d6e28" class="p pmarker tags" data-element="p" data-tektur-editor-id="54d81314-9440-45a1-9e8c-51acc5e391c1" contenteditable="true">Mit folgendem Ergebnis:</div><div class="pre"><div data-attribute-id="ff858f33-2ac2-4e37-9d0d-88cc903d2880d6e32" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="a5a377ed-c602-452a-ac18-d611d7acf794" contenteditable="true">&#x3C;dates&#x3E;
  &#x3C;today&#x3E;2019-01-16+01:00&#x3C;/today&#x3E;
  &#x3C;formatted&#x3E;Wednesday, 16th January 2019&#x3C;/formatted&#x3E;
&#x3C;/dates&#x3E;</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="e1d198b9-b09b-47d2-9edd-2faea2f1b866" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="d63adde6-ce58-4977-94b4-277696dd5b92"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="59f98501-17c8-47d7-a314-8f89c6b7299ed6e33" class="title pmarker tags" data-element="title" data-tektur-editor-id="f800810f-9bb9-46a4-93fb-2df24a794c54" contenteditable="true">FLOWR Expression</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d9c7b63e-5eb8-4c1a-8efb-88af290b55bfd6e34" class="p pmarker tags" data-element="p" data-tektur-editor-id="c38c9437-e646-4935-ba79-4e4fe8e303e0" contenteditable="true">FLOWR[[xe1:FLOWR Expression]] steht für [[code:for, let, where, order by, return]]. Das sind die Query-Anweisungen, die in 
dem Ausdruck erlaubt sind - in genau dieser Reihenfolge.</div><div class="pre"><div data-attribute-id="5a7ab54e-6422-4c18-b13c-8ef1b4736814d6e39" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="14d5205f-269f-4f88-8ced-7411fca9e62f" contenteditable="true">let $bibliothek := .
for $x in $bibliothek//buecher,
    $y in $bibliothek//autoren/autor
where starts-with($autor, 'Grass')
    and $x/@autorId = $y/@id
return $x/titel</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c8a0cb85-703f-405f-b645-b24ac1e81133d6e38" class="p pmarker tags" data-element="p" data-tektur-editor-id="8d882144-7e2f-4678-966f-363262895ccf" contenteditable="true">In dieser Query werden die Titel aller Bücher von Grass zurückgeliefert.
Bemerkenswert ist hier die Syntax.</div><div data-element="note" class="show_menu tags" data-tektur-editor-id="3501f247-eed0-4e2b-bd92-4138f9210e0a"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="note"><div class="signal-word">NOTE</div><div class="hcontent"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9107c2a6-03d3-41db-b842-771ef054948fd6e41" class="p pmarker tags" data-element="p" data-tektur-editor-id="b784782f-7d9f-43f1-baf1-deecf1e82f4f" contenteditable="true">Normalerweise würde man zwischen den
einzelnen Anweisungen einen Blockabschluss, wie ein Semikolon erwarten.
Da wir aber hier funtional prorgammieren, ist die Sache etwas anders...</div></div></div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="07ea7c97-bc1b-4c09-b196-004a7c42c9ac" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="2a3553cd-0d3d-4138-b18b-ede1853d1030"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="7dbf0fb3-8421-43c4-b792-0eba61c4bf27d6e44" class="title pmarker tags" data-element="title" data-tektur-editor-id="cb523c5c-2f4a-441f-a1b3-f92d9642b566" contenteditable="true">XML per XQuery</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9ab1e252-cb55-4821-9893-74ec6ef84344d6e45" class="p pmarker tags" data-element="p" data-tektur-editor-id="c1b926a3-f8e1-4d8c-91bd-143103f571b7" contenteditable="true">Es ist aber auch möglich XML zu erzeugen, wobei natürlich für eine Transformation XSLT 
vorzuziehen ist. Dazu werden Tags direkt in die Expression geschrieben, wie z.B. hier:</div><div class="pre"><div data-attribute-id="daed8a36-98c7-40a9-8a60-8e788570441bd6e51" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ff80df62-207a-4493-9f4c-a028480a2a88" contenteditable="true">declare variable $nachname as xs:string external;
&#x3C;buecher autor="{$nachname}"&#x3E;
{
  let $bibliothek := .
  for $x in $bibliothek/buecher//buch,
      $y in $bibliothek/autoren//autor
  where starts-with($y, $nachname)
      and $x/@autorId = $y/@id
  order by $x/ausgabe
  return
  &#x3C;buch ausgabe="{$x/ausgabe}"&#x3E;
    {$x/titel}
  &#x3C;/buch&#x3E;
}
&#x3C;/buecher&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="998102ca-7388-47ce-bb9d-0c6676f3788dd6e49" class="p pmarker tags" data-element="p" data-tektur-editor-id="189a17cc-c6aa-4b83-a18b-36310d81c8c6" contenteditable="true">Speichert man dieses Schnippsel in einer Datei [[code:buecher.xquery]] ab,
so kann man mit der folgenden Kommandozeile auf einer [[code:buecher.xml]] Datei als Eingabe suchen:</div><div class="pre"><div data-attribute-id="9935a64e-17ff-4de3-b50a-68428f8259fcd6e55" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="520bc938-08ba-4939-943b-c695d18d6f9d" contenteditable="true">java -cp usr/lib/saxon/saxon.jar net.sf.saxon.Query -t -s:buecher.xml 
                                                       -q:buecher.xquery 
                                                       -o:ergebnis.xml 
                                                       nachname=grass</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="1b6cfa8b-f22e-438a-b791-8f760ed181af" contenteditable="true"></div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="0a977f52-db6c-456c-8ce9-4af2493e0ab7"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="72199b87-ef45-4bac-93aa-a03892a63e12d6e54" class="title pmarker tags" data-element="title" data-tektur-editor-id="47e03015-e052-4959-82df-b513803d4074" contenteditable="true">Document Projection</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="4b856b14-5e37-4b3f-97aa-35d140f8c43bd6e55" class="p pmarker tags" data-element="p" data-tektur-editor-id="45627478-f7db-4b29-b04c-590c74ac041f" contenteditable="true">Document Projection[[fn:http://www.saxonica.com/documentation/#!sourcedocs/projection*Verstecktes Saxon Feature: Dokument Projektion bei einer XQuery Abfrage]][[xe1:Tipps und Tricks;xe2:Document Projection]]  ist ein verstecktes Saxon XQuery Feature. Es funktioniert nur für eine einzige Abfrage.
Das kann schon recht hilfreich sein, wenn man ein mehrere 100MB großes Dokument durchsuchen
will.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="ac58c0ea-28fd-4c0f-9ecc-722bb1233a6ad6e57" class="p pmarker tags" data-element="p" data-tektur-editor-id="5a12561c-59cd-4145-aaba-34116ef52517" contenteditable="true">Ohne Projection würde das Beispiel von oben so verarbeitet:</div><div class="pre"><div data-attribute-id="7c32c149-0c9d-46d0-9461-40c5b22e6cc2d6e64" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="607166e7-e795-4257-b576-0f2765d1abec" contenteditable="true">java -cp usr/lib/saxon/saxon.jar net.sf.saxon.Query -t 
     -s:buecher.xml 
     -q:buecher.xquery 
     -o:ergebnis.xml 
     -projection:off 
     nachname=grass
Saxon-EE 9.7.0.20J from Saxonica
Java version 1.8.0_60
Using license serial number V005095
Analyzing query from Desktop/buecher.xquery
Generating byte code...
Analysis time: 201.10095 milliseconds
Processing file:/Users/Alex/buecher.xml
Using parser com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser
Building tree for file:/Users/Alex/buecher.xml 
using class net.sf.saxon.tree.tiny.TinyBuilder
Tree built in 3.482278ms
Tree size: 46 nodes, 58 characters, 6 attributes
Execution time: 27.137589ms
Memory used: 67031664</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="f182025a-4c60-479e-a19f-5927645b8a2ed6e61" class="p pmarker tags" data-element="p" data-tektur-editor-id="617024c9-c9fa-4658-ac8c-6c1734cdb09c" contenteditable="true">Mit der Option [[code:-projection:on]] verändert sich die Ausführungszeit signifikant:</div><div class="pre"><div data-attribute-id="adbf44aa-77de-42a1-aec4-b4353c659075d6e68" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="68d74c12-ba40-487f-864b-e2d8b1f9cf22" contenteditable="true">[...]

Document projection for file:/Users/Alex/buecher.xml
-- Input nodes 50; output nodes 27; reduction = 46%
Tree built in 3.80615ms
Tree size: 26 nodes, 58 characters, 3 attributes
Execution time: 15.83463ms
Memory used: 64339064</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="4a8b6620-52f5-4353-b426-1010530e7376" contenteditable="true"></div></div></div></div>