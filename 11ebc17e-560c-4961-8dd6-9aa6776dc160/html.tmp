<div data-attribute-id="7f03cc5e-675a-4371-b3e9-5d79b981ff95" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="1132537d-c312-4398-b62c-358028b4df99"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="fbbe8267-ed7b-4b78-b547-d00fe41f0b5c" class="title pmarker tags" data-element="title" data-tektur-editor-id="a91acbe1-2821-4ebd-9b58-26a03c0ee3f6" contenteditable="true">Webservice Calls mit <span class="bracket-tags-marker" id="c93fa15a-9f80-492b-9905-ee40314cdb79">[[<span class="bracket-tags">code:doc()</span>]]</span> und <span class="bracket-tags-marker" id="7f714352-7a0c-4387-97a5-8a9e46e93181">[[<span class="bracket-tags">code:unparsed-text()</span>]] </span></div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="0ebf9da6-009b-4e85-a536-f2570e5b5fd0"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="49a16f70-a370-49da-8f8f-246d85a064dc" contenteditable="true"></div></div><div data-attribute-id="813af5cb-f856-4d8c-996c-dd02e81732fd" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="273e1387-609a-44de-8d45-b0b46c5caea3"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="1c78fd9b-6698-4787-99ae-ed5f10191308"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cfd5bdf8-a043-405f-a3f7-1feb395fbd3d" class="p pmarker tags" data-element="p" data-tektur-editor-id="5552a00e-74a5-4d40-8b47-8077a4030ebb" contenteditable="true">Eine verbreitete Paxis ist es, mit der Funktion <span class="bracket-tags-marker" id="f395b545-81c6-48f6-b0bf-bdbd724aa38c">[[<span class="bracket-tags">code:document()</span>]]</span> oder kurz <span class="bracket-tags-marker" id="2d249fe8-5155-4620-978a-ffbb6ebee061">[[<span class="bracket-tags">code:doc()</span>]]</span> 
entfernte Ressourcen in die Transformation einzubinden. 
Bei einer Schematron-Validierung, würde bspw. eine Regel, wie:</div><div class="pre"><div data-attribute-id="cd9ff954-fc36-4987-846b-072fcdd2f435d7e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="345aae59-30a5-48c7-aca9-c78e5390d8f4" contenteditable="true">&#x3C;sch:not-assert id="personal-check"
    role="error"
    test="doc(concat('https://tekturcms.de/personal.xqy?personal-id=',personal-id))/kuendigung"&#x3E;
        Angestellter mit ID "&#x3C;sch:value-of select="personal-id"/&#x3E;" hat gekündigt!
&#x3C;/sch:not-assert&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9fc3fa46-8e19-4c2b-90cf-0f2a76ef18eed6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="9e319e65-e0bf-4523-8711-02c0270ee36a" contenteditable="true">einen entferneten Webservice aufrufen und prüfen, ob für den Angestellten mit <span class="bracket-tags-marker" id="4e21e4e2-3cd2-45a3-9483-a08a7dd554cf">[[<span class="bracket-tags">code:personal-id</span>]]</span>
eine Kündigung vorliegt. Ist dies der Fall, so ist die negative Zusicherung <span class="bracket-tags-marker" id="4a4250a6-a67b-401e-a39f-aed9258b3fa8">[[<span class="bracket-tags">code:not-assert</span>]]</span> nicht
erfüllt und die Schematron Regel feuert - was sich wohl im einfachsten Fall in einem 
Logfile Eintrag äussern sollte.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="e3b1a6ca-7163-4c64-a69d-a1f4277847d5d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="ffb89af9-2b76-4ca7-aaed-065d68254884" contenteditable="true">Was vermutlich viele noch nicht kennen - ich nehme jetzt einfach mal an, dass mein 
bisheriger Kenntnisstand dem der Mehrheit der XML-Entwickler entspricht - ist der Umstand,
dass auch die Funktion <span class="bracket-tags-marker" id="00277c6e-d97f-43ec-aaef-b50937aa7002">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> eine URL als Parameter nimmt:</div><div class="pre"><div data-attribute-id="d978d928-5f04-41cf-9a10-18953e0ff997d7e12" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="7d70b147-ba3b-4aac-9af2-4b1b31175651" contenteditable="true">&#x3C;xsl:template match="angestellter"
    &#x3C;xsl:copy&#x3E;
        &#x3C;xsl:apply-templates select="node()|@*"/&#x3E;
        &#x3C;hat-gekuendigt&#x3E;
            &#x3C;xsl:sequence select="json-to-xml(
                                  unparsed-text(
                                  concat('https://tekturcms.de/personal.xqy?personal-id=',
                                  personal-id))))/descendant::*[@key='gekuendigt']/text()"/&#x3E;
        &#x3C;/hat-gekuendigt&#x3E;
    &#x3C;/xsl:copy&#x3E;
&#x3C;/xsl:template&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9992ff44-8622-4832-a290-5b53de8787fbd6e14" class="p pmarker tags" data-element="p" data-tektur-editor-id="bf9360c5-d45b-48b3-a0cc-3ff0d0afc9a8" contenteditable="true">Während mit <span class="bracket-tags-marker" id="e9701cef-2aa3-4fd1-9b1d-b19c2116a114">[[<span class="bracket-tags">code:doc()</span>]]</span> oder <span class="bracket-tags-marker" id="0014186c-375b-40ac-bbe6-036df0e46f09">[[<span class="bracket-tags">code:document()</span>]]</span> ein zurückgeliefertes XML Fragment 
prozessiert wird, erwartet <span class="bracket-tags-marker" id="ba8a228d-bb93-407b-96e9-e09d500d7a66">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> z.B. einen <span data-attribute-id="cb9e283d-09cb-4e2f-a785-74aa1b809452d7e16" class="b" data-element="b">JSON-String</span>, der dann mittels
der Funktion <span class="bracket-tags-marker" id="6da51927-ba5f-448d-9009-a3f0f73869bd">[[<span class="bracket-tags">code:json-to-xml()</span>]]</span> nach XML konvertiert werden kann.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3b7e4ebd-cc5a-448c-8ae5-85e90302d51dd6e16" class="p pmarker tags" data-element="p" data-tektur-editor-id="b86019e6-8756-4887-b117-8dfc12914190" contenteditable="true">Beispielsweise könnte die Gegenseite zum <span class="bracket-tags-marker" id="37834711-9dd3-4b8d-96e0-ecc0f47104dd">[[<span class="bracket-tags">code:angestellter</span>]]</span> Template mittels XQuery
folgendermassen realisiert sein:</div><div class="pre"><div data-attribute-id="a9252b8b-eb00-4266-9899-e26ede2899bfd7e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="26c56bb2-2a50-4c1f-9f2e-eb0284ce50d2" contenteditable="true">xquery version "1.0-ml";

declare variable $personal-id := xdmp:get-request-field('personal-id');

let $gekuendigt := if (collection('/personal')/*[personal-id = $personal-id and 
                                                 fn:exists(kuendingung)] then 
                                                 'ja' else 'nein'
return 
    common:render-response(concat('{"gekuendigt":"',$gekuendigt,'",
                                    "personal-id":"',$personal-id,'"}'))</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="83a12eb2-9d2c-4bea-9d00-463280925e65d6e20" class="p pmarker tags" data-element="p" data-tektur-editor-id="f55f4685-5d01-49fe-a141-479aeb675560" contenteditable="true">(<span class="link" data-element="link" data-tektur-editor-id="86e61dc1-c690-4420-b3ce-83c39c6bf091" href="98665bd9-d40d-4fc7-ab7a-e340be6190a6" data-type="none">Mehr zu XQuery und den hier verwendeten Konstrukten</span>, wie <span class="bracket-tags-marker" id="28358c56-e284-41e8-88f0-f20ee97fa3c9">[[<span class="bracket-tags">code:render-response()</span>]]</span>))</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="dc9f1757-17d5-4982-9f9b-b624dcc9f86cd6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="747577a5-9ae6-42fa-8de0-a1db7671297d" contenteditable="true">Das zurückgeklieferte JSON Dokument sieht dann so aus:</div><div class="pre"><div data-attribute-id="74d2ef38-12af-412c-a567-dab6108b9742d7e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="e5f97332-b89f-418f-b4f7-d9727d6ce93d" contenteditable="true">{"gekuendig":"ja","personal-id":"q5687500"}</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c16d857e-bf25-4013-a637-fb1f1f42b212d6e27" class="p pmarker tags" data-element="p" data-tektur-editor-id="8b6d2f14-1698-4f97-9e6f-7fa87ffc65ca" contenteditable="true">Konvertiert nach XML erhält man eine Map Struktur:</div><div class="pre"><div data-attribute-id="01b947b8-1295-4662-b691-d3fb7a497512d7e35" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="32791557-2d15-4a0b-b529-0d229cf5ca46" contenteditable="true">&#x3C;map xmlns="http://www.w3.org/2005/xpath-functions"&#x3E;
    &#x3C;string key="gekuedigt"&#x3E;ja&#x3C;/string&#x3E;
    &#x3C;string key="personal-id"&#x3E;q5687500&#x3C;/string&#x3E;
&#x3C;/map&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5aa1c1a3-6eaa-470b-bbb0-9cecf34158c3d6e31" class="p pmarker tags" data-element="p" data-tektur-editor-id="7544ed09-b69c-4870-bf00-79c92384beb7" contenteditable="true">was den Selektorausdruck im obigen XPATH erklärt:</div><div class="pre"><div data-attribute-id="2d612d95-fcfd-4914-a4b5-99bb93c42047d7e39" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="9e87ebb7-75ea-4f64-86af-08e7c0a9c02e" contenteditable="true">json-to-xml(
unparsed-text(
concat('https://tekturcms.de/personal.xqy?personal-id=',
personal-id))))/descendant::*[@key='gekuendigt']/text()</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="423a28a9-42c2-4e62-b73c-c2a48f68c079d6e35" class="p pmarker tags" data-element="p" data-tektur-editor-id="e252be11-a796-4996-9524-4876ac71a935" contenteditable="true">Resultat der Konvertierung wäre also dann - wie erwartet - ein um 
das <span class="bracket-tags-marker" id="c4d67dc4-e51b-4ece-b4cc-617ea0a718a3">[[<span class="bracket-tags">code:gekuendigt</span>]]</span> Flag erweitertes <span class="bracket-tags-marker" id="fe60ea41-0a3b-485e-8f01-02883078d467">[[<span class="bracket-tags">code:&#x3C;angestellter&#x3E;</span>]]</span>
Element:</div><div class="pre"><div data-attribute-id="81d361f2-0a88-4850-97d9-77e0161c986cd7e43" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="2a127450-fba8-469e-9722-43176f3e2fb6" contenteditable="true">&#x3C;angestellter&#x3E;
    &#x3C;perosnal-id&#x3E;q5687500&#x3C;/perosnal-id&#x3E;
    &#x3C;name&#x3E;Alex&#x3C;/name&#x3E;
    [...]
    &#x3C;gekuendigt&#x3E;nein&#x3C;/gekuendigt&#x3E;
&#x3C;/angestellter&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d6ebc0e3-4946-40df-99b9-89d396165f96d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="44b05d3e-4d0a-4e72-a95f-3d90aab81353" contenteditable="true">Sicherlich wird der XML Entwicler eine <span class="link" data-element="link" data-tektur-editor-id="997e18de-4390-4b97-9f13-5198617f39e4" href="3337f433-44bf-430d-a809-73fd1de5ba6c" data-type="none">XML Datenbank</span>, wie MarkLogic, vorziehen
und sich gleich XML Fragmente ausliefern laasen. <span class="bracket-tags-marker" id="0edaae5a-d4f5-478a-9774-e1935e26b36e">[[<span class="bracket-tags">$productname</span>]]</span> ist aber bspw. mit
<span class="bracket-tags-marker" id="728b97ab-8ad4-4ae1-a2b4-520fb66e756e">[[<span class="bracket-tags">link</span>]]</span>MongoDB<span class="bracket-tags-marker" id="42615d39-7f13-4f26-9c21-af8fea618bbf">[[<span class="bracket-tags">fn:https://www.mongodb.com/*Homepage der NoSQL Datenbank MongoDB</span>]]</span>
realisiert, die auf JSON arbeitet... Nicht zuletzt deshalb finde ich JSON Verarbeitung
mit XSLT recht spannend.</div></div></div></div>