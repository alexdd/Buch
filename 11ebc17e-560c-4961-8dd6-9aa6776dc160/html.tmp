<div data-attribute-id="7f03cc5e-675a-4371-b3e9-5d79b981ff95" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="a23fe5f1-5ae0-4eab-a877-80f535ab35c3"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="fbbe8267-ed7b-4b78-b547-d00fe41f0b5c" class="title pmarker tags" data-element="title" data-tektur-editor-id="66cc5a2c-3286-4c0f-b5b9-c2a124ca73f2" contenteditable="true">Webservice Calls mit [[code:doc()]] und [[code:unparsed-text()]]</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="bc6c1348-baad-4144-b225-267c424a5906"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="2a53cf5b-32fa-453f-9a8e-6d6c838329ff" contenteditable="true"></div></div><div data-attribute-id="813af5cb-f856-4d8c-996c-dd02e81732fd" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="7ed993b5-c42f-4855-99b2-701a8f5d6483"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="d8bea51e-6b6f-4fc6-97dc-ae7fe2427b1c"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cfd5bdf8-a043-405f-a3f7-1feb395fbd3d" class="p pmarker tags" data-element="p" data-tektur-editor-id="04a205bd-b980-4865-b58a-526ed74f3dd4" contenteditable="true">Eine verbreitete Paxis ist es, mit der Funktion <span class="bracket-tags-marker" id="b104e5ea-a3a7-4d1f-a2f8-e06660ca46a5">[[<span class="bracket-tags">code:document()</span>]]</span> oder kurz <span class="bracket-tags-marker" id="83d66e55-a21a-4059-a64a-d0c8ef08bb9c">[[<span class="bracket-tags">code:doc()</span>]]</span> 
entfernte Ressourcen in die Transformation einzubinden. 
Bei einer Schematron-Validierung, würde bspw. eine Regel, wie:</div><div class="pre"><div data-attribute-id="2e7bbd85-0466-4255-a3dd-9425f040ef56d6e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="5e2daf9f-9244-4cde-89d7-a7a365c14d40" contenteditable="true">&#x3C;sch:not-assert id="personal-check"
    role="error"
    test="doc(concat('https://tekturcms.de/personal.xqy?personal-id=',personal-id))/kuendigung"&#x3E;
        Angestellter mit ID "&#x3C;sch:value-of select="personal-id"/&#x3E;" hat gekündigt!
&#x3C;/sch:not-assert&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9fc3fa46-8e19-4c2b-90cf-0f2a76ef18eed6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="3e73ef0c-902c-42f1-bf06-83dd518acb41" contenteditable="true">einen entferneten Webservice aufrufen und prüfen, ob für den Angestellten mit <span class="bracket-tags-marker" id="e3149413-2a92-4ef6-abe1-2705eaaa3001">[[<span class="bracket-tags">code:personal-id</span>]]</span>
eine Kündigung vorliegt. Ist dies der Fall, so ist die negative Zusicherung <span class="bracket-tags-marker" id="f4cb805c-6204-4123-a082-78ceb6a9621e">[[<span class="bracket-tags">code:not-assert</span>]]</span> nicht
erfüllt und die Schematron Regel feuert - was sich wohl im einfachsten Fall in einem 
Logfile Eintrag äussern sollte.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="e3b1a6ca-7163-4c64-a69d-a1f4277847d5d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="4f8cc866-89bb-4189-af11-576d54969db7" contenteditable="true">Was vermutlich viele noch nicht kennen - ich nehme jetzt einfach mal an, dass mein 
bisheriger Kenntnisstand dem der Mehrheit der XML-Entwickler entspricht - ist der Umstand,
dass auch die Funktion <span class="bracket-tags-marker" id="8909b671-398a-4a39-9386-fffc729c10d2">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> eine URL als Parameter nimmt:</div><div class="pre"><div data-attribute-id="fd269f49-7e14-4839-b295-8ec99851fd82d6e12" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="c2972c9d-5d8f-4f0a-a66a-8ff6656e677f" contenteditable="true">&#x3C;xsl:template match="angestellter"
    &#x3C;xsl:copy&#x3E;
        &#x3C;xsl:apply-templates select="node()|@*"/&#x3E;
        &#x3C;hat-gekuendigt&#x3E;
            &#x3C;xsl:sequence select="json-to-xml(
                                  unparsed-text(
                                  concat('https://tekturcms.de/personal.xqy?personal-id=',
                                  personal-id))))/descendant::*[@key='gekuendigt']/text()"/&#x3E;
        &#x3C;/hat-gekuendigt&#x3E;
    &#x3C;/xsl:copy&#x3E;
&#x3C;/xsl:template&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9992ff44-8622-4832-a290-5b53de8787fbd6e14" class="p pmarker tags" data-element="p" data-tektur-editor-id="a1684bbb-7ce3-4b5f-bef2-e6b6e2554764" contenteditable="true">Während mit <span class="bracket-tags-marker" id="355ced5e-1277-4661-9739-0cf188925143">[[<span class="bracket-tags">code:doc()</span>]]</span> oder <span class="bracket-tags-marker" id="0414df5b-2595-4315-88b7-879e4f962e15">[[<span class="bracket-tags">code:document()</span>]]</span> ein zurückgeliefertes XML Fragment 
prozessiert wird, erwartet <span class="bracket-tags-marker" id="a00eee82-29ca-4819-a117-ba954bc3a9c1">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> z.B. einen JSON-String, der dann mittels
der Funktion <span class="bracket-tags-marker" id="76ff3a63-f6b1-4354-9b69-23748167e93c">[[<span class="bracket-tags">code:json-to-xml()</span>]]</span> nach XML konvertiert werden kann.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3b7e4ebd-cc5a-448c-8ae5-85e90302d51dd6e16" class="p pmarker tags" data-element="p" data-tektur-editor-id="f965cd13-bfca-4634-894d-297014b7769d" contenteditable="true">Beispielsweise könnte die Gegenseite zum <span class="bracket-tags-marker" id="52c53ee2-34b8-4f87-a23e-7a7bb7a56f11">[[<span class="bracket-tags">code:angestellter</span>]]</span> Template mittels XQuery
folgendermassen realisiert sein:</div><div class="pre"><div data-attribute-id="8adfa4aa-0d1c-4670-b978-6cbe3df819e0d6e18" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="8073b9b6-5e6c-4f38-b2db-7a19430dcb72" contenteditable="true">xquery version "1.0-ml";

declare variable $personal-id := xdmp:get-request-field('personal-id');

let $gekuendigt := if (collection('/personal')/*[personal-id = $personal-id and 
                                                 fn:exists(kuendingung)] then 
                                                 'ja' else 'nein'
return 
    common:render-response(concat('{"gekuendigt":"',$gekuendigt,'",
                                    "personal-id":"',$personal-id,'"}'))</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="83a12eb2-9d2c-4bea-9d00-463280925e65d6e20" class="p pmarker tags" data-element="p" data-tektur-editor-id="32aac3c1-5487-4220-9965-2477ffc346ed" contenteditable="true">(<span class="link" data-element="link" data-tektur-editor-id="86e61dc1-c690-4420-b3ce-83c39c6bf091" href="98665bd9-d40d-4fc7-ab7a-e340be6190a6" data-type="none">Mehr zu XQuery und den hier verwendeten Konstrukten</span>, wie <span class="bracket-tags-marker" id="2871dccb-c1c9-45bc-8a91-4903b3d1a0d3">[[<span class="bracket-tags">code:render-response()</span>]]</span>))</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="dc9f1757-17d5-4982-9f9b-b624dcc9f86cd6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="7b12f92b-43df-459a-926e-d8f13f5c803e" contenteditable="true">Das zurückgeklieferte JSON Dokument sieht dann so aus:</div><div class="pre"><div data-attribute-id="b2c987b3-af1d-4577-833f-687a0e09d16fd6e27" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="a7ffe90b-5dbd-45af-a380-32a641782b33" contenteditable="true">{"gekuendig":"ja","personal-id":"q5687500"}</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c16d857e-bf25-4013-a637-fb1f1f42b212d6e27" class="p pmarker tags" data-element="p" data-tektur-editor-id="514ceccb-1ebc-45b1-8383-462cea12ea53" contenteditable="true">Konvertiert nach XML erhält man eine Map Struktur:</div><div class="pre"><div data-attribute-id="4a4c21a1-fbf1-45d3-8d93-7cc4b71a64cdd6e32" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="007aa531-c49c-420c-b097-caf998344c30" contenteditable="true">&#x3C;map xmlns="http://www.w3.org/2005/xpath-functions"&#x3E;
    &#x3C;string key="gekuedigt"&#x3E;ja&#x3C;/string&#x3E;
    &#x3C;string key="personal-id"&#x3E;q5687500&#x3C;/string&#x3E;
&#x3C;/map&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5aa1c1a3-6eaa-470b-bbb0-9cecf34158c3d6e31" class="p pmarker tags" data-element="p" data-tektur-editor-id="266aeffe-1941-4e0a-8d6c-e71ba6004e6c" contenteditable="true">was den Selektorausdruck im obigen XPATH erklärt:</div><div class="pre"><div data-attribute-id="5786ecdd-5c8e-4c48-b7c0-43077eefc660d6e36" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="202d532e-1c4e-4c9a-bd7a-662100eaa85d" contenteditable="true">json-to-xml(
unparsed-text(
concat('https://tekturcms.de/personal.xqy?personal-id=',
personal-id))))/descendant::*[@key='gekuendigt']/text()</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="423a28a9-42c2-4e62-b73c-c2a48f68c079d6e35" class="p pmarker tags" data-element="p" data-tektur-editor-id="b7b25062-47a0-4ccf-8fff-183b1c5051c6" contenteditable="true">Resultat der Konvertierung wäre also dann - wie erwartet - ein um 
das <span class="bracket-tags-marker" id="9ca14bc0-4dba-4104-8683-02eac659fc03">[[<span class="bracket-tags">code:gekuendigt</span>]]</span> Flag erweitertes <span class="bracket-tags-marker" id="53092973-27af-4afd-ad1b-707478b6a4fe">[[<span class="bracket-tags">code:&#x3C;angestellter&#x3E;</span>]]</span>
Element:</div><div class="pre"><div data-attribute-id="4674254c-2df0-41e3-bb24-e6620109646fd6e40" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="6ac30ff9-0787-4468-852c-d60245b9e4db" contenteditable="true">&#x3C;angestellter&#x3E;
    &#x3C;perosnal-id&#x3E;q5687500&#x3C;/perosnal-id&#x3E;
    &#x3C;name&#x3E;Alex&#x3C;/name&#x3E;
    [...]
    &#x3C;gekuendigt&#x3E;nein&#x3C;/gekuendigt&#x3E;
&#x3C;/angestellter&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d6ebc0e3-4946-40df-99b9-89d396165f96d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="f320bf78-bda3-4ca8-a27a-9ce8abbfa8c5" contenteditable="true">Sicherlich wird der XML Entwicler eine <span class="link" data-element="link" data-tektur-editor-id="997e18de-4390-4b97-9f13-5198617f39e4" href="3337f433-44bf-430d-a809-73fd1de5ba6c" data-type="none">XML Datenbank</span>, wie MarkLogic, vorziehen
und sich gleich XML Fragmente ausliefern laasen. <span class="bracket-tags-marker" id="d3c7ed0a-6494-4632-8d56-8c40ac944387">[[<span class="bracket-tags">$productname</span>]]</span> ist aber bspw. mit
<span class="bracket-tags-marker" id="f2e82087-6c4c-4438-8698-8855f38ca95a">[[<span class="bracket-tags">link</span>]]</span>MongoDB<span class="bracket-tags-marker" id="99bd8db9-81f3-4576-845c-cfda21ff6c94">[[<span class="bracket-tags">fn:https://www.mongodb.com/*Homepage der NoSQL Datenbank MongoDB</span>]]</span>
realisiert, die auf JSON arbeitet... Nicht zuletzt deshalb finde ich JSON Verarbeitung
mit XSLT recht spannend.</div></div></div></div>