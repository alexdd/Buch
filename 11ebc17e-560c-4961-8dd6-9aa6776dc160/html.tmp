<div data-attribute-id="7f03cc5e-675a-4371-b3e9-5d79b981ff95" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="3ca3b7ed-790f-452d-8d78-553a09c8f941"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="fbbe8267-ed7b-4b78-b547-d00fe41f0b5c" class="title pmarker tags" data-element="title" data-tektur-editor-id="16db6d67-59f0-486d-b569-ca5cca8c9864" contenteditable="true">Webservice Calls mit <span class="bracket-tags-marker" id="97db0e23-ddfd-4447-8a94-bc294ba52732">[[<span class="bracket-tags">code:doc()</span>]]</span> und <span class="bracket-tags-marker" id="337060ad-b610-4673-8958-59627742b36a">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span></div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="f744b70b-f6f2-4411-ad3c-f5e5a303f9ea"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="82d5f559-158d-42c9-9965-cf37ff622e92" contenteditable="true"></div></div><div data-attribute-id="813af5cb-f856-4d8c-996c-dd02e81732fd" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="e5218020-2a93-4a23-aefe-c41c74843159"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="ee7d2035-3ae8-47c9-9759-c4b1fd5c368d"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cfd5bdf8-a043-405f-a3f7-1feb395fbd3d" class="p pmarker tags" data-element="p" data-tektur-editor-id="273cd49f-7b49-4990-bd49-c317181eec10" contenteditable="true">Eine verbreitete Paxis ist es, mit der Funktion <span class="bracket-tags-marker" id="fbf095d7-657e-4a44-8840-8ea929cb6593">[[<span class="bracket-tags">code:document()</span>]]</span> oder kurz <span class="bracket-tags-marker" id="a624a7b2-9417-4c16-beee-a9f6a254df76">[[<span class="bracket-tags">code:doc()</span>]]</span> 
entfernte Ressourcen in die Transformation einzubinden. 
Bei einer Schematron-Validierung, würde bspw. eine Regel, wie:</div><div class="pre"><div data-attribute-id="d8ba6a9b-d3ae-4ddc-848a-237342a4b964d7e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="f82eb833-78ed-4d67-91b0-4b3d28fe7a9f" contenteditable="true">&#x3C;sch:not-assert id="personal-check"
    role="error"
    test="doc(concat('https://tekturcms.de/personal.xqy?personal-id=',personal-id))/kuendigung"&#x3E;
        Angestellter mit ID "&#x3C;sch:value-of select="personal-id"/&#x3E;" hat gekündigt!
&#x3C;/sch:not-assert&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9fc3fa46-8e19-4c2b-90cf-0f2a76ef18eed6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="1d0b7a15-fcbc-4039-be72-912bebc04994" contenteditable="true">einen entferneten Webservice aufrufen und prüfen, ob für den Angestellten mit <span class="bracket-tags-marker" id="c3421dd5-1156-43be-b6d1-6aae941d8d68">[[<span class="bracket-tags">code:personal-id</span>]]</span>
eine Kündigung vorliegt. Ist dies der Fall, so ist die negative Zusicherung <span class="bracket-tags-marker" id="5f192595-b727-44ee-98e6-1db8254d6fa4">[[<span class="bracket-tags">code:not-assert</span>]]</span> nicht
erfüllt und die Schematron Regel feuert - was sich wohl im einfachsten Fall in einem 
Logfile Eintrag äussern sollte.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="e3b1a6ca-7163-4c64-a69d-a1f4277847d5d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="50dd055a-63a7-40c9-b1f9-fe0f36942a28" contenteditable="true">Was vermutlich viele noch nicht kennen - ich nehme jetzt einfach mal an, dass mein 
bisheriger Kenntnisstand dem der Mehrheit der XML-Entwickler entspricht - ist der Umstand,
dass auch die Funktion <span class="bracket-tags-marker" id="05bd46ae-6070-4f94-ba68-b0665093cfec">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> eine URL als Parameter nimmt:</div><div class="pre"><div data-attribute-id="9e5da5dc-d5f3-4ddb-9826-4076a7497398d7e12" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ab91693b-4ec8-42dc-b838-ebc65e087187" contenteditable="true">&#x3C;xsl:template match="angestellter"
    &#x3C;xsl:copy&#x3E;
        &#x3C;xsl:apply-templates select="node()|@*"/&#x3E;
        &#x3C;hat-gekuendigt&#x3E;
            &#x3C;xsl:sequence select="json-to-xml(
                                  unparsed-text(
                                  concat('https://tekturcms.de/personal.xqy?personal-id=',
                                  personal-id))))/descendant::*[@key='gekuendigt']/text()"/&#x3E;
        &#x3C;/hat-gekuendigt&#x3E;
    &#x3C;/xsl:copy&#x3E;
&#x3C;/xsl:template&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9992ff44-8622-4832-a290-5b53de8787fbd6e14" class="p pmarker tags" data-element="p" data-tektur-editor-id="dc2868b1-4ca1-4a52-b31d-de415aebaa2a" contenteditable="true">Während mit <span class="bracket-tags-marker" id="e3fc7ebf-0ded-4ba0-8751-82e43f672cc8">[[<span class="bracket-tags">code:doc()</span>]]</span> oder <span class="bracket-tags-marker" id="11317eec-6026-4b6f-bc85-ac73f945918d">[[<span class="bracket-tags">code:document()</span>]]</span> ein zurückgeliefertes XML Fragment 
prozessiert wird, erwartet <span class="bracket-tags-marker" id="a6b9169f-2260-4f75-9381-92cb4d4d11fa">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> z.B. einen <span data-attribute-id="cb9e283d-09cb-4e2f-a785-74aa1b809452d7e16" class="b" data-element="b">JSON-String</span>, der dann mittels
der Funktion <span class="bracket-tags-marker" id="dbf80ac8-49ce-4ac4-8f8f-2da681daa24d">[[<span class="bracket-tags">code:json-to-xml()</span>]]</span> nach XML konvertiert werden kann.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3b7e4ebd-cc5a-448c-8ae5-85e90302d51dd6e16" class="p pmarker tags" data-element="p" data-tektur-editor-id="0a43ce55-b087-44bd-bb19-f17d3420bac2" contenteditable="true">Beispielsweise könnte die Gegenseite zum <span class="bracket-tags-marker" id="cb37058e-d345-429c-a81f-ad9fbac2beb7">[[<span class="bracket-tags">code:angestellter</span>]]</span> Template mittels XQuery
folgendermassen realisiert sein:</div><div class="pre"><div data-attribute-id="b1aa7f7c-4bc4-4d08-9d95-b599561b6b58d7e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="2c4097e5-49b9-4440-b4a1-b35f0c68d6bb" contenteditable="true">xquery version "1.0-ml";

declare variable $personal-id := xdmp:get-request-field('personal-id');

let $gekuendigt := if (collection('/personal')/*[personal-id = $personal-id and 
                                                 fn:exists(kuendingung)] then 
                                                 'ja' else 'nein'
return 
    common:render-response(concat('{"gekuendigt":"',$gekuendigt,'",
                                    "personal-id":"',$personal-id,'"}'))</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="83a12eb2-9d2c-4bea-9d00-463280925e65d6e20" class="p pmarker tags" data-element="p" data-tektur-editor-id="33593fc9-2eb0-4eca-946d-633bc8641a1e" contenteditable="true">(<span class="link" data-element="link" data-tektur-editor-id="86e61dc1-c690-4420-b3ce-83c39c6bf091" href="98665bd9-d40d-4fc7-ab7a-e340be6190a6" data-type="none">Mehr zu XQuery und den hier verwendeten Konstrukten</span>, wie <span class="bracket-tags-marker" id="0e61b7f8-a4f3-406a-81f7-90afd00ff629">[[<span class="bracket-tags">code:render-response()</span>]]</span>))</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="dc9f1757-17d5-4982-9f9b-b624dcc9f86cd6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="2cfff7ac-7bcd-4e6d-8800-1a2e9495a6b8" contenteditable="true">Das zurückgeklieferte JSON Dokument sieht dann so aus:</div><div class="pre"><div data-attribute-id="2ff353a6-dc85-4dca-848c-cc8a5ea49a18d7e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="fe98953c-ab82-45c1-b73e-3e843e2bbd17" contenteditable="true">{"gekuendig":"ja","personal-id":"q5687500"}</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c16d857e-bf25-4013-a637-fb1f1f42b212d6e27" class="p pmarker tags" data-element="p" data-tektur-editor-id="87bba51f-e7d9-4924-b2fd-442d5d377042" contenteditable="true">Konvertiert nach XML erhält man eine Map Struktur:</div><div class="pre"><div data-attribute-id="ffb50115-b875-4064-83ad-c2858612b49bd7e35" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="0874ca32-6657-45eb-8247-ccfe3cabf271" contenteditable="true">&#x3C;map xmlns="http://www.w3.org/2005/xpath-functions"&#x3E;
    &#x3C;string key="gekuedigt"&#x3E;ja&#x3C;/string&#x3E;
    &#x3C;string key="personal-id"&#x3E;q5687500&#x3C;/string&#x3E;
&#x3C;/map&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5aa1c1a3-6eaa-470b-bbb0-9cecf34158c3d6e31" class="p pmarker tags" data-element="p" data-tektur-editor-id="63c22695-4c6f-4b7b-abb9-df680e3afb11" contenteditable="true">was den Selektorausdruck im obigen XPATH erklärt:</div><div class="pre"><div data-attribute-id="b2a41b74-b23c-403d-8102-ffe5bb7f7f9ed7e39" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="49a00f34-3a59-4d43-8f84-2b78e9c96ddf" contenteditable="true">json-to-xml(
unparsed-text(
concat('https://tekturcms.de/personal.xqy?personal-id=',
personal-id))))/descendant::*[@key='gekuendigt']/text()</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="423a28a9-42c2-4e62-b73c-c2a48f68c079d6e35" class="p pmarker tags" data-element="p" data-tektur-editor-id="de0e46a2-bd6a-4046-8606-670feda5076c" contenteditable="true">Resultat der Konvertierung wäre also dann - wie erwartet - ein um 
das <span class="bracket-tags-marker" id="86e164af-c51e-4845-bbcc-76accb52714b">[[<span class="bracket-tags">code:gekuendigt</span>]]</span> Flag erweitertes <span class="bracket-tags-marker" id="911a0e2a-3a93-47de-b837-ca74472bc701">[[<span class="bracket-tags">code:&#x3C;angestellter&#x3E;</span>]]</span>
Element:</div><div class="pre"><div data-attribute-id="f6cf4dce-8530-4b4d-a15e-b6cd6ab9af6cd7e43" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="6e4bf7f3-f61b-4c37-9df2-cf8b55a60f14" contenteditable="true">&#x3C;angestellter&#x3E;
    &#x3C;perosnal-id&#x3E;q5687500&#x3C;/perosnal-id&#x3E;
    &#x3C;name&#x3E;Alex&#x3C;/name&#x3E;
    [...]
    &#x3C;gekuendigt&#x3E;nein&#x3C;/gekuendigt&#x3E;
&#x3C;/angestellter&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d6ebc0e3-4946-40df-99b9-89d396165f96d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="2ddb8808-2d84-4cf5-92a2-7ed9d5918942" contenteditable="true">Sicherlich wird der XML Entwicler eine <span class="link" data-element="link" data-tektur-editor-id="997e18de-4390-4b97-9f13-5198617f39e4" href="3337f433-44bf-430d-a809-73fd1de5ba6c" data-type="none">XML Datenbank</span>, wie MarkLogic, vorziehen
und sich gleich XML Fragmente ausliefern laasen. <span class="bracket-tags-marker" id="ba2c9926-18a6-4ea6-a9ac-67f1ce6a9976">[[<span class="bracket-tags">$productname</span>]]</span> ist aber bspw. mit
<span class="bracket-tags-marker" id="d8ab4e7c-1fe9-47c6-bebb-c137ff31d8d8">[[<span class="bracket-tags">link</span>]]</span>MongoDB<span class="bracket-tags-marker" id="07edb6fa-bdf6-4a14-9b36-77eeb36926a5">[[<span class="bracket-tags">fn:https://www.mongodb.com/*Homepage der NoSQL Datenbank MongoDB</span>]]</span>
realisiert, die auf JSON arbeitet... Nicht zuletzt deshalb finde ich JSON Verarbeitung
mit XSLT recht spannend.</div></div></div></div>