<div data-attribute-id="7f03cc5e-675a-4371-b3e9-5d79b981ff95" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="0418d7db-16eb-4a11-9816-d23e347a2be8"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="fbbe8267-ed7b-4b78-b547-d00fe41f0b5c" class="title pmarker tags" data-element="title" data-tektur-editor-id="349a69b2-619d-40f3-a660-bb1548d54aba" contenteditable="true">Webservice Calls mit <span class="bracket-tags-marker" id="11999954-79c0-4db6-bc39-e201b371e3a5">[[<span class="bracket-tags">code:doc()</span>]]</span> und <span class="bracket-tags-marker" id="4790c151-58ee-4c30-9ca7-656559a827b8">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span></div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="19d65d59-34f7-4623-aa3a-a8593fdfecb5"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="a7befd59-f75d-4361-a5bb-11bb1b58864f" contenteditable="true"></div></div><div data-attribute-id="813af5cb-f856-4d8c-996c-dd02e81732fd" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="afad1097-2354-4cfb-9d59-954c7fb3d1db"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="c3a499ca-d2db-4e69-9be9-ba70ae1fb6ad"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cfd5bdf8-a043-405f-a3f7-1feb395fbd3d" class="p pmarker tags" data-element="p" data-tektur-editor-id="f6116dc1-2ef7-4df2-8ba6-eec2c4609fd1" contenteditable="true">Eine verbreitete Paxis ist es, mit der Funktion <span class="bracket-tags-marker" id="2004841c-7373-4902-b451-c4936f72cd30">[[<span class="bracket-tags">code:document()</span>]]</span> oder kurz <span class="bracket-tags-marker" id="fe4ecf4e-b189-49f5-8e0e-78c6ce627593">[[<span class="bracket-tags">code:doc()</span>]]</span> 
entfernte Ressourcen in die Transformation einzubinden. 
Bei einer Schematron-Validierung, würde bspw. eine Regel, wie:</div><div class="pre"><div data-attribute-id="bf4f982e-2629-4328-acc5-7f97ba5059c5d6e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="667a383d-1351-46d9-8133-577d9652493b" contenteditable="true">&#x3C;sch:not-assert id="personal-check"
    role="error"
    test="doc(concat('https://tekturcms.de/personal.xqy?personal-id=',personal-id))/kuendigung"&#x3E;
        Angestellter mit ID "&#x3C;sch:value-of select="personal-id"/&#x3E;" hat gekündigt!
&#x3C;/sch:not-assert&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9fc3fa46-8e19-4c2b-90cf-0f2a76ef18eed6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="3ddd3fcc-52bc-49ee-94bb-7d397cf03769" contenteditable="true">einen entferneten Webservice aufrufen und prüfen, ob für den Angestellten mit <span class="bracket-tags-marker" id="b2b69d61-87b7-4952-8b23-22d3fa6217a8">[[<span class="bracket-tags">code:personal-id</span>]]</span>
eine Kündigung vorliegt. Ist dies der Fall, so ist die negative Zusicherung <span class="bracket-tags-marker" id="b31f5186-255f-4965-89d3-b66913567ca6">[[<span class="bracket-tags">code:not-assert</span>]]</span> nicht
erfüllt und die Schematron Regel feuert - was sich wohl im einfachsten Fall in einem 
Logfile Eintrag äussern sollte.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="e3b1a6ca-7163-4c64-a69d-a1f4277847d5d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="c1ec15ef-ed39-4f9f-a9b0-e446889d1bca" contenteditable="true">Was vermutlich viele noch nicht kennen - ich nehme jetzt einfach mal an, dass mein 
bisheriger Kenntnisstand dem der Mehrheit der XML-Entwickler entspricht - ist der Umstand,
dass auch die Funktion <span class="bracket-tags-marker" id="292b9fe9-6544-4c3d-876a-1257eb01d4b0">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> eine URL als Parameter nimmt:</div><div class="pre"><div data-attribute-id="f646e0c1-128c-4e0e-9f7c-e0548a0118b7d6e12" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="f15122e2-7041-4c37-815b-40632d46b758" contenteditable="true">&#x3C;xsl:template match="angestellter"
    &#x3C;xsl:copy&#x3E;
        &#x3C;xsl:apply-templates select="node()|@*"/&#x3E;
        &#x3C;hat-gekuendigt&#x3E;
            &#x3C;xsl:sequence select="json-to-xml(
                                  unparsed-text(
                                  concat('https://tekturcms.de/personal.xqy?personal-id=',
                                  personal-id))))/descendant::*[@key='gekuendigt']/text()"/&#x3E;
        &#x3C;/hat-gekuendigt&#x3E;
    &#x3C;/xsl:copy&#x3E;
&#x3C;/xsl:template&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9992ff44-8622-4832-a290-5b53de8787fbd6e14" class="p pmarker tags" data-element="p" data-tektur-editor-id="46ceec7a-b27d-44f2-afe6-af086a643dbc" contenteditable="true">Während mit <span class="bracket-tags-marker" id="e6d67786-5374-4dd2-b5cc-ee5896c52761">[[<span class="bracket-tags">code:doc()</span>]]</span> oder <span class="bracket-tags-marker" id="fde6f875-1551-4b08-92cd-a3ef68466124">[[<span class="bracket-tags">code:document()</span>]]</span> ein zurückgeliefertes XML Fragment 
prozessiert wird, erwartet <span class="bracket-tags-marker" id="27252a9c-7acb-41de-b49b-b786c70ed3e2">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> z.B. einen <span data-tektur-editor-id="4ac95e33-f18e-417b-b5da-dded054b73b6" data-element="b" class="b">JSON-String</span>, der dann mittels
der Funktion <span class="bracket-tags-marker" id="3a4750f0-0c0f-473b-8745-183826650c82">[[<span class="bracket-tags">code:json-to-xml()</span>]]</span> nach XML konvertiert werden kann.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3b7e4ebd-cc5a-448c-8ae5-85e90302d51dd6e16" class="p pmarker tags" data-element="p" data-tektur-editor-id="d27098b7-0356-436c-bb08-54054f83e36e" contenteditable="true">Beispielsweise könnte die Gegenseite zum <span class="bracket-tags-marker" id="e758dadd-db7c-47ad-ad91-bf3db1c044a2">[[<span class="bracket-tags">code:angestellter</span>]]</span> Template mittels XQuery
folgendermassen realisiert sein:</div><div class="pre"><div data-attribute-id="44abda18-2c8a-497c-b073-527f6ca61a41d6e18" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="16edd777-94e2-40d6-9c4f-a0038357dd57" contenteditable="true">xquery version "1.0-ml";

declare variable $personal-id := xdmp:get-request-field('personal-id');

let $gekuendigt := if (collection('/personal')/*[personal-id = $personal-id and 
                                                 fn:exists(kuendingung)] then 
                                                 'ja' else 'nein'
return 
    common:render-response(concat('{"gekuendigt":"',$gekuendigt,'",
                                    "personal-id":"',$personal-id,'"}'))</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="83a12eb2-9d2c-4bea-9d00-463280925e65d6e20" class="p pmarker tags" data-element="p" data-tektur-editor-id="9b61a784-6403-42c2-a847-322e9237d131" contenteditable="true">(<span class="link" data-element="link" data-tektur-editor-id="86e61dc1-c690-4420-b3ce-83c39c6bf091" href="98665bd9-d40d-4fc7-ab7a-e340be6190a6" data-type="none">Mehr zu XQuery und den hier verwendeten Konstrukten</span>, wie <span class="bracket-tags-marker" id="e3c9c512-1ccc-4066-9ebb-792b72ac2193">[[<span class="bracket-tags">code:render-response()</span>]]</span>))</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="dc9f1757-17d5-4982-9f9b-b624dcc9f86cd6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="c692a216-b3a1-4382-80e2-5ecfa181ff6c" contenteditable="true">Das zurückgeklieferte JSON Dokument sieht dann so aus:</div><div class="pre"><div data-attribute-id="c161117f-55c8-41cb-b3c5-8967d2af3881d6e27" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="b9d7d18e-17fd-4d32-ae35-ae59c16d091b" contenteditable="true">{"gekuendig":"ja","personal-id":"q5687500"}</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c16d857e-bf25-4013-a637-fb1f1f42b212d6e27" class="p pmarker tags" data-element="p" data-tektur-editor-id="8dbbd655-1548-492b-8b7a-55ec71cfafe3" contenteditable="true">Konvertiert nach XML erhält man eine Map Struktur:</div><div class="pre"><div data-attribute-id="9d3e95ac-abab-48fa-84ff-71c78f312267d6e32" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ab8947ff-f97e-4782-8f58-e640bc2dc78c" contenteditable="true">&#x3C;map xmlns="http://www.w3.org/2005/xpath-functions"&#x3E;
    &#x3C;string key="gekuedigt"&#x3E;ja&#x3C;/string&#x3E;
    &#x3C;string key="personal-id"&#x3E;q5687500&#x3C;/string&#x3E;
&#x3C;/map&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5aa1c1a3-6eaa-470b-bbb0-9cecf34158c3d6e31" class="p pmarker tags" data-element="p" data-tektur-editor-id="22a90dfc-335a-4c1b-92ee-4d57a8b54ff4" contenteditable="true">was den Selektorausdruck im obigen XPATH erklärt:</div><div class="pre"><div data-attribute-id="15ca5326-b341-495e-90a5-ba9d5aa7c366d6e36" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="76585a60-e481-4126-9f8c-2c026ba17033" contenteditable="true">json-to-xml(
unparsed-text(
concat('https://tekturcms.de/personal.xqy?personal-id=',
personal-id))))/descendant::*[@key='gekuendigt']/text()</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="423a28a9-42c2-4e62-b73c-c2a48f68c079d6e35" class="p pmarker tags" data-element="p" data-tektur-editor-id="61ccd8fa-ed51-46ce-8b83-71d96b1b0714" contenteditable="true">Resultat der Konvertierung wäre also dann - wie erwartet - ein um 
das <span class="bracket-tags-marker" id="e2c3e75f-14fb-4482-aab0-2597ac502032">[[<span class="bracket-tags">code:gekuendigt</span>]]</span> Flag erweitertes <span class="bracket-tags-marker" id="079c90b2-3e9f-46d6-9e99-c8a9671be084">[[<span class="bracket-tags">code:&#x3C;angestellter&#x3E;</span>]]</span>
Element:</div><div class="pre"><div data-attribute-id="5fc5faca-8c42-473c-9010-2137e85d5eb2d6e40" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="5df060da-b7e4-4b9d-8f7b-ea0d4b4de323" contenteditable="true">&#x3C;angestellter&#x3E;
    &#x3C;perosnal-id&#x3E;q5687500&#x3C;/perosnal-id&#x3E;
    &#x3C;name&#x3E;Alex&#x3C;/name&#x3E;
    [...]
    &#x3C;gekuendigt&#x3E;nein&#x3C;/gekuendigt&#x3E;
&#x3C;/angestellter&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d6ebc0e3-4946-40df-99b9-89d396165f96d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="66da03e1-7c4f-4459-ad7e-9412b91585ee" contenteditable="true">Sicherlich wird der XML Entwicler eine <span class="link" data-element="link" data-tektur-editor-id="997e18de-4390-4b97-9f13-5198617f39e4" href="3337f433-44bf-430d-a809-73fd1de5ba6c" data-type="none">XML Datenbank</span>, wie MarkLogic, vorziehen
und sich gleich XML Fragmente ausliefern laasen. <span class="bracket-tags-marker" id="8a79e379-628f-490f-948c-bbb0f0aca4c3">[[<span class="bracket-tags">$productname</span>]]</span> ist aber bspw. mit
<span class="bracket-tags-marker" id="fe87ef78-e38c-4262-bd41-2e9650518b4b">[[<span class="bracket-tags">link</span>]]</span>MongoDB<span class="bracket-tags-marker" id="77c16422-37e8-44d5-a65b-3048f526281c">[[<span class="bracket-tags">fn:https://www.mongodb.com/*Homepage der NoSQL Datenbank MongoDB</span>]]</span>
realisiert, die auf JSON arbeitet... Nicht zuletzt deshalb finde ich JSON Verarbeitung
mit XSLT recht spannend.</div></div></div></div>