<div data-attribute-id="7f03cc5e-675a-4371-b3e9-5d79b981ff95" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="dfa83360-8edd-455c-ade4-66aa1483a238"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="fbbe8267-ed7b-4b78-b547-d00fe41f0b5c" class="title pmarker tags" data-element="title" data-tektur-editor-id="a0e86094-d701-4c3a-867d-3129de604cfe" contenteditable="true">Webservice Calls mit <span class="bracket-tags-marker" id="edececbb-ad01-4441-b81d-12ee68abab83">[[<span class="bracket-tags">code:doc()</span>]]</span> und <span class="bracket-tags-marker" id="31501cda-3627-4c7c-8bff-516edd9d4e6d">[[<span class="bracket-tags">code:unparsed-text()</span>]] </span></div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="01c79086-c69e-42db-a9a3-435cb64fc6b9"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="88a60629-eab7-40a0-b122-f05df4082fb6" contenteditable="true"></div></div><div data-attribute-id="813af5cb-f856-4d8c-996c-dd02e81732fd" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="a9deef74-4781-4654-991d-b3405dabc410"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="8fd40f97-635a-4940-8f08-abc7221c6867"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cfd5bdf8-a043-405f-a3f7-1feb395fbd3d" class="p pmarker tags" data-element="p" data-tektur-editor-id="f6fd5c8a-99fa-44c5-9a00-a43622321602" contenteditable="true">Eine verbreitete Paxis ist es, mit der Funktion <span class="bracket-tags-marker" id="cd0c072c-b3cb-46c4-b2b3-78530be06a4e">[[<span class="bracket-tags">code:document()</span>]]</span> oder kurz <span class="bracket-tags-marker" id="89868bc0-f5ec-4c76-b9e7-5cc928d72422">[[<span class="bracket-tags">code:doc()</span>]]</span> 
entfernte Ressourcen in die Transformation einzubinden. 
Bei einer Schematron-Validierung, würde bspw. eine Regel, wie:</div><div class="pre"><div data-attribute-id="3cba09e4-ffd4-4ac3-bcb3-fc1dbcc3ee17d7e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="35360e0d-c9fa-4fb7-b6cb-8adec2ad915a" contenteditable="true">&#x3C;sch:not-assert id="personal-check"
    role="error"
    test="doc(concat('https://tekturcms.de/personal.xqy?personal-id=',personal-id))/kuendigung"&#x3E;
        Angestellter mit ID "&#x3C;sch:value-of select="personal-id"/&#x3E;" hat gekündigt!
&#x3C;/sch:not-assert&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9fc3fa46-8e19-4c2b-90cf-0f2a76ef18eed6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="aaa58f5f-19b3-42ec-b510-a2151e0ed875" contenteditable="true">einen entferneten Webservice aufrufen und prüfen, ob für den Angestellten mit <span class="bracket-tags-marker" id="2a4df3fe-bd35-4b1d-a378-060e8af32220">[[<span class="bracket-tags">code:personal-id</span>]]</span>
eine Kündigung vorliegt. Ist dies der Fall, so ist die negative Zusicherung <span class="bracket-tags-marker" id="69e04d0a-1f04-44e7-ba1e-4e918ac9644c">[[<span class="bracket-tags">code:not-assert</span>]]</span> nicht
erfüllt und die Schematron Regel feuert - was sich wohl im einfachsten Fall in einem 
Logfile Eintrag äussern sollte.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="e3b1a6ca-7163-4c64-a69d-a1f4277847d5d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="a98df38b-8c61-431a-a4ec-af16093e367d" contenteditable="true">Was vermutlich viele noch nicht kennen - ich nehme jetzt einfach mal an, dass mein 
bisheriger Kenntnisstand dem der Mehrheit der XML-Entwickler entspricht - ist der Umstand,
dass auch die Funktion <span class="bracket-tags-marker" id="b9be8da7-b717-4b71-9cd0-cfaed91cfb7b">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> eine URL als Parameter nimmt:</div><div class="pre"><div data-attribute-id="57671ef1-5452-4264-b587-cb3b46da30bfd7e12" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="4f16ab59-d54d-4f76-8db1-83f9ebb166fc" contenteditable="true">&#x3C;xsl:template match="angestellter"
    &#x3C;xsl:copy&#x3E;
        &#x3C;xsl:apply-templates select="node()|@*"/&#x3E;
        &#x3C;hat-gekuendigt&#x3E;
            &#x3C;xsl:sequence select="json-to-xml(
                                  unparsed-text(
                                  concat('https://tekturcms.de/personal.xqy?personal-id=',
                                  personal-id))))/descendant::*[@key='gekuendigt']/text()"/&#x3E;
        &#x3C;/hat-gekuendigt&#x3E;
    &#x3C;/xsl:copy&#x3E;
&#x3C;/xsl:template&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9992ff44-8622-4832-a290-5b53de8787fbd6e14" class="p pmarker tags" data-element="p" data-tektur-editor-id="9feb66d4-17d3-45a8-ae00-d6b8c6ea7a31" contenteditable="true">Während mit <span class="bracket-tags-marker" id="a3850ace-9f01-40ba-9a14-173e5f9496f3">[[<span class="bracket-tags">code:doc()</span>]]</span> oder <span class="bracket-tags-marker" id="072bbd96-6ede-40e5-931f-de843232fd58">[[<span class="bracket-tags">code:document()</span>]]</span> ein zurückgeliefertes XML Fragment 
prozessiert wird, erwartet <span class="bracket-tags-marker" id="206b4de6-00b1-4c82-9976-1525c87079b0">[[<span class="bracket-tags">code:unparsed-text()</span>]]</span> z.B. einen <span data-attribute-id="cb9e283d-09cb-4e2f-a785-74aa1b809452d7e16" class="b" data-element="b">JSON-String</span>, der dann mittels
der Funktion <span class="bracket-tags-marker" id="f45547b0-02eb-4a67-82c0-c2e27cc18e32">[[<span class="bracket-tags">code:json-to-xml()</span>]]</span> nach XML konvertiert werden kann.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3b7e4ebd-cc5a-448c-8ae5-85e90302d51dd6e16" class="p pmarker tags" data-element="p" data-tektur-editor-id="2b1820b0-cfba-4d60-a5bc-b3eb7db2c539" contenteditable="true">Beispielsweise könnte die Gegenseite zum <span class="bracket-tags-marker" id="0d9b61ee-46d7-4115-8721-9355a9a4ca8b">[[<span class="bracket-tags">code:angestellter</span>]]</span> Template mittels XQuery
folgendermassen realisiert sein:</div><div class="pre"><div data-attribute-id="04c8549a-2518-4e71-ab1b-0c952216eb96d7e21" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="6ac9f884-a10f-46cd-8f91-340be2f8040a" contenteditable="true">xquery version "1.0-ml";

declare variable $personal-id := xdmp:get-request-field('personal-id');

let $gekuendigt := if (collection('/personal')/*[personal-id = $personal-id and 
                                                 fn:exists(kuendingung)] then 
                                                 'ja' else 'nein'
return 
    common:render-response(concat('{"gekuendigt":"',$gekuendigt,'",
                                    "personal-id":"',$personal-id,'"}'))</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="83a12eb2-9d2c-4bea-9d00-463280925e65d6e20" class="p pmarker tags" data-element="p" data-tektur-editor-id="cb242d25-a996-4fa8-984f-b4ed628dc146" contenteditable="true">(<span class="link" data-element="link" data-tektur-editor-id="86e61dc1-c690-4420-b3ce-83c39c6bf091" href="98665bd9-d40d-4fc7-ab7a-e340be6190a6" data-type="none">Mehr zu XQuery und den hier verwendeten Konstrukten</span>, wie <span class="bracket-tags-marker" id="1d4384d6-b69c-4476-b5d8-d7190a59fe2f">[[<span class="bracket-tags">code:render-response()</span>]]</span>))</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="dc9f1757-17d5-4982-9f9b-b624dcc9f86cd6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="9db09afb-6a38-4ec0-a0d7-361e2118951c" contenteditable="true">Das zurückgeklieferte JSON Dokument sieht dann so aus:</div><div class="pre"><div data-attribute-id="b36d8423-a987-4ad6-817c-89b909b532d5d7e30" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="034de245-5bef-4fe5-a691-c41e5cf0f1a2" contenteditable="true">{"gekuendig":"ja","personal-id":"q5687500"}</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c16d857e-bf25-4013-a637-fb1f1f42b212d6e27" class="p pmarker tags" data-element="p" data-tektur-editor-id="635f374b-2e1d-4cb0-92d1-734656b0163a" contenteditable="true">Konvertiert nach XML erhält man eine Map Struktur:</div><div class="pre"><div data-attribute-id="f7a44353-c804-4adf-87ec-e281deb255a8d7e35" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="90185971-dd3e-4825-8a86-2ef79e0d07c9" contenteditable="true">&#x3C;map xmlns="http://www.w3.org/2005/xpath-functions"&#x3E;
    &#x3C;string key="gekuedigt"&#x3E;ja&#x3C;/string&#x3E;
    &#x3C;string key="personal-id"&#x3E;q5687500&#x3C;/string&#x3E;
&#x3C;/map&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5aa1c1a3-6eaa-470b-bbb0-9cecf34158c3d6e31" class="p pmarker tags" data-element="p" data-tektur-editor-id="663b27f8-e583-4fb1-8517-d16b462bdded" contenteditable="true">was den Selektorausdruck im obigen XPATH erklärt:</div><div class="pre"><div data-attribute-id="346936e8-fd2c-4efc-af98-04b8b37d6e06d7e39" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="cd061c83-6793-4408-afba-9b4baedfbf6e" contenteditable="true">json-to-xml(
unparsed-text(
concat('https://tekturcms.de/personal.xqy?personal-id=',
personal-id))))/descendant::*[@key='gekuendigt']/text()</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="423a28a9-42c2-4e62-b73c-c2a48f68c079d6e35" class="p pmarker tags" data-element="p" data-tektur-editor-id="189d7bd3-a964-442a-b458-fa85408fabeb" contenteditable="true">Resultat der Konvertierung wäre also dann - wie erwartet - ein um 
das <span class="bracket-tags-marker" id="ce315995-5ecc-4be0-8753-a9271e0b5d31">[[<span class="bracket-tags">code:gekuendigt</span>]]</span> Flag erweitertes <span class="bracket-tags-marker" id="b6d9429f-fb51-4c48-ab0b-b34f6c29e75f">[[<span class="bracket-tags">code:&#x3C;angestellter&#x3E;</span>]]</span>
Element:</div><div class="pre"><div data-attribute-id="896ed103-a038-4f9b-a18a-9d4de02758d4d7e43" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="eb3f301d-bb47-4906-a4b3-0ae5171a6a85" contenteditable="true">&#x3C;angestellter&#x3E;
    &#x3C;perosnal-id&#x3E;q5687500&#x3C;/perosnal-id&#x3E;
    &#x3C;name&#x3E;Alex&#x3C;/name&#x3E;
    [...]
    &#x3C;gekuendigt&#x3E;nein&#x3C;/gekuendigt&#x3E;
&#x3C;/angestellter&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d6ebc0e3-4946-40df-99b9-89d396165f96d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="905fd39f-25c8-413d-85f4-ab478eb59136" contenteditable="true">Sicherlich wird der XML Entwicler eine <span class="link" data-element="link" data-tektur-editor-id="997e18de-4390-4b97-9f13-5198617f39e4" href="3337f433-44bf-430d-a809-73fd1de5ba6c" data-type="none">XML Datenbank</span>, wie MarkLogic, vorziehen
und sich gleich XML Fragmente ausliefern laasen. <span class="bracket-tags-marker" id="e8244fec-0c4e-4e1b-b467-b52498756f3f">[[<span class="bracket-tags">$productname</span>]]</span> ist aber bspw. mit
<span class="bracket-tags-marker" id="1a7ffedd-2410-411c-aa02-503708a75696">[[<span class="bracket-tags">link</span>]]</span>MongoDB<span class="bracket-tags-marker" id="de48f9eb-de88-4ad1-81ef-3667317b2047">[[<span class="bracket-tags">fn:https://www.mongodb.com/*Homepage der NoSQL Datenbank MongoDB</span>]]</span>
realisiert, die auf JSON arbeitet... Nicht zuletzt deshalb finde ich JSON Verarbeitung
mit XSLT recht spannend.</div></div></div></div>