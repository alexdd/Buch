<?xml version="1.0" encoding="UTF-8"?><topic id="7a4ded7e-6893-4283-8507-22575cb7e4bb"><title id="031a9203-60cb-46e7-b2bf-e7e21fe90d45">Hilfreiche XQuery Schippsel</title><body id="a208acaa-4319-41fa-83d9-752afeae469b"><p id="05773d2d-9893-43af-8d09-42f0576d575f">Unsortierte Schnippsel für die MarkLogic Konsole, die an mancher Stelle hilfreich sein könnten:</p><dl id="a5000499-e8e9-4c65-b38b-3c9a6e9026d6d7e6"><dlhead id="fbd4533f-7215-48d5-be16-e47580e45cf9d7e7"><dthd id="5f583414-ef91-4f28-9867-5987130b8be3d7e8">Beschreibung</dthd><ddhd id="0aa7eaa2-802c-46c4-989a-0ecea987eda1d7e10">Beispiel Code Schnippsel</ddhd></dlhead><dlentry id="18e4406d-c2b9-4e7c-8eef-6b7c5311f058d7e12"><dt id="36d5fb3e-7005-4ec1-9f51-f8fd974a6a9bd7e13">Datenbank löschen</dt><dd id="2955bc9e-760e-4feb-ac3a-08227c45cb06d7e15"><pre id="fe3c5973-6fea-45e9-b186-ceac1be9e211d7e16" xml:space="preserve">xdmp:forest-clear(

xdmp:database-forests(

xdmp:database("xml-scrapper-content")))</pre></dd></dlentry><dlentry id="1db258fe-af34-4508-9480-79e91d0b48dbd7e18"><dt id="ebfb1375-e14c-43da-8550-34abe0662375d7e19">Über Collection iterieren</dt><dd id="44f6f191-bdec-43bb-aedf-69e2fca6b642d7e21"><pre id="9e76d281-139a-47de-bd94-2bbf085e2562d7e22" xml:space="preserve">for $x in collection("/topics")
return
 (&lt;fname&gt;{ fn:document-uri($x) }&lt;/fname&gt;,
 $x)</pre></dd></dlentry><dlentry id="d7a87293-7f4e-4ac7-900b-fa73d9c3ba53d7e24"><dt id="828443db-c78d-4638-b4b3-fcf8882e8634d7e25">Attribut / Knoten ersetzen</dt><dd id="e2412243-d247-48bd-8494-a8f911eda9c8d7e27"><pre id="21f42beb-5ab7-4358-af79-da209085ce60d7e28" xml:space="preserve">for $ref in collection("/topics")//topicref
    let $topic := collection("/topics")
               [contains(fn:document-uri(.),$ref/@href)],
        $new := attribute href { $topic/topic/@id }
return 
  xdmp:node-replace($ref/@href,  $new)</pre></dd></dlentry><dlentry id="ccfadc33-1e2f-4e32-bb18-b42006225027d7e30"><dt id="242d3a98-13cd-4566-85ba-6c56246292e5d7e31">Dokument [[link]]"umbenennen"[[fn:https://developer.marklogic.com/recipe/move-a-document/*Rezept, wie man ein Dokument in MarkLogic "umbenennt"]]</dt><dd id="479e4c84-9810-4d55-afe3-b66dcece613fd7e33"><pre id="49989af1-c084-4491-8ccc-c1963670f378d7e34" xml:space="preserve">xdmp:document-insert(
  $new-uri,
  fn:doc($old-uri),
  xdmp:document-get-permissions($old-uri),
  xdmp:document-get-collections($old-uri)
 ),
 xdmp:document-delete($old-uri),
 xdmp:document-set-properties($new-uri, $properties</pre></dd></dlentry><dlentry id="742e10cf-94a6-493d-87eb-2948bfa44404d7e36"><dt id="33600895-64eb-4f7e-9829-73eb1c79c0c0d7e37">Über verschiedene Collections bestimmte Elemente suchen</dt><dd id="22fb834d-6497-48b8-be0c-9fb11d55296ad7e39"><pre id="e4a0f549-bd97-46c6-ba4f-5afb6d91137fd7e40" xml:space="preserve">for $element in cts:search(/descendant::*[self::b or 
                                         self::i or self::u], 
                cts:collection-query(("/topics", 
                                      "/tasks", "/maps")))
return $element/text()</pre></dd></dlentry><dlentry id="1e48802c-5681-44f2-b9ae-665df683b775d7e42"><dt id="ab1bdafd-4f98-43f6-b377-e780b2ee2fe6d7e43">Ein Element aus einem "Stack" holen und das Element vom Stack nehmen ("Pop")</dt><dd id="c63574d8-8d8f-4028-ae8d-67e4bb1ee6fed7e45"><pre id="278d29bc-91e9-49e4-b2c8-4b86d33017a7d7e46" xml:space="preserve">let $result := ( 
  for $stack in collection("/stack-pushed")
  order by $stack/some-element/some-criterion descending
  return
    $stack)[1] 
return (
  local:render-response($result),
  xdmp:document-set-collections(fn:document-uri($result), 
                               ("/stack-popped")</pre></dd></dlentry><dlentry id="c63605c2-4858-4569-a6a3-003916a7c9f3d7e48"><dt id="7ca0d9f9-d9f0-493c-ad16-2010d71e4f5dd7e49">Konvertierung nach JSON</dt><dd id="839c8bd6-caa4-40ef-9894-c7d572ab8e63d7e51"><pre id="4790d643-14d9-4d56-b1f2-73be868559b6d7e52" xml:space="preserve">let $xml:=
&lt;tektur-dita&gt;
{
for $x in collection("/topics")
return
 $x
}
&lt;/tektur-dita&gt;,
    $config := json:config("full") =&gt; 
               map:with("whitespace", "preserve")
    return json:transform-to-json( $xml , $config )</pre></dd></dlentry><dlentry id="8d4eee9a-9049-41e8-a576-06701189da7fd7e54"><dt id="a610f061-f78c-4772-87ba-67e34947d92ad7e55">Gib mir alle Dokumente, die nach dem 23.05.2019 zur (temporalen) Collection "/topics" hinzugefügt wurden</dt><dd id="1ec77dbb-68b8-40a1-a05e-ffec82a02feed7e57"><pre id="bb5a72ed-ed48-44d5-883b-801ede0f923dd7e58" xml:space="preserve">let $period := cts:period(
  xs:dateTime('0001-01-01T00:00:00'),
  xs:dateTime('2019-05-23T00:00:00')
)
return cts:search(
  collection("/topics"),
  cts:period-range-query('system-axis', 
                         'ISO_SUCCEEDS', 
                         $period)
)</pre></dd></dlentry><dlentry id="dc7412f2-fc59-4434-b72c-37ecca1ccc63d7e60"><dt id="773cde9f-8c93-41a7-99dc-98f9a56e9795d7e61">cURL Parameter um eine DB zu leeren (als Array Einträge im Python Code)</dt><dd id="20d5adab-561c-4dc2-8ed2-58a25a331b4ed7e63"><pre id="45b2f889-a453-4872-8542-16c234b000ffd7e64" xml:space="preserve">args = [
  'curl',
  '-X',
  'POST',
  '--anyauth',
  '-u',
  'admin:admin',
  '--header',
  'Content-Type:application/json',
  '-d',
  '{\"operation\":\"clear-database\"}',
  'http://localhost:8002/manage/
          v2/databases/mydb']</pre></dd></dlentry></dl></body></topic>