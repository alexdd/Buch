<?xml version="1.0" encoding="UTF-8"?><topic id="7a4ded7e-6893-4283-8507-22575cb7e4bb"><title id="031a9203-60cb-46e7-b2bf-e7e21fe90d45">Hilfreiche XQuery Schippsel</title><body id="a208acaa-4319-41fa-83d9-752afeae469b"><p id="05773d2d-9893-43af-8d09-42f0576d575f">Unsortierte Schnippsel für die MarkLogic Konsole, die an mancher Stelle hilfreich sein könnten:</p><dl id="a5000499-e8e9-4c65-b38b-3c9a6e9026d6d7e6"><dlhead id="823de881-74f7-4630-865d-c1f1d94224c3d7e7"><dthd id="b749d24d-e7b6-400e-80fb-dceba64cabc8d7e8">Beschreibung</dthd><ddhd id="de8f5b02-00b2-4d15-8a88-465459a35ea3d7e10">Beispiel Code Schnippsel</ddhd></dlhead><dlentry id="18e4406d-c2b9-4e7c-8eef-6b7c5311f058d7e12"><dt id="74bdbc1b-6548-4bb3-8cc1-53bf2ea95966d7e13">Datenbank löschen</dt><dd id="ae16c5b5-8562-4e73-ba4c-be855d730f14d7e15"><pre id="2d1a21f8-6c56-49ce-9cd3-76d2b89e42c1d7e16" xml:space="preserve">xdmp:forest-clear(

xdmp:database-forests(

xdmp:database("xml-scrapper-content")))</pre></dd></dlentry><dlentry id="1db258fe-af34-4508-9480-79e91d0b48dbd7e18"><dt id="a6be58b1-de4f-48cb-81bd-e13a868d0ea5d7e19">Über Collection iterieren</dt><dd id="1a5d04c0-67e4-4a15-aa42-b37f717ed63cd7e21"><pre id="ea9c3e46-6f5b-4e0e-9b7a-5f03bdc65f2bd7e22" xml:space="preserve">for $x in collection("/topics")
return
 (&lt;fname&gt;{ fn:document-uri($x) }&lt;/fname&gt;,
 $x)</pre></dd></dlentry><dlentry id="d7a87293-7f4e-4ac7-900b-fa73d9c3ba53d7e24"><dt id="7f1e0731-2467-4ddf-ab0c-7e0d8af8d59bd7e25">Attribut / Knoten ersetzen</dt><dd id="b94d3eca-aa1a-46a9-a6c9-902d9b3f4596d7e27"><pre id="dd450fd3-a668-4ce9-b483-0ec99a59dab1d7e28" xml:space="preserve">for $ref in collection("/topics")//topicref
    let $topic := collection("/topics")
               [contains(fn:document-uri(.),$ref/@href)],
        $new := attribute href { $topic/topic/@id }
return 
  xdmp:node-replace($ref/@href,  $new)</pre></dd></dlentry><dlentry id="ccfadc33-1e2f-4e32-bb18-b42006225027d7e30"><dt id="021ecd39-ab62-4a6e-a386-248f8f2d80d3d7e31">Dokument [[link]]"umbenennen"[[fn:https://developer.marklogic.com/recipe/move-a-document/*Rezept, wie man ein Dokument in MarkLogic "umbenennt"]]</dt><dd id="3a24d797-7cd6-4552-aa1e-84b72096325bd7e33"><pre id="bf371b66-4c79-49f1-a745-6310a282489fd7e34" xml:space="preserve">xdmp:document-insert(
  $new-uri,
  fn:doc($old-uri),
  xdmp:document-get-permissions($old-uri),
  xdmp:document-get-collections($old-uri)
 ),
 xdmp:document-delete($old-uri),
 xdmp:document-set-properties($new-uri, $properties</pre></dd></dlentry><dlentry id="742e10cf-94a6-493d-87eb-2948bfa44404d7e36"><dt id="980c052d-9122-4f84-a8f0-7493ede36054d7e37">Über verschiedene Collections bestimmte Elemente suchen</dt><dd id="875a2144-2f74-48a3-9feb-55057182741ed7e39"><pre id="147a1833-bf0e-4245-86f5-09e56738b7e5d7e40" xml:space="preserve">for $element in cts:search(/descendant::*[self::b or 
                                         self::i or self::u], 
                cts:collection-query(("/topics", 
                                      "/tasks", "/maps")))
return $element/text()</pre></dd></dlentry><dlentry id="1e48802c-5681-44f2-b9ae-665df683b775d7e42"><dt id="79acf347-b3c6-4fc6-823e-67acd75e9aced7e43">Ein Element aus einem "Stack" holen und das Element vom Stack nehmen ("Pop")</dt><dd id="9811d8de-8e41-4cfd-af8d-c39e24249cd7d7e45"><pre id="885602ca-6fc5-4108-821e-136ca1214d15d7e46" xml:space="preserve">let $result := ( 
  for $stack in collection("/stack-pushed")
  order by $stack/some-element/some-criterion descending
  return
    $stack)[1] 
return (
  local:render-response($result),
  xdmp:document-set-collections(fn:document-uri($result), 
                               ("/stack-popped")</pre></dd></dlentry><dlentry id="c63605c2-4858-4569-a6a3-003916a7c9f3d7e48"><dt id="5c6eac82-688f-4603-bfaa-cedebd8ee56ed7e49">Konvertierung nach JSON</dt><dd id="9483a819-446f-4dda-831f-de74d71df179d7e51"><pre id="a1566d1a-1707-4b19-b262-537a5ccbe77cd7e52" xml:space="preserve">let $xml:=
&lt;tektur-dita&gt;
{
for $x in collection("/topics")
return
 $x
}
&lt;/tektur-dita&gt;,
    $config := json:config("full") =&gt; 
               map:with("whitespace", "preserve")
    return json:transform-to-json( $xml , $config )</pre></dd></dlentry><dlentry id="8d4eee9a-9049-41e8-a576-06701189da7fd7e54"><dt id="aa901d93-6894-462e-ac30-dfe2c38ccf2bd7e55">Gib mir alle Dokumente, die nach dem 23.05.2019 zur (temporalen) Collection "/topics" hinzugefügt wurden</dt><dd id="31b77c01-df8c-4807-a424-d6e573d43c81d7e57"><pre id="76704768-07d6-443a-84cf-eb2ea717087ad7e58" xml:space="preserve">let $period := cts:period(
  xs:dateTime('0001-01-01T00:00:00'),
  xs:dateTime('2019-05-23T00:00:00')
)
return cts:search(
  collection("/topics"),
  cts:period-range-query('system-axis', 
                         'ISO_SUCCEEDS', 
                         $period)
)</pre></dd></dlentry></dl></body></topic>