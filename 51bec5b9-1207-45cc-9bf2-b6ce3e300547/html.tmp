<div data-attribute-id="51877293-95b9-4486-b8f6-c006615a8109" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="986b7a65-b2b7-493d-a5b0-b873f514742f"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="40515442-a67d-49f4-9945-0f9d227bd97e" class="title pmarker tags" data-element="title" data-tektur-editor-id="c0890644-a4b2-4c02-9235-4b5b69fd00eb" contenteditable="true">XSLT Akkumulator </div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="6c9918a5-ba23-4d71-a6c3-b244f354631c"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="ff5e9d91-3dc2-4c85-86a8-ce0dd7d76416" contenteditable="true"></div></div><div data-attribute-id="c582561a-858c-4fd8-8aeb-2af18ceedd3d" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="4ae806bb-b20e-4b81-8aec-48a72b211011"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="7c5cb95d-dec6-4728-be30-fea535aa4403"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6c3d953a-91cc-4be7-bf9d-65d3c6d6c75fd6e21" class="p pmarker tags" data-element="p" data-tektur-editor-id="d76f36a4-4577-478a-a17c-df3c2f74b511" contenteditable="true">Ein einfaches Streaming Stylesheet könnte z.B. so aussehen:</div><div class="pre"><div data-attribute-id="6f3f4202-eb15-429d-8920-07ba60ccfb82d7e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="bc1c05d2-ba00-4d02-abce-98149787a6ff" contenteditable="true">&#x3C;xsl:stylesheet version="3.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  exclude-result-prefixes="#all"&#x3E;
  
  &#x3C;xsl:output method="xml" indent="yes"/&#x3E;
  
  &#x3C;xsl:mode on-no-match="shallow-copy" use-accumulators="entry-count" streamable="true"/&#x3E;
  
  &#x3C;xsl:accumulator name="entry-count" as="xs:integer" initial-value="0" 
                   streamable="yes"&#x3E;
    &#x3C;xsl:accumulator-rule match="entry" select="$value + 1"/&#x3E;
  &#x3C;/xsl:accumulator&#x3E;
  
  &#x3C;xsl:template match="/"&#x3E;
    &#x3C;result&#x3E;
      &#x3C;xsl:apply-templates/&#x3E;
      &#x3C;count&#x3E;
        &#x3C;xsl:value-of select="accumulator-after('entry-count')"/&#x3E; 
      &#x3C;/count&#x3E;
    &#x3C;/result&#x3E;
  &#x3C;/xsl:template&#x3E;
  
&#x3C;/xsl:stylesheet&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="4ba7c650-d5a0-489c-9392-3ab548afa421d6e25" class="p pmarker tags" data-element="p" data-tektur-editor-id="f21fa322-dcd0-41fa-8cc4-33fd9538de22" contenteditable="true">Diese Stylesheet hat einige Besonderheiten:</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="06f1d8c6-03dd-4fa3-847b-4554e944f361d6e27" class="p pmarker tags" data-element="p" data-tektur-editor-id="95d53b2d-a8c7-46d9-9841-9a56b63a0c29" contenteditable="true">Zum einen wird darin ein Default-Modus deklariert, der jeden Knoten der Eingabeinstanz über
eine implizite <span class="bracket-tags-marker" id="c5ffc190-f189-4ca9-a280-c1627a57138d">[[<span class="bracket-tags">link</span>]]</span>Identity-Transformation (shallow-copy)<span class="bracket-tags-marker" id="d6435855-999b-4aff-8a03-15133847374e">[[<span class="bracket-tags">fn:https://www.saxonica.com/html/documentation/xsl-elements/mode.html*Mode Optionen in XSLT3.0</span>]]</span><span class="bracket-tags-marker" id="4fb7941e-98db-461d-b6a9-a97d09957093">[[<span class="bracket-tags">xe1:Verarbeitungsmethoden;xe2:Shallow Copy</span>]]</span>in die Ausgabeinstanz kopiert.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cda2834b-a464-49e5-9b3b-e8880252433cd6e29" class="p pmarker tags" data-element="p" data-tektur-editor-id="ef939b80-26e0-4450-9263-041114006ba3" contenteditable="true">Auf herkömmlichem Weg würde man dafür ein Templates wie dieses verwenden:</div><div class="pre"><div data-attribute-id="f29b9b53-a53a-47e7-9f4b-638ef53b8370d7e14" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="9911b46a-affc-41aa-b1a4-f36a3ce34ae4" contenteditable="true">&#x3C;xsl:template match="node()|@*"
  &#x3C;xsl:copy&#x3E;
    &#x3C;xsl:apply-templates select="node()|@*"/&#x3E;
  &#x3C;/xsl:copy&#x3E;
&#x3C;/xsl:template&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6deb7053-43b9-437d-8ce4-ec81a69a7795d6e34" class="p pmarker tags" data-element="p" data-tektur-editor-id="7c573542-bd44-4b68-9648-e9d4c298f57b" contenteditable="true">Zum anderen wird ein Akkumulator<span class="bracket-tags-marker" id="7bc29057-dd5b-4e01-b2ea-b6d39a73fa55">[[<span class="bracket-tags">xe1:Verarbeitungsmethoden;xe2:Akkumulator</span>]]</span> verwendet. Normalerweise gibt es in XSLT keine Variablen,
sondern nur Konstanten, so wie das auch bei funktionalen Programmiersprachen der Fall ist.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bce045c6-46f1-4745-8326-56beff21e266d6e36" class="p pmarker tags" data-element="p" data-tektur-editor-id="d7496b14-cb4d-4927-8474-1b63ef322365" contenteditable="true">Es gab zwar schon länger eine Saxon-Erweiterung, die die mehrmalige Zuweisung eines Wertes
an eine Variable erlaubte, im Normallfall braucht man diese Eigenschaft aber nicht.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="586338d8-49fa-4ddc-b715-99f9688ecd25d6e38" class="p pmarker tags" data-element="p" data-tektur-editor-id="14ad07f9-10cb-4662-8245-6986540acff4" contenteditable="true">Ber der Verarbeitung sehr großer Datemengen, ist es aber unumgänglich, denn sonst
würde der Laufzeitstapel schnell an seine Grenzen gelangen.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="4a5b2945-71be-4b5c-be7f-2e33cd717a4cd6e40" class="p pmarker tags" data-element="p" data-tektur-editor-id="818028f5-a9d6-4525-a795-52694bf1a15a" contenteditable="true">Ein Akkumulator akkumuliert Werte, wie der Name schon sagt. Das können atomare Typen sein,
wie im obigen Beispiel, aber auch Datenstrukturen können aufgebaut werden, wie 
bspw. das Abspeichern des gerade prozessierten Teilbaums in einem Dictionary zur 
späteren Auswertung bzw. Gruppierung der Key-Elemente.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="825af8ca-d2ab-4357-ba6b-bbf4863f201fd6e42" class="p pmarker tags" data-element="p" data-tektur-editor-id="f357f4b8-26a2-4b58-86fd-6b314097b131" contenteditable="true">Auch im Akkumulator muss das <span class="bracket-tags-marker" id="3065bdae-b9ba-4930-a8bc-4c9c3d1bf65e">[[<span class="bracket-tags">code:streamable="yes"</span>]]</span> Property gesetzt sein, wenn er im 
Streaming-Modus arbeiten soll. In diesem Modus kann der Akkumulatorwert erst ausgelesen werden,
wenn der untersuchte Baum vollständig durchlaufen wurde.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="8d27d621-4d12-4d40-a59e-8d58c45439a5d6e44" class="p pmarker tags" data-element="p" data-tektur-editor-id="61d1b667-2500-4c17-80da-e444ab0a2718" contenteditable="true">Um die Unterschiede zum "normalen" XSLT Betrieb festzustellen, können im obigen Beispiel 
einige offensichtlich korrekte Änderungen vorgenommen werden, die der Streaming 
Prozessor allerdings nicht akzeptiert.</div><div class="pre"><div data-attribute-id="c667f9ed-e8a5-4976-906f-3d9b47b589d3d7e29" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ef9f7dce-c651-45f4-ba01-aa1872560382" contenteditable="true">Cannot call accumulator-after except during the post-descent 
phase of a streaming template</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c9a77197-237e-49fd-80d3-18a443700c33d6e59" class="p pmarker tags" data-element="p" data-tektur-editor-id="9e34f871-4e75-47f1-baea-e9eb6fd04eed" contenteditable="true">Diese Fehlermeldung erscheint, wenn man den <span class="bracket-tags-marker" id="7dc8b2f0-075f-4583-8eac-eef57cbe0037">[[<span class="bracket-tags">code:apply-templates</span>]]</span> Call entfernt. Der Akkumulator
wird also nur befüllt, wenn der Baum auch explizit durchlaufen wurde. Dieser Durchlauf 
kann auch ein reines Kopieren sein, bspw. kann man den <span class="bracket-tags-marker" id="46ec9c2d-a8ad-4405-bc34-1a25521ccc1f">[[<span class="bracket-tags">code:apply-templates</span>]]</span> Call auch durch ein</div><div class="pre"><div data-attribute-id="d0aa03b6-3c6e-4577-a3dc-972ec362e73cd7e33" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="0bb06a9e-63b2-4730-9a4a-6ed872bea6d4" contenteditable="true">&#x3C;xsl:copy-of select="."/&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bd5669e8-e0e9-41d0-8854-f9c76aa6d3a3d6e63" class="p pmarker tags" data-element="p" data-tektur-editor-id="4767a2f5-9b9c-47bf-8ad5-88bc35319c58" contenteditable="true">ersetzen, was gleichbedeutend mit der Mode Einstellung</div><div class="pre"><div data-attribute-id="a3fb7034-edcc-40d6-b201-b745f28896c6d7e37" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="60bd8fdb-b020-4533-81cb-1ef343284696" contenteditable="true">on-no-match="deep-copy"</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="073cb9ea-9bed-41e8-ba73-b3cef15a5708d6e68" class="p pmarker tags" data-element="p" data-tektur-editor-id="786f2ca6-f825-4f54-b38b-7595ba62c114" contenteditable="true">wäre. Wie man sieht hat sich in XSLT 3.0 viel bzgl. der Handhabung verschiedener
Verarbeitungsmodi getan. Anstatt Default-Match Regeln zu schreiben, kann man ganz oben
am Stylesheet Modus Properties setzen, die den Baumdurchlauf auf verschiedene
Arten realisieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="29146b97-98e0-448f-8414-d8a9ee82e847d6e70" class="p pmarker tags" data-element="p" data-tektur-editor-id="16f5e6fd-7561-4674-9127-4ab1ea28bf1f" contenteditable="true">Die Verarbeitung großer Datenmenden ist aber mit Streaming etwas tricky und es sollte geprüft 
werden, ob ggf. konventionelles Performanz-optimiertes XSLT für den Answendungsfall ausreichen
würde.</div></div></div></div>