<?xml version="1.0" encoding="UTF-8"?><topic id="a619c6d9-57c8-4fde-a3c0-cf6002905cc1"><title id="28a8c9ba-33b0-41ff-8681-da976df43b85">Vortransformationen</title><body id="1b59d85e-4d01-4227-8ecf-cbdc2b9e5cb8"><p id="8a421545-f7a1-49b2-8250-75b86ca592f8">Bei einer komplexen Transformation ist es ratsam und sogar manchmal unabdingbar die Konvertierung in einzelne Stufen aufzuteilen. Das hat folgende Vorteile:</p><ul id="737c537d-59ca-4b31-993d-ff25f033dc0cd6e6"><li id="41798c1d-c1ce-460e-a35c-9dbb097c544dd6e7"><p id="1f775282-48f6-4e94-819e-d92684be1b88d6e8">Der Prozess ist transparenter, da die einzelnen Stufen leichter überschaubar sind.</p></li><li id="2e6bafcf-c36d-4b12-8cfb-5ec64ac2cbced6e10"><p id="f1e5f594-048a-4ce7-8a07-cd0c65f06729d6e11">Die Zwischenergebnisse können für Debug-Zwecke ausgewertet werde oder dienen als Eingabe für andere Prozesse.</p></li><li id="e93c815a-a050-4d75-a366-bd14372a3445d6e13"><p id="bf659729-4486-4a3b-b983-cec9d5748383d6e14">Nicht-relevante oder invalide Teilbäume können aus der Eingabeinstanz gefiltert werden, um so die weitere Verarbeitung zu beschleunigen.</p></li><li id="584020a1-f0e0-4be0-8eba-62e85ba5abd4d6e16"><p id="d115f521-f45c-4ae4-85e8-6ee9264558aed6e17">Hilfskonstrukte können erzeugt werden. Diese erleichtern die weitere Verarbeitung.</p></li></ul><p id="e76a9b14-f720-48ff-afad-95bbd80c53a7d6e19">Es gibt zwei Möglichkeiten, wie eine Vortransformation[[xe1:Verarbeitungsmethoden;xe2:Vortransformation]] eingebunden werden kann:</p><ul id="7093a130-54f7-4542-a76e-43833d6eed73d6e21"><li id="5c0c2b3e-b947-47c1-aa0f-35e5bd621d03d6e22"><p id="2bcf1845-b267-46ac-b853-627fd0a0f3bfd6e23">In einem separaten File bzw. einer XML Instanz, die vom XSLT Prozessor vor der eigentlichen Transformation aufgerufen wird und einen Zwischenstand produziert. Dieser kann dann als Eingabe für den Haupttransformationsschritt dienen.</p></li><li id="c0c25021-a503-40b9-8b11-6bea28ec4908d6e25"><p id="8f673f1d-8c7a-4616-93f2-d808745421ffd6e26">Innerhalb des eigentlichen XSLT Stylesheets. Hier wird das Ergebnis der Vortransformation in einer Variablen erzeugt.</p></li></ul><p id="e42f964a-137b-4b75-bfad-28dc54470a68d6e28">Den zweiten Punkt möchte ich anhand eines Beispiel XSLT Skripts vorführen. Betrachten wir folgende Input Daten:</p><pre id="227a6630-e137-433a-9671-f7f89b358989d7e30" xml:space="preserve">&lt;education-system&gt;
  &lt;administrative-regions&gt;
    [...]
    &lt;dministrative-region id="31" name="Bavaria"&gt;
      &lt;shools&gt;
        &lt;school id="45"&gt;
          &lt;teachers&gt;
            &lt;teacher id="576"/&gt;
            &lt;teacher id="345"/&gt;
            &lt;teacher id="12"/&gt;
          &lt;/teachers&gt;
        &lt;/school&gt;
        &lt;school id="36"&gt;
          &lt;teachers&gt;
            &lt;teacher id="576"/&gt;
            &lt;teacher id="8"/&gt;
          &lt;/teachers&gt;
        &lt;/school&gt;
        [...]
      &lt;/shools&gt;
    &lt;/dministrative-region&gt;
    [...]
  &lt;/administrative-regions&gt;
&lt;/education-system&gt;</pre><p id="8985af84-2126-4159-b493-540b65c41b58d6e32">Die erste Datei beinhaltet eine Zuordnung von Lehrern zu Schulen in verschiedenen Regierungsbezirken. Um die Daten zu den beiden referenzierten Objekten einzusehen, müssen zwei weitere Dateien konsultiert werden. Die Datei, welche die Lehrer auflistet:</p><pre id="5d49f862-e678-4852-a098-03d4b3db055bd7e34" xml:space="preserve">&lt;teachers&gt;
  [...]
  &lt;teacher id="576"&gt;
    &lt;first-name&gt;Alfons&lt;/first-name&gt;
    &lt;last-name&gt;Blimetsrieder&lt;/last-name&gt;
    &lt;subjects&gt;
      &lt;subject&gt;Biology&lt;/subject&gt;
      &lt;subject&gt;Math&lt;/subject&gt;
      &lt;subject&gt;Sport&lt;/subject&gt;
    &lt;/subjects&gt;
    &lt;suspended&gt;2017-12-31&lt;/suspended&gt;
    [...]
  &lt;/teacher&gt;
  [...]
&lt;/teachers&gt;</pre><p id="c35caf7a-807f-48b2-8973-1e575a619ae8d6e36">Und die Datei, welche die Schulen auflistet:</p><pre id="886efc5e-d9fd-4b43-9829-db972007d2b0d7e38" xml:space="preserve">&lt;schools&gt;
  [...]
  &lt;school id="45"&gt;
    &lt;name&gt;Gymnasium Bad Aibling&lt;/name&gt;
    &lt;type&gt;Oberschule&lt;/type&gt;
    [...]
  &lt;/school&gt;
  [...]
&lt;/schools&gt;</pre><p id="c8ee6679-b15c-45f7-9fca-aa269b19e54dd6e40">Um diese Daten verarbeiten zu können ist es sinnvoll, die drei Dateien in einem ersten "Resolver" Schritt zusammenzuführen und ggf. irrelevante Strukturen zu entfernen. Lehrer aus obigem Beispiel können beispielsweise suspendiert worden sein. Das folgende Skript erledigt dies mittels einer zusätzlichen Transformation in eine Variable:</p><pre id="ec208eb0-c542-4ab7-af49-47d809a58782d7e43" xml:space="preserve">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="2.0" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  exclude-result-prefixes="#all"&gt;
  
  &lt;xsl:output indent="yes" method="xml"/&gt;
  
  &lt;xsl:strip-space elements="*"/&gt;
  
  &lt;xsl:param name="file-1" required="yes"/&gt;
  &lt;xsl:param name="file-2" required="yes"/&gt;
  &lt;xsl:param name="file-3" required="yes"/&gt;
  
  &lt;xsl:variable name="files" select="(doc($file-1), doc($file-2), doc($file-3))"/&gt;
  &lt;xsl:variable name="bavaria-region-ids" select="(31, 58)"/&gt;
  
  &lt;xsl:key name="teachers" match="teacher" use="@id"/&gt;
  &lt;xsl:key name="schools" match="school" use="@id"/&gt;
  
  &lt;xsl:template name="main"&gt;
    &lt;xsl:variable name="resolve-result"&gt;
      &lt;xsl:apply-templates select="$files/administrative-regions" mode="resolve"/&gt;
    &lt;/xsl:variable&gt;
    &lt;xsl:apply-templates select="$resolve-result/administrative-regions"/&gt;
  &lt;/xsl:template&gt;
  
  &lt;xsl:template match="administrative-region[not(@id = $bavaria-region-ids)]" 
                mode="resolve"/&gt;

  &lt;xsl:template match="school" mode="resolve"&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:copy-of select="key('schools',@id, $files/schools[1]/root())/node()"/&gt;
      &lt;xsl:apply-templates select="node()|@*" mode="resolve"/&gt;      
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="teacher" mode="resolve"&gt;
    &lt;xsl:copy-of select="key('teachers',@id, $files/teachers[1]/root())/node()"/&gt;
  &lt;/xsl:template&gt;
    
  &lt;xsl:template match="teacher[suspended/xs:date(.) le current-date()]"/&gt;
  
  &lt;xsl:template match="node()|@*" mode="#all"&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:apply-templates mode="#current"/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;
  
&lt;/xsl:stylesheet&gt;</pre><p id="45fef16c-d685-4a23-9038-37e8b4ce1715d6e45">Im ersten Resolve-Schritt werden die Referenzen zu den Lehrer- und Schul-Objekten aufgelöst, d.h. die Attribute des Schul-Objekts werden in die Struktur aus der ersten Datei kopiert. </p><p id="e7b46b28-d440-4f91-b415-c4116e924876d6e47">Die Liste der Lehrer an diesen Schul-Objekten bleibt erhalten und wird mit dem Inhalt aus der zweiten Datei bestückt. </p><p id="aa88c1b0-cb8a-4647-8498-61e6d266fe18d6e47">Zusätzlich werden alle Regierungsbezirke entfernt, die nicht zu Bayern gehören - was die weitere Verarbeitung wesentlich beschleunigen wird. Lehrer die suspendiert worden sind fliegen ebenfalls raus ...</p></body></topic>