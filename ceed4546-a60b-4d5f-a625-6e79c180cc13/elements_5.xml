<?xml version="1.0" encoding="UTF-8"?><elements><element id="28a8c9ba-33b0-41ff-8681-da976df43b85" type="para">Vortransformationen</element><element id="8a421545-f7a1-49b2-8250-75b86ca592f8" type="para">Bei einer komplexen Transformation ist es ratsam und sogar manchmal unabdingbar die Konvertierung in einzelne Stufen aufzuteilen. Das hat folgende Vorteile:</element><element id="1f775282-48f6-4e94-819e-d92684be1b88d6e8" type="para">Der Prozess ist transparenter, da die einzelnen Stufen leichter überschaubar sind.</element><element id="f1e5f594-048a-4ce7-8a07-cd0c65f06729d6e11" type="para">Die Zwischenergebnisse können für Debug-Zwecke ausgewertet werde oder dienen als Eingabe für andere Prozesse.</element><element id="bf659729-4486-4a3b-b983-cec9d5748383d6e14" type="para">Nicht-relevante oder invalide Teilbäume können aus der Eingabeinstanz gefiltert werden, um so die weitere Verarbeitung zu beschleunigen.</element><element id="d115f521-f45c-4ae4-85e8-6ee9264558aed6e17" type="para">Hilfskonstrukte können erzeugt werden. Diese erleichtern die weitere Verarbeitung.</element><element id="e76a9b14-f720-48ff-afad-95bbd80c53a7d6e19" type="para">Es gibt zwei Möglichkeiten, wie eine Vortransformation eingebunden werden kann:</element><element id="2bcf1845-b267-46ac-b853-627fd0a0f3bfd6e23" type="para">In einem separaten File bzw. einer XML Instanz, die vom XSLT Prozessor vor der eigentlichen Transformation aufgerufen wird und einen Zwischenstand produziert. Dieser kann dann als Eingabe für den Haupttransformationsschritt dienen.</element><element id="8f673f1d-8c7a-4616-93f2-d808745421ffd6e26" type="para">Innerhalb des eigentlichen XSLT Stylesheets. Hier wird das Ergebnis der Vortransformation in einer Variablen erzeugt.</element><element id="e42f964a-137b-4b75-bfad-28dc54470a68d6e28" type="para">Den zweiten Punkt möchte ich anhand eines Beispiel XSLT Skripts vorführen. Betrachten wir folgende Input Daten:</element><element id="72053434-1094-4b3a-af53-c229a8961fccd7e30" type="code">&lt;education-system&gt; &lt;administrative-regions&gt; [...] &lt;dministrative-region id=\"31\" name=\"Bavaria\"&gt; &lt;shools&gt; &lt;school id=\"45\"&gt; &lt;teachers&gt; &lt;teacher id=\"576\"\/&gt; &lt;teacher id=\"345\"\/&gt; &lt;teacher id=\"12\"\/&gt; &lt;\/teachers&gt; &lt;\/school&gt; &lt;school id=\"36\"&gt; &lt;teachers&gt; &lt;teacher id=\"576\"\/&gt; &lt;teacher id=\"8\"\/&gt; &lt;\/teachers&gt; &lt;\/school&gt; [...] &lt;\/shools&gt; &lt;\/dministrative-region&gt; [...] &lt;\/administrative-regions&gt; &lt;\/education-system&gt;</element><element id="8985af84-2126-4159-b493-540b65c41b58d6e32" type="para">Die erste Datei beinhaltet eine Zuordnung von Lehrern zu Schulen in verschiedenen Regierungsbezirken. Um die Daten zu den beiden referenzierten Objekten einzusehen, müssen zwei weitere Dateien konsultiert werden. Die Datei, welche die Lehrer auflistet:</element><element id="7fdfa44b-3361-4168-aacc-70421607e901d7e34" type="code">&lt;teachers&gt; [...] &lt;teacher id=\"576\"&gt; &lt;first-name&gt;Alfons&lt;\/first-name&gt; &lt;last-name&gt;Blimetsrieder&lt;\/last-name&gt; &lt;subjects&gt; &lt;subject&gt;Biology&lt;\/subject&gt; &lt;subject&gt;Math&lt;\/subject&gt; &lt;subject&gt;Sport&lt;\/subject&gt; &lt;\/subjects&gt; &lt;suspended&gt;2017-12-31&lt;\/suspended&gt; [...] &lt;\/teacher&gt; [...] &lt;\/teachers&gt;</element><element id="c35caf7a-807f-48b2-8973-1e575a619ae8d6e36" type="para">Und die Datei, welche die Schulen auflistet:</element><element id="72aabe6a-c85e-4fca-96d6-efab32578e92d7e38" type="code">&lt;schools&gt; [...] &lt;school id=\"45\"&gt; &lt;name&gt;Gymnasium Bad Aibling&lt;\/name&gt; &lt;type&gt;Oberschule&lt;\/type&gt; [...] &lt;\/school&gt; [...] &lt;\/schools&gt;</element><element id="c8ee6679-b15c-45f7-9fca-aa269b19e54dd6e40" type="para">Um diese Daten verarbeiten zu können ist es sinnvoll, die drei Dateien in einem ersten \"Resolver\" Schritt zusammenzuführen und ggf. irrelevante Strukturen zu entfernen. Lehrer aus obigem Beispiel können beispielsweise suspendiert worden sein. Das folgende Skript erledigt dies mittels einer zusätzlichen Transformation in eine Variable:</element><element id="7bd0ae1b-b214-4086-ad34-36bcd8076a75d7e43" type="code">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http:\/\/www.w3.org\/1999\/XSL\/Transform\" exclude-result-prefixes=\"#all\"&gt; &lt;xsl:output indent=\"yes\" method=\"xml\"\/&gt; &lt;xsl:strip-space elements=\"*\"\/&gt; &lt;xsl:param name=\"file-1\" required=\"yes\"\/&gt; &lt;xsl:param name=\"file-2\" required=\"yes\"\/&gt; &lt;xsl:param name=\"file-3\" required=\"yes\"\/&gt; &lt;xsl:variable name=\"files\" select=\"(doc($file-1), doc($file-2), doc($file-3))\"\/&gt; &lt;xsl:variable name=\"bavaria-region-ids\" select=\"(31, 58)\"\/&gt; &lt;xsl:key name=\"teachers\" match=\"teacher\" use=\"@id\"\/&gt; &lt;xsl:key name=\"schools\" match=\"school\" use=\"@id\"\/&gt; &lt;xsl:template name=\"main\"&gt; &lt;xsl:variable name=\"resolve-result\"&gt; &lt;xsl:apply-templates select=\"$files\/administrative-regions\" mode=\"resolve\"\/&gt; &lt;\/xsl:variable&gt; &lt;xsl:apply-templates select=\"$resolve-result\/administrative-regions\"\/&gt; &lt;\/xsl:template&gt; &lt;xsl:template match=\"administrative-region[not(@id = $bavaria-region-ids)]\" mode=\"resolve\"\/&gt; &lt;xsl:template match=\"school\" mode=\"resolve\"&gt; &lt;xsl:copy&gt; &lt;xsl:copy-of select=\"key('schools',@id, $files\/schools[1]\/root())\/node()\"\/&gt; &lt;xsl:apply-templates select=\"node()|@*\" mode=\"resolve\"\/&gt; &lt;\/xsl:copy&gt; &lt;\/xsl:template&gt; &lt;xsl:template match=\"teacher\" mode=\"resolve\"&gt; &lt;xsl:copy-of select=\"key('teachers',@id, $files\/teachers[1]\/root())\/node()\"\/&gt; &lt;\/xsl:template&gt; &lt;xsl:template match=\"teacher[suspended\/xs:date(.) le current-date()]\"\/&gt; &lt;xsl:template match=\"node()|@*\" mode=\"#all\"&gt; &lt;xsl:copy&gt; &lt;xsl:apply-templates mode=\"#current\"\/&gt; &lt;\/xsl:copy&gt; &lt;\/xsl:template&gt; &lt;\/xsl:stylesheet&gt;</element><element id="45fef16c-d685-4a23-9038-37e8b4ce1715d6e45" type="para">Im ersten Resolve-Schritt werden die Referenzen zu den Lehrer- und Schul-Objekten aufgelöst, d.h. die Attribute des Schul-Objekts werden in die Struktur aus der ersten Datei kopiert.</element><element id="e7b46b28-d440-4f91-b415-c4116e924876d6e47" type="para">Die Liste der Lehrer an diesen Schul-Objekten bleibt erhalten und wird mit dem Inhalt aus der zweiten Datei bestückt.</element><element id="aa88c1b0-cb8a-4647-8498-61e6d266fe18d6e47" type="para">Zusätzlich werden alle Regierungsbezirke entfernt, die nicht zu Bayern gehören - was die weitere Verarbeitung wesentlich beschleunigen wird. Lehrer die suspendiert worden sind fliegen ebenfalls raus ...</element></elements>