<div data-attribute-id="7ca48bd5-7f2e-44cd-aacd-c15f7618b43e" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="27fc40ed-999e-404d-b124-2a4b32ede358"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="ba9dfb96-d3dd-49c8-9008-8476c0e59728" class="title pmarker tags" data-element="title" data-tektur-editor-id="f6f9d867-456a-41c1-ba92-f7c909ad4e95" contenteditable="true">Bi-Temporale Dokumente</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="3d69d4fc-6513-476f-b6b8-66ca27f82e5b"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="f01846e3-441e-4dda-b96c-74609dfc35ce" contenteditable="true"></div></div><div data-attribute-id="631dac5b-f444-4489-896e-cfc73963b9c5" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="5d9ed442-0ce3-47bf-bf3d-8e0a7381ecfe"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="adb1b9e4-3bf4-4f3b-af73-76e12acf9d15"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="fd257336-1ea5-47eb-8795-ac4f22576a8e" class="p pmarker tags" data-element="p" data-tektur-editor-id="8fb7c7d3-3bb5-421a-8027-ff3c1575b968" contenteditable="true">Wenn wir zwischen der Zeit in der das Dokument, bspw. ein Vetrag 
in der DB angelegt wird, und der Zeit in der ein Vetrag zwischen zwei 
Vetragspartnern abgeschlossen wird unterscheiden, dann betrachten
wir zwei Zeitachsen.</div><ul data-attribute-id="d4916e18-adeb-49ee-8153-3b978adbc1afd6e6" class="ul tags" data-element="ul" data-tektur-editor-id="385912d8-8038-4309-a246-bc4c0040645d"><li data-attribute-id="a68bfa03-4a70-4f8e-b66b-250de1496fc6d6e7" class="li tags" data-element="li" data-tektur-editor-id="9de75d19-81b1-409c-a1e7-886961e1b597"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="46d3aa4f-711a-488f-bf81-077849243208d6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="5943f48f-9263-4ef2-b529-e50c03db5623" contenteditable="true">die gültige Zeit (Valid Time)</div></li><li data-attribute-id="d8139f88-a56e-4e2a-9d68-5ccdfe70de4ad6e10" class="li tags" data-element="li" data-tektur-editor-id="ddde25b6-be47-4f63-b783-dbdb1a24ca1f"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="4163702b-b6e9-40ec-b389-2a8af0afae33d6e11" class="p pmarker tags" data-element="p" data-tektur-editor-id="6dd972ca-1e04-4f44-8f7c-6542c568bdb8" contenteditable="true">die Systemzeit (System Time)</div></li></ul><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="fab57861-93d5-47d3-8046-7b0d2c180b5cd6e13" class="p pmarker tags" data-element="p" data-tektur-editor-id="54d881d2-7864-4cad-87d7-0320f829954d" contenteditable="true">Für die Vetragspartner ist nur die gültige Zeit relevant. Das Zeitfenster
zwischen gültiger Zeit und Systemzeit ist jedoch in manchen Fällen
ausschlaggebend.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="50e4e500-a66d-4744-9730-1e4da489e1f8d6e15" class="p pmarker tags" data-element="p" data-tektur-editor-id="b4811800-fa07-45f3-a386-380835b6e155" contenteditable="true">Bsp: Kürzlich wurde
meine Geldbörse mit meinem Perso geklaut. Beim Austellen eines vorläufigen
Ausweises wurde ich schriftlich darauf hingewiesen, dass nun mein Perso
bei Interpol zur Fahndung ausgeschrieben ist.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="93133dc8-bb02-4da9-b779-64955be86d07d6e17" class="p pmarker tags" data-element="p" data-tektur-editor-id="c412e983-f185-41ed-b728-69720b4cd351" contenteditable="true">Kurze Zeit später fand ein netter Herr die Geldbörse ohne Geld aber 
mit allen Papieren in seinem Garten. Bei einer anschliessenden Busfahrt mit einem
Fernbus, wurde ich bei einer Zollkontrolle festgehalten, da die Systemzeit
des Vorgangs im System der Polizei noch nicht aktualisiert war.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="1fee1c3d-dd8b-4649-85ce-5b3d23ecec18d6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="b133e1d4-8c26-4031-b2c1-fad10f937c62" contenteditable="true">Ich nehme an, dass nach meiner Unschuldsbekundung der Vorgang auch
auf Seiten des Polizeicomputers aktualisiert wurde. Nun könnte man zwei Fragen
stellen:</div><ol data-attribute-id="6adc97a7-ba28-4619-ba64-bbb29b702aded6e21" class="ol tags" data-element="ol" data-tektur-editor-id="35b8b632-1d3f-46c7-8592-115aea6bfda6"><li data-attribute-id="602e5f1b-90a5-40c2-a2cf-a89803cf1153d6e22" class="li tags" data-element="li" data-tektur-editor-id="52031b61-e015-45f5-af9b-ccaa3997e068"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="5664c21f-b0b1-4c4f-a8f1-251415142a7cd6e23" class="p pmarker tags" data-element="p" data-tektur-editor-id="db1ccfdd-35c1-4430-80a7-c44c5e3d2122" contenteditable="true">Ist das Festhalten seitens der Zollbeamten rechtens?</div></li><li data-attribute-id="8d9e0d92-4a1a-4a08-a08c-1f1d7f212bd6d6e25" class="li tags" data-element="li" data-tektur-editor-id="d3b82d5c-c015-45dd-aae1-78b0cd2c608b"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="94fb012d-2fbb-4d68-b285-c05ccb98f507d6e26" class="p pmarker tags" data-element="p" data-tektur-editor-id="ba0d4537-87be-468c-be9e-57cc6ee7a418" contenteditable="true">Habe ich mich durch ein verspätetes Anzeigen des Funds schuldig gemacht?</div></li></ol><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="0010581d-bfae-4f1e-9b69-600f4992f4bd" contenteditable="true"></div><div data-element="note" class="show_menu tags" data-tektur-editor-id="96bc594a-3fec-455b-9926-3250b114d9b0"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="note"><div class="signal-word">NOTE</div><div class="hcontent"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="f93b1ee9-1f0e-4d60-a375-7e32300f4d41d6e29" class="p pmarker tags" data-element="p" data-tektur-editor-id="ef4501e2-7ef2-49e4-a2a3-f38df6f31b59" contenteditable="true">Beachte, dass man diese Fragen auch noch nach 10 Jahren stellen
könnte und das - bei meinem Pech in diesen Angelegenheiten - auch
so ein Vorfall noch öfters passieren könnte.</div></div></div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="19976305-dbf8-447b-bf4e-b0e849b7e741d6e31" class="p pmarker tags" data-element="p" data-tektur-editor-id="6fe1e0b9-61d5-42a0-9f11-b5b4b39def82" contenteditable="true">Um diese Fragen zu beantworten, müsste unsere Datenbank in der Lage sein,
eine bitemporäre Query auszuführen. Zunächst registerieren wir den Vorgang
des Persoverlustes in unserer Marklogic Datenbank:</div><div data-element="note" class="show_menu tags" data-tektur-editor-id="63bc762d-a312-4568-a344-b80274149260"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="note"><div class="signal-word">NOTE</div><div class="hcontent"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bc4e68d9-d093-46bc-bf26-de40abdc0486d6e34" class="p pmarker tags" data-element="p" data-tektur-editor-id="89160f3b-2da6-46e9-85b9-6b00a2d6bab8" contenteditable="true">Da wir hier auf einer XML Datenbank arbeiten, sprechen wir von einem Dokument,
wenn einen Datensatz meinen. Der Datensatz bzw. das Dokument wird nicht aktualisiert, sondern stattdessen das Dokument mit den aktualisierten Daten in einer neuen Version angelegt. Auf diese Weise bleibt die Änderungshistorie erhalten.</div></div></div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="220cfd57-f223-4c67-8ef4-164d001bca0f" contenteditable="true"></div><div class="pre"><div data-attribute-id="e494a7f1-74eb-47a1-ac25-b05a05ebde7cd6e36" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="3d2e9be4-f551-44ae-8f45-dd7660aa9716" contenteditable="true">xquery version "1.0-ml";
import module namespace temporal = 
       "http://marklogic.com/xdmp/temporal" at "/MarkLogic/temporal.xqy";   
let $root :=    
  &#x3C;vorgang&#x3E;     
    &#x3C;perso-id&#x3E;XYZ&#x3C;/perso-id&#x3E;    
    &#x3C;name&#x3E;Alex Düsel&#x3C;/name&#x3E;   
    &#x3C;status&#x3E;gestohlen&#x3C;/status&#x3E;
  &#x3C;/vorgang&#x3E;
let $options :=   
  &#x3C;options xmlns="xdmp:document-insert"&#x3E;     
    &#x3C;metadata&#x3E;        
      &#x3C;map:map xmlns:map="http://marklogic.com/xdmp/map"&#x3E;          
        &#x3C;map:entry key="validStart"&#x3E;            
	  &#x3C;map:value&#x3E;2019-02-01T08:23:11&#x3C;/map:value&#x3E;          
	&#x3C;/map:entry&#x3E;          
	&#x3C;map:entry key="validEnd"&#x3E;            
	  &#x3C;map:value&#x3E;9999-12-31T11:59:59Z&#x3C;/map:value&#x3E;          
	&#x3C;/map:entry&#x3E;         
      &#x3C;/map:map&#x3E;    
    &#x3C;/metadata&#x3E;  

return  temporal:document-insert("/perso-verluste", 
                                 "duesel_alex_270774.xml", 
                                 $root, $options)</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="34c9ed87-b6df-4fde-bda2-1b868aac4838d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="bc1785a4-48c2-47d7-b22e-05c4344faca6" contenteditable="true">Unser Enddatum liegt in ferner Zukunft sicherzustellen, dass der Vorgang auf unbestimmte Zeit
im System bleibt.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="500405f5-6396-4071-8349-1d9f6d39049dd6e41" class="p pmarker tags" data-element="p" data-tektur-editor-id="57ca443c-46cd-4131-a7b0-f4c4282af3ce" contenteditable="true">Drei Tage später hatte ich meinen Ausweis wieder und der Vorgang wurde vier Tage später,
mit dem Status "gefunden" im Polizeicomputer aktualisiert:</div><div class="pre"><div data-attribute-id="d6f479e5-55f3-4f5a-89ca-8c19f80c0378d6e43" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="d9ab0908-e8f6-4e23-a934-bd461a18490c" contenteditable="true">xquery version "1.0-ml";
import module namespace temporal = 
       "http://marklogic.com/xdmp/temporal" at "/MarkLogic/temporal.xqy";   
let $root :=    
  &#x3C;vorgang&#x3E;     
    &#x3C;perso-id&#x3E;XYZ&#x3C;/perso-id&#x3E;    
    &#x3C;name&#x3E;Alex Düsel&#x3C;/name&#x3E;   
    &#x3C;status&#x3E;<span data-attribute-id="a02c8c57-b464-4265-8a18-5c0a3c298d51d6e45" class="b tags" data-element="b" data-tektur-editor-id="e5dcfb4d-7be6-4829-afaa-132eb7c4f08c">gefunden</span>&#x3C;/status&#x3E;
  &#x3C;/vorgang&#x3E;
let $options :=   
  &#x3C;options xmlns="xdmp:document-insert"&#x3E;     
    &#x3C;metadata&#x3E;        
      &#x3C;map:map xmlns:map="http://marklogic.com/xdmp/map"&#x3E;          
        &#x3C;map:entry key="validStart"&#x3E;            
	  &#x3C;map:value&#x3E;2019-02-06T08:00:00&#x3C;map:value&#x3E;          
	&#x3C;/map:entry&#x3E;          
	&#x3C;map:entry key="validEnd"&#x3E;            
	  &#x3C;map:value&#x3E;9999-12-31T11:59:59Z&#x3C;/map:value&#x3E;          
	&#x3C;/map:entry&#x3E;         
      &#x3C;/map:map&#x3E;    
    &#x3C;/metadata&#x3E;  

return  temporal:document-insert("/perso-verluste", 
                                 "duesel_alex_270774.xml", 
                                 $root, $options)</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="7dbc517d-b5b4-4c1b-b691-7d20f6c61c12d6e48" class="p pmarker tags" data-element="p" data-tektur-editor-id="6ab97fbd-8861-4d8f-bbaa-e12855081e2c" contenteditable="true">Nach der Aktualisierung enthält unsere Datenbank logisch gesehen drei Dokumente zu diesem Vorgang, 
die über eine Query gesucht werden können:</div><ol data-attribute-id="0cbdea46-7a48-4ab4-b77f-a84d534dd173d6e50" class="ol tags" data-element="ol" data-tektur-editor-id="c0d7b700-c91d-4ad6-97e5-51039384dd52"><li data-attribute-id="28111bf7-7f3b-4f08-a7d7-709dffa709efd6e51" class="li tags" data-element="li" data-tektur-editor-id="8b1a5024-ec93-4fae-8f79-9ed3dcee83ae"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="d112decc-3611-40d4-b9ca-0a55258e223ed6e52" class="p pmarker tags" data-element="p" data-tektur-editor-id="aaf60d2f-9c38-4fb7-b04b-4ad76df45bbe" contenteditable="true">Das Originaldokument, es ist vom 1.2.2019 bis zum 5.2.2019 im System aktiv</div></li><li data-attribute-id="da0adb7d-82a2-4f2b-8a31-4180a0f5c89ed6e54" class="li tags" data-element="li" data-tektur-editor-id="e0a13dcb-33fc-4a67-8890-03b4f4d79800"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3a23cb95-2f16-4254-8245-c0bf90780a1bd6e55" class="p pmarker tags" data-element="p" data-tektur-editor-id="7aa2a609-ac15-48a6-b9f2-eb40ee59d79b" contenteditable="true">Die Aktualisierung, sie ist ab dem 6.2.2019 aktiv</div></li><li data-attribute-id="7e0f4570-b3ae-4ee7-8fb5-51d9163652efd6e57" class="li tags" data-element="li" data-tektur-editor-id="8ffbcda1-5927-434b-8dd2-a1b020ca4b99"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="9d2d4a7b-bdf2-42e8-a024-cb053a126324d6e58" class="p pmarker tags" data-element="p" data-tektur-editor-id="4a5c20ec-7f96-473c-a4d8-631e25065cb6" contenteditable="true">Ein "Split"-Dokument, das aus der verspäteten Aktualisierung resultiert. Es ist ab dem 6.2.2019 im System aktiv, 
und zeigt den Zeitraum über einen Tag, vom 4.2.2019 bis 5.2.2019, in dem ich ohne Perso registriert war, aber tatsächlich
schon einen hatte.</div></li></ol><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="6dc19f9e-db12-4a7c-83cd-42bb430d2c07d6e60" class="p pmarker tags" data-element="p" data-tektur-editor-id="1396c5d7-9de4-47da-9063-8c8f6ae78356" contenteditable="true">Im Gegensatz zu einer herkömmlichen Datenhaltung, bei der ein Datensatz aktualisiert wird - ggf. noch eine neue
Version angelegt wird, wird beim Dokument-basierten Ansatz mit bi-temporaler Datenhaltung jede Transaktion separat
abgespeichert. Das ist vergleichbar mit einer Simulation des tatsächlichen Papierverkehrs bei buchhalterischen Tätigkeiten.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="b2db7425-9d5b-4429-9ca6-51a67a0a34d0d6e62" class="p pmarker tags" data-element="p" data-tektur-editor-id="f0a3d4b1-5242-488b-90d4-e07313b7ad5c" contenteditable="true">Die Abfrage so einer Datenbank ist natürlich dadurch nicht einfacher. Drei Queries, die jeweils eines dieser drei
Dokumente zurückgeben, könnten bspw. so aussehen:</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="9d47d682-3e39-4260-a6c8-c23c94c43234"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="89540fb7-314d-4f40-81ce-500c9e144128d6e65" class="title pmarker tags" data-element="title" data-tektur-editor-id="1cd9be7a-286b-41e2-9328-eee4767c9b33" contenteditable="true">Rückgabe des Originals:</div><div class="pre"><div data-attribute-id="03c039f7-97df-4ec6-b03c-eda7612c55c7d6e67" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="ac5ed29b-218d-451e-a41f-221b2e4f6e1c" contenteditable="true">xquery version "1.0-ml";
cts:search(fn:doc(), cts:period-range-query(
  "system",     
  "ISO_CONTAINS",     
  cts:period(xs:dateTime("2019-02-02T00:00:00"),                
             xs:dateTime("2019-02-03T23:59:59")) )</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="85da93d2-27b2-4616-8344-e37199961e81d6e69" class="p pmarker tags" data-element="p" data-tektur-editor-id="9578ddcf-cc39-4317-8777-55d5fc4ee35f" contenteditable="true">Hier wird geprüft, ob ein Dokument im System aktiv war, dass den Zeitraum vom 2.3. bis zum 3.3 umfasste.
Diese Query ist erfolgreich und gibt das Original-Dokument des Vorgangs zurück: In diesem Zeitraum
war ich mit gestohlenem Perso registriert.</div></div></div></div>