[{"id":"a1776d29-3de4-4aeb-9f82-1718bfdb333e","type":"para","text":"Anlegen des Testszenarios auf der ML Konsole","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"2104ae8b-6b06-4e0c-902d-b3dcaca2482b","type":"para","text":"Die Codefragmente aus dem vorherigen Kapitel sind folgend für eine ML Konsolensitzung aufbereitet:","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"a626e0cb-bd49-489b-8765-cdb123a70a52d6e10","type":"para","text":"Anlegen der temporalen Properties: , , ,","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"7690410f-a848-48ac-9ac1-d2b0c3a7cbf5d6e13","type":"para","text":"Anlegen der Indizes zum Suchen über Zeitbereiche:","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"8659af6f-9564-4553-a739-941223db12d0d6e16","type":"para","text":"Anlegen der zwei Zeitachsen und","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"fc9beb7e-9542-46c0-ae1b-b797b1b3df50d6e19","type":"para","text":"Anlegen der temporalen Collection","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"f7340d19-8dc9-4530-a6b8-40eab7f87459d6e20","type":"para","text":"Anlegen des Originals am 1.2.2019","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"ded7a86f-a732-45dd-841d-ad7155ce16dad6e23","type":"para","text":"Aktualisierung am 6.2.2019","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"1eb047a9-b575-4e4f-86f2-077d7a305b53d7e25","type":"code","text":"xquery version \"1.0-ml\"; import module namespace admin = \"http:\/\/marklogic.com\/xdmp\/admin\" at \"\/MarkLogic\/admin.xqy\"; import module namespace temporal = \"http:\/\/marklogic.com\/xdmp\/temporal\" at \"\/MarkLogic\/temporal.xqy\"; declare namespace local = 'local:'; declare variable $db := \"alex-test\"; declare function local:create-temporal-fields() { let $config := admin:get-configuration(), $dbid := xdmp:database($db) return try { admin:save-configuration( admin:database-add-field($config, $dbid, admin:database-metadata-field(\"validStart\"))), admin:save-configuration( admin:database-add-field($config, $dbid, admin:database-metadata-field(\"validEnd\"))), admin:save-configuration( admin:database-add-field($config, $dbid, admin:database-metadata-field(\"systemStart\"))), admin:save-configuration( admin:database-add-field($config, $dbid, admin:database-metadata-field(\"systemEnd\"))) } catch ($err) {} }; declare function local:create-range-index-fields() { let $config := admin:get-configuration(), $dbid := xdmp:database($db) return try { admin:save-configuration( admin:database-add-range-field-index($config, $dbid, admin:database-range-field-index(\"dateTime\", \"validStart\", \"\", fn:true()))), admin:save-configuration( admin:database-add-range-field-index($config, $dbid, admin:database-range-field-index(\"dateTime\", \"validEnd\", \"\", fn:true()))), admin:save-configuration( admin:database-add-range-field-index($config, $dbid, admin:database-range-field-index(\"dateTime\", \"systemStart\", \"\", fn:true()))), admin:save-configuration( admin:database-add-range-field-index($config, $dbid, admin:database-range-field-index(\"dateTime\", \"systemEnd\", \"\", fn:true()))) } catch ($err) {} }; declare function local:create-axes() { try { let $t1 := temporal:axis-create( \"valid\", cts:field-reference(\"validStart\", \"type=dateTime\"), cts:field-reference(\"validEnd\", \"type=dateTime\")), $t2 := temporal:axis-create( \"system\", cts:field-reference(\"systemStart\", \"type=dateTime\"), cts:field-reference(\"systemEnd\", \"type=dateTime\")) return () } catch ($err) {} }; declare function local:create-temporal-collection() { try { let $t:= temporal:collection-create(\"\/perso-verluste\", \"system\", \"valid\") return () } catch ($err) {} }; declare function local:insert-original() { let $root := <vorgang> <perso-id>XYZ<\/perso-id> <name>Alex Düsel<\/name> <status>gestohlen<\/status> <\/vorgang>, $options := <options xmlns=\"xdmp:document-insert\"> <metadata> <map:map xmlns:map=\"http:\/\/marklogic.com\/xdmp\/map\"> <map:entry key=\"validStart\"> <map:value>2019-02-01T08:23:11<\/map:value> <\/map:entry> <map:entry key=\"validEnd\"> <map:value>9999-12-31T11:59:59Z<\/map:value> <\/map:entry> <\/map:map> <\/metadata> <\/options> return temporal:document-insert(\"\/perso-verluste\", \"duesel_alex_270774.xml\", $root, $options) }; declare function local:insert-update() { let $root := <vorgang> <perso-id>XYZ<\/perso-id> <name>Alex Düsel<\/name> <status>gefunden<\/status> <\/vorgang>, $options := <options xmlns=\"xdmp:document-insert\"> <metadata> <map:map xmlns:map=\"http:\/\/marklogic.com\/xdmp\/map\"> <map:entry key=\"validStart\"> <map:value>2019-02-06T08:00:00<\/map:value> <\/map:entry> <map:entry key=\"validEnd\"> <map:value>9999-12-31T11:59:59Z<\/map:value> <\/map:entry> <\/map:map> <\/metadata> <\/options> return temporal:document-insert(\"\/perso-verluste\", \"duesel_alex_270774.xml\", $root, $options) }; ( xdmp:invoke-function(local:create-temporal-fields#0), xdmp:invoke-function(local:create-range-index-fields#0), xdmp:invoke-function(local:create-axes#0), xdmp:invoke-function(local:create-temporal-collection#0), xdmp:invoke-function(local:insert-original#0), xdmp:invoke-function(local:insert-update#0))","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"5a2c0418-3a17-42dc-a27e-78dda31bc7f6d6e35","type":"para","text":"Beachtenswert ist hier,","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"0d69c9fe-a968-4023-919f-a333ec8d1b7dd6e32","type":"para","text":"dass die einzelnen Schritte als Funktion über aufgerufen werden. Dieses Konstrukt wird normalerweise benutzt um eine Funktion anonym zu deklarieren und als Transaktion aufzurufen. Marklogic bietet weitere Möglichkeiten transaktional zu arbeiten.","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"da016534-d98c-4116-addc-a8933d7b4e5cd6e35","type":"para","text":"Um die 5 Tage zwiachen Verlustmeldung und Wiederauffinden zu simulieren, wurde zwischem dem Anlegen der Dokumente ein Statement eingefügt.","title":" Anlegen des Testszenarios auf der ML Konsole "},{"id":"48ff0142-18b5-4135-986c-b4f3baf3550ed6e37","type":"para","text":"Lassen wir diese Query auf einer frischen Datenbank laufen, so erhalten wir die folgendes Ergebnis:","title":" Anlegen des Testszenarios auf der ML Konsole "}]