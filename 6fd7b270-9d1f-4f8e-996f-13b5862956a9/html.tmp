<div data-attribute-id="9d32e957-a332-40f5-bcbd-52fd6ed7f7da" class="topic show_menu tags" data-element="topic" data-deletable="false" data-tektur-editor-id="512c7476-cd6e-42d2-93b9-98d287295a4b"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="a693fc99-5e16-4788-95a0-958870aa845a" class="title pmarker tags" data-element="title" data-tektur-editor-id="45a3f1bf-a11e-4e3a-81b5-c0f3738a77e6" contenteditable="true">Validierung mit Schematron</div><div class="abstract optional show_menu tags" data-element="abstract" data-excluding="shortdesc" style="display:none" data-tektur-editor-id="5c9725bf-3c26-4a6d-a4c9-bc9f25a40c45"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="placeholder text pmarker tags" data-element="p" data-tektur-editor-id="3f80fb7f-0c03-43ff-bd18-b2c952e5271f" contenteditable="true"></div></div><div data-attribute-id="4db49812-1821-437b-a489-45eacebddee0" class="body show_menu tags" data-element="body" data-deletable="false" data-tektur-editor-id="d0d5e563-f5b8-41c8-bc80-99e98aeb6bf9"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="section tektur-wrapper tags" data-element="section" data-tektur-editor-id="1dfc00a2-3c59-4ba8-8b02-35007cabf30f"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="4e6cde2f-795e-42a2-97a3-67b0c72db22a" class="p pmarker tags" data-element="p" data-tektur-editor-id="c7a1a6bc-a68e-4f63-8200-e6c1bca8ca72" contenteditable="true">Um die Korrektheit einer XML Instanz zu prüfen, gib es verschiedene Schemata, wie XSD, RNG oder DTD[[xe1:Schemata]], welche der Parser beim Aufbau des DOM Baums heranzieht. Eine Validierung[[xe1:Verarbeitungsmethoden;xe2:Validierung]] mit Apache Xerces könnte beispielsweise als Java Code[[xe1:Programmiersprachen;xe2:Java]] folgendermaßen angestossen werden:</div><div class="pre"><div data-attribute-id="9746d9dd-2044-434f-91a0-6e80fe83e4d3d6e6" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="b0cf7d71-0d3e-4418-bf77-c071400d5dec" contenteditable="true">URL schemaFile = new URL("http://host:port/filename.xsd");
Source xmlFile = new StreamSource(new File("web.xml"));
SchemaFactory schemaFactory = SchemaFactory
    .newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
try {
  Schema schema = schemaFactory.newSchema(schemaFile);
  Validator validator = schema.newValidator();
  validator.validate(xmlFile);
  System.out.println(xmlFile.getSystemId() + " is valid");
} catch (SAXException e) {
  System.out.println(xmlFile.getSystemId() + " is NOT valid reason:" + e);
} catch (IOException e) {</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="e0f8f3a8-ac48-4040-aa61-6d98bf685133d6e8" class="p pmarker tags" data-element="p" data-tektur-editor-id="67e3d00d-53dd-425f-a634-9e9de861fe41" contenteditable="true">Schema Dateien können aber auch in XML Editoren eingebunden werden, um schon während der Eingabe der XML Instanz die Korrektheit zu überprüfen. </div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3920a1e6-ddfe-499f-997b-33b7b330ae55d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="a47ffdb6-65fa-4438-97a7-6907f800a9c6" contenteditable="true">Das geht einerseits über die Angabe des Doctypes in der XML Instanz, anderseits bieten auch alle Editoren die Möglichkeit ein bestimmtes Schema explizit auszuwählen, um gegen dieses auf Anforderung zu validieren.</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="0c8bf04d-6ef7-4b2b-9e36-3c115fdf5657d6e10" class="p pmarker tags" data-element="p" data-tektur-editor-id="75d74718-58f3-4103-b01c-1d8e0e7c9807" contenteditable="true">Gilt es komplexere Businessregeln zu überprüfen, die über Syntax-, Konsistenz- und einfache Korrektheitschecks hinausgehen, empfiehlt sich eine Validierung mit Schematron Regeln.</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="1bb56487-9595-4311-8f13-9eacb036b7eb"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="c802dd14-5953-4c24-8637-f7552d107e57d6e13" class="title pmarker tags" data-element="title" data-tektur-editor-id="6570f0c0-a645-4edc-8cfd-f287e84b720a" contenteditable="true">Schematron ist XSLT</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="c7d6f54a-c183-4238-8fcd-65258833ebd9d6e15" class="p pmarker tags" data-element="p" data-tektur-editor-id="6cf3d802-da0e-40e5-9e6c-6b05c203237d" contenteditable="true">Bei einer Schematron Validierung wird eine XML Instanz mit Hilfe eines automatisch generierten XSLT Stylesheets überprüft. Dieses kontextabhängige Stylesheet wird aus einer in der Schematron Syntax vom Autor verfassten Regelbasis, die wiederum in XML vorliegt, über ein zweites XSLT Stylesheet generiert - Dieses zweite XSLT Stylesheet ist sozusagen das eigentliche Schematron Programm. </div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="ca8d184a-924b-4ea6-bdab-3340c1bde072d6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="9c89e1d6-c592-47e2-9c1b-7be7c19c8ec9" contenteditable="true">Das folgende Diagramm veranschaulicht die Vorgehensweise anhand eines Filter-Szenarios[[xe1:Verarbeitungsmethoden;xe2:Filter-Szenario]], bei dem ein XML Dokument mit einigen ungültigen Passagen in eine gefilterte Darstellung überführt wird.</div> |   |                                                    Rejected by , .       <div data-attribute-id="7b4d6915-e9d8-4db0-a65a-6b014e30d70cd6e21" class="fig show_menu tags" data-element="fig" data-tektur-editor-id="27be3082-4305-4a82-8c1e-3781c88dc30c"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div class="desc optional pmarker tags" data-element="desc" data-tektur-editor-id="991e7aea-e52e-4ebc-a628-9871c136346a" contenteditable="true">Einfacher Batch-Prozess zur Validierung mit Schematron und anschliessendem Filtern der Ergebnisse</div><div class="image tags" data-element="image" style="display:none" data-attribute-id="2fac813f-c72e-488b-8db5-eda330648952d6e27" data-attribute-href="schematron.svg" data-tektur-editor-id="0d0cc56e-e354-45cd-ac6e-cd5b6ee4f14a"></div><div class="title optional pmarker tags" data-element="title" data-tektur-editor-id="095e8645-6968-4e3e-ab7e-88dc8c857fae" contenteditable="true">Schematron Validierung mit Filter</div><table class="legend optional show_menu tags" data-element="legend" width="100%" style="display:none" data-tektur-editor-id="2b586345-6880-4944-b9aa-bdc43279fe0a"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><tbody><tr class="legentry tags" data-element="legentry" data-tektur-editor-id="2935bd81-0e89-42d3-9df8-86d81d7fa3d5"><td valign="top" class="leg-pos tags" data-element="leg-pos" width="10%" data-tektur-editor-id="0ae13bf7-116a-470f-bf8c-02342452ecc0"><div class="pmarker placeholder text tags" data-element="p" data-tektur-editor-id="e51647bd-145e-41ec-a2d7-62ce12b3a725" contenteditable="true"></div></td><td valign="top" class="leg-name tags" data-element="leg-name" width="90%" data-tektur-editor-id="4ab2db98-ee8d-48f0-8505-56188c7b113c"><div class="pmarker placeholder text tags" data-element="p" data-tektur-editor-id="f46c23a1-60a4-4739-8b52-8d4e3f989278" contenteditable="true"></div></td></tr></tbody></table></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="4e1ec9a6-9a1a-470b-9e86-2708788be97bd6e19" class="p pmarker tags" data-element="p" data-tektur-editor-id="f02a04ca-4f0b-4946-ada2-f14f8a51eeb5" contenteditable="true">Zu finden ist das [[link]]Schematron Repo auf Github[[fn:https://github.com/Schematron/schematron*Schematron auf GitHub]]. Dieses Repo ist etwas unübersichtlich. Der relevante Teil des Sourcecodes befindet sich unter: [[code:schematron/code]]</div></div><div data-element="section" class="section optional show_menu tags" data-tektur-editor-id="c34348ba-b417-48b2-8b95-9dd1966240c1"><div class="gui-optional-elements-button" contenteditable="false"><div class="menu-icon" style="display:none">+</div></div><div data-attribute-id="0cc5ca05-4506-44eb-981b-f74a156e6da0d6e20" class="title pmarker tags" data-element="title" data-tektur-editor-id="70d6e0b6-8f2d-48c8-a973-ad580fb76786" contenteditable="true">CLI Verwendung</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="3f68c067-cd95-4b41-b51b-c594057af29fd6e22" class="p pmarker tags" data-element="p" data-tektur-editor-id="75abab85-be89-4709-b8e5-5d8923579836" contenteditable="true">Um die Schematron XSLT Skripte in eine eigene XSLT Anwendung per Kommandozeile einzubinden, könnte man folgendermassen vorgehen: </div><ul data-attribute-id="368e46b4-2935-46d4-b297-b69ea1f184f9d6e28" class="ul tags" data-element="ul" data-tektur-editor-id="3a6571d2-2e2d-4809-be64-d68a3f6c21f7"><li data-attribute-id="beaa7b40-6b08-40a3-b2ba-0adb6c981fe8d6e29" class="li tags" data-element="li" data-tektur-editor-id="72ef56ac-d655-4bf0-b465-5cb9573ffc8e"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="59142162-ceef-41df-a800-9a82f41eaff6d6e30" class="p pmarker tags" data-element="p" data-tektur-editor-id="e458fce2-5bee-4133-8538-1954e4bf0c59" contenteditable="true">Im eigenen GIT Projekt das Schematron Projekt als Submodule referenzieren.</div></li><li data-attribute-id="9b6d2a32-4852-4160-b41b-862d27c79eb6d6e32" class="li tags" data-element="li" data-tektur-editor-id="afad88be-3a12-4b22-b5c4-6f0033a8324a"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="8a62a1b3-7fee-435a-bf97-c1948afb372ed6e33" class="p pmarker tags" data-element="p" data-tektur-editor-id="4b5f1aec-d059-4362-87b5-6cfcad4a51f3" contenteditable="true">Eine Regelbasis anlegen, beispielsweise [[code:$project_name.sch]].</div></li><li data-attribute-id="0ae25d42-35fb-4e22-8244-0339392cfbe1d6e38" class="li tags" data-element="li" data-tektur-editor-id="9b3bb2d9-0ee0-43e1-b309-247d5216a567"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="eab4b247-bdc0-4465-bc93-a032e7705a07d6e39" class="p pmarker tags" data-element="p" data-tektur-editor-id="5268de84-977a-4760-9541-c1124aed3192" contenteditable="true">Zwei Batch-Skripte anlegen, beispielsweise [[code:generate_schema.sh]] und [[code:validate.sh]].</div></li></ul><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="998bb486-7c42-4af2-8e5b-0e85e56dc38ad6e50" class="p pmarker tags" data-element="p" data-tektur-editor-id="7be12c80-2848-4c85-89ae-334e2cb97619" contenteditable="true">Mittels des Skripts [[code:generate_schema.sh]] wird aus der Schematron Regelbasis das Schematron XSLT Stylesheet generiert. Der Inhalt dieser Batchdatei könnte zum Beispiel so aussehen:</div><div class="pre"><div data-attribute-id="90bdd8d1-55e7-4581-b001-5fed19949244d6e61" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="50a37308-9b68-411d-b342-0390ee9b96b6" contenteditable="true">saxon $script_dir/$project_name_validation.sch $script_dir/schematron/iso_dsdl_include.xsl
 | \ saxon -s:- $script_dir/schematron/iso_abstract_expand.xsl | \
saxon -s:- $script_dir/schematron/iso_svrl_for_xslt2.xsl \
  <span data-attribute-id="bf02c5f0-b12f-4646-a448-7f30126397fad6e57" class="b tags" data-element="b" data-tektur-editor-id="b87a0792-4a5a-469b-ac40-5777f4b27d20">generate-fired-rule</span>=false &#x3E; $script_dir/$project_name_validation.xsl</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="7be99f5c-fe71-459c-8ddf-9f08385e9169d6e54" class="p pmarker tags" data-element="p" data-tektur-editor-id="7ec463fb-e339-4dff-9557-dc4c8faf180b" contenteditable="true">Der Prozess zum Erzeugen des projektspezifischen Validerungs-XSLT-Skripts ist dreistufig und wird über die folgenden XSLT Schritte abgearbeitet.</div><ul data-attribute-id="9d6e90b6-c296-482a-a1e2-77c4b31d6a65d6e56" class="ul tags" data-element="ul" data-tektur-editor-id="b36fd6b0-0f31-4108-be02-5ee509ae6ea2"><li data-attribute-id="45781342-3ecf-42ae-8ab6-5ac71b0f4ff9d6e57" class="li tags" data-element="li" data-tektur-editor-id="47862464-4569-4eb8-ad10-373409f7f1cb"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="eb1a9bae-260a-4106-b5c9-b6851fdd2ba1d6e58" class="p pmarker tags" data-element="p" data-tektur-editor-id="62ac75e0-1642-4396-8a90-83debbd7df39" contenteditable="true">iso_dsdl_include.xsl</div></li><li data-attribute-id="7e655fce-dd9b-45b7-b7ed-a70107e495f8d6e60" class="li tags" data-element="li" data-tektur-editor-id="f21868f6-f9d8-4d14-a736-a6dde18a4c30"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="a82297e3-5906-4320-99eb-713788e3b883d6e61" class="p pmarker tags" data-element="p" data-tektur-editor-id="d55b54f5-ba7e-48bd-b6bb-f112f90d0cc9" contenteditable="true">iso_abstract_expand.xsl</div></li><li data-attribute-id="8080fd50-b3ca-4df8-a4cf-06ac1f27971dd6e63" class="li tags" data-element="li" data-tektur-editor-id="21b312be-8566-4d34-b783-7fe9d23620a7"><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="cab1d34a-07d6-4707-8cfd-1a22273d0703d6e64" class="p pmarker tags" data-element="p" data-tektur-editor-id="676c1e7a-7519-4879-9205-5f3755e6f6cc" contenteditable="true">iso_svrl_for_xslt2.xsl</div></li></ul><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="315b3655-c795-42e1-908a-769f2ca0b68cd6e66" class="p pmarker tags" data-element="p" data-tektur-editor-id="c064cb10-9272-436c-8e04-8df714d352ac" contenteditable="true">Herauszufinden, was in diesen Skripten passiert, sei dem geneigten Leser selbst überlassen. Uns interessiert an dieser Stelle nur das Resultat, nämlich das XSLT Stylesheet [[code:$project_name_validation.xsl]].</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="a226a2f6-4408-401b-b164-9ee358f8bd09d6e76" class="p pmarker tags" data-element="p" data-tektur-editor-id="4576a959-77e9-4fae-84bf-2e0e4d12d0cc" contenteditable="true">Dieses Skript wird in der Batchdatei [[code:validate.sh]] aufgerufen:</div><div class="pre"><div data-attribute-id="dd4f1d1b-538a-40fc-83d8-6045d0d1b16bd6e87" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="f8785637-aca5-4a3a-a7b0-38af450a21bb" contenteditable="true">saxon $xml_instance_to_check.xml $script_dir/$project_name_validation.xsl \
  &#x3E; $validation-result.xml</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="bd569a63-55f0-4524-bb53-0d3eeb1bdb59d6e83" class="p pmarker tags" data-element="p" data-tektur-editor-id="0a42bb46-0003-46c8-a565-29ba065c8002" contenteditable="true">Die Ausgabe dieses Prüfprozesses ist eine XML Datei mit den Fehlern in der Eingabe-XML-Instanz, die weiterverarbeitet werden kann, beispielsweise als Filterkriterium für einen nachfolgenden Prozessschritt. Ihr Inhalt dieser Datei sieht z.B. wie folgt aus:</div><div class="pre"><div data-attribute-id="e6394bde-2ef7-48e1-a123-7ede14139929d6e92" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="a17b9b4a-7489-487b-9b7e-cc6fdb06fe74" contenteditable="true">&#x3C;svrl:schematron-output xmlns:svrl="http://purl.oclc.org/dsdl/svrl" [...]
  &#x3C;svrl:active-pattern document="file:/Users/alex/xml_instance_to_check.xml" 
   id="default" name="default"/&#x3E;
  &#x3C;svrl:failed-assert test="count(key('unique-ids', current()))=1"&#x3E;
    &#x3C;svrl:text&#x3E;ID is not unique!&#x3C;/svrl:text&#x3E;
    &#x3C;svrl:diagnostic-reference diagnostic="default"&#x3E;
      &#x3C;bk:id xmlns:bk="http://tekturcms/namespaces/book"&#x3E;1234-5678-9&#x3C;/my:id&#x3E;
    &#x3C;/svrl:diagnostic-reference&#x3E;
  &#x3C;/svrl:failed-assert&#x3E;
  [...]</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="62973ac6-dca8-47cf-b4aa-8e5b6c4242a6d6e88" class="p pmarker tags" data-element="p" data-tektur-editor-id="9d4bb112-0e24-4705-b207-a6d1dfd2e0ac" contenteditable="true">Neben den [[code:svrl:failed-assert]] Elementen, die angeben, was bei der überprüften XML-Instanz fehlgeschlagen ist, gibt es auch die Möglichkeit sich positive Ergebnisse anzeigen zu lassen - über das Element [[code:svrl:successful-report]].</div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="a939cc7b-99b0-401a-8bc5-5b0c0f41882cd6e100" class="p pmarker tags" data-element="p" data-tektur-editor-id="d820e5bc-6ba9-45c8-8d8c-c1d6fe16ab24" contenteditable="true">Konkret bedeutet das obige XML Schnipsel, dass unsere [[code:id]] mit dem Wert [[code:1234-5688-9]] im geprüften XML Dokument nicht eindeutig ist. Die Schematron Regelbasis, die wir zur Überprüfung angegebenen haben, sieht so aus:</div><div class="pre"><div data-attribute-id="5f6520a4-11e1-42ea-b45a-367b95fb649ad6e110" data-attribute-xml_space="preserve" class="pre-content pmarker tags" data-element="pre" data-tektur-editor-id="bf544e90-f48c-4f3d-90af-36a545bdab52" contenteditable="true">&#x3C;schema xmlns:sch="http://purl.oclc.org/dsdl/schematron" [...]
  &#x3C;xsl:key name="unique-ids" match="bk:id" use="."/&#x3E;
  &#x3C;sch:let name="date-regex" value="'^((19|2[0-9])[0-9]{2})-(0[1-9]|1[012])
                                     -(0[1-9]|[12][0-9]|3[01])$'"/&#x3E;
  &#x3C;sch:pattern id="default"&#x3E;
    &#x3C;sch:rule context="book"&#x3E;
      &#x3C;sch:assert id="check-book-id" role="error" test="count(key('unique-ids', bk:id))=1" 
                  diagnostics="default"&#x3E;ID is not unique!&#x3C;/sch:assert&#x3E;
      &#x3C;sch:assert id="check-book-published" role="error" 
                  test="matches(bk:published,$date-regex)
    &#x3C;/sch:rule&#x3E;
    [...]
  &#x3C;/sch:pattern&#x3E;
  &#x3C;sch:diagnostics&#x3E;
    &#x3C;sch:diagnostic id="default"&#x3E;
      &#x3C;xsl:element name="bk:id"&#x3E;
        &#x3C;xsl:value-of select="bk:id"/&#x3E;
      &#x3C;/xsl:element&#x3E;
    &#x3C;/sch:diagnostic&#x3E;
  &#x3C;/sch:diagnostics&#x3E;</div></div><div xmlns:xr="http://www.tekturcms.de/2012/xr/common" xmlns:xlink="http://www.w3.org/1999/xlink" data-attribute-id="86e8f330-f639-42dd-98da-7eebba76fb51d6e108" class="p pmarker tags" data-element="p" data-tektur-editor-id="e877815b-1957-4344-b19c-9d2320a5c233" contenteditable="true">Neben der "successful" und "failed" Regeln ist auch die Deklaration von Funktionen und Variablen im Body der Regelbasis erlaubt. Dies ermöglicht komplexe Bedingungen, bespw. durch das Nachschlagen in einer Lookup-Tabelle abzuprüfen. </div></div></div></div>